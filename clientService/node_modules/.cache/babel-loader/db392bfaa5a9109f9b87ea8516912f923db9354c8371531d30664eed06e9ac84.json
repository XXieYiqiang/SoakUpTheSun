{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _default = exports.default = {\n  name: 'JoinRoom',\n  data() {\n    return {\n      isProcessing: true,\n      processText: '正在验证志愿者身份...',\n      hasError: false,\n      errorTip: '',\n      // 从路径解析出的原始参数\n      volunteerId: '',\n      inviteCode: ''\n    };\n  },\n  mounted() {\n    this.parseParamsAndVerify();\n  },\n  methods: {\n    async parseParamsAndVerify() {\n      // 1. 从路由参数解析 (路由定义需为 /join/:vId/:code)\n      const {\n        vId,\n        code\n      } = this.$route.params;\n      console.log('Parsed params:', vId, code);\n      if (!vId || !code) {\n        this.showError('邀请信息不完整，请重新获取链接');\n        return;\n      }\n      this.volunteerId = vId;\n      this.inviteCode = code;\n\n      // 2. 核心逻辑：向后端换取房间令牌\n      try {\n        const res = await this.$api.verifyAndJoin({\n          volunteerId: this.volunteerId,\n          inviteCode: this.inviteCode\n        });\n        if (res.success) {\n          this.processText = '验证通过，正在进入房间...';\n          this.enterChatRoom(res.roomId, res.token);\n        } else {\n          this.showError(res.message || '邀请码或编号校验错误');\n        }\n      } catch (err) {\n        this.showError('网络异常，身份验证失败');\n      }\n    },\n    enterChatRoom(roomId, token) {\n      // 3. 携带令牌和房间号跳转到真正的聊天室\n      // 这里的路径可以是 /chat，通过 query 传参\n      this.$router.replace({\n        path: '/chat',\n        query: {\n          roomId: roomId,\n          token: token\n        }\n      });\n    },\n    showError(msg) {\n      this.isProcessing = false;\n      this.hasError = true;\n      this.errorTip = msg;\n    },\n    closeWindow() {\n      // 如果是微信或移动端浏览器，尝试关闭\n      window.close();\n    }\n  }\n};","map":{"version":3,"names":["name","data","isProcessing","processText","hasError","errorTip","volunteerId","inviteCode","mounted","parseParamsAndVerify","methods","vId","code","$route","params","console","log","showError","res","$api","verifyAndJoin","success","enterChatRoom","roomId","token","message","err","$router","replace","path","query","msg","closeWindow","window","close"],"sources":["src/views/JoinRoom.vue"],"sourcesContent":["<template>\r\n  <div class=\"join-room\">\r\n    <div v-if=\"isProcessing\" class=\"status-box\">\r\n      <div class=\"spinner\"></div>\r\n      <p>{{ processText }}</p>\r\n    </div>\r\n    \r\n    <div v-else-if=\"hasError\" class=\"error-box\">\r\n      <icon-error></icon-error> \r\n      <h3>访问受限</h3>\r\n      <p>{{ errorTip }}</p>\r\n      <button @click=\"closeWindow\">关闭页面</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'JoinRoom',\r\n  data() {\r\n    return {\r\n      isProcessing: true,\r\n      processText: '正在验证志愿者身份...',\r\n      hasError: false,\r\n      errorTip: '',\r\n      // 从路径解析出的原始参数\r\n      volunteerId: '',\r\n      inviteCode: ''\r\n    };\r\n  },\r\n  mounted() {\r\n    this.parseParamsAndVerify();\r\n  },\r\n  methods: {\r\n    async parseParamsAndVerify() {\r\n      // 1. 从路由参数解析 (路由定义需为 /join/:vId/:code)\r\n      const { vId, code } = this.$route.params;\r\n\r\n      console.log('Parsed params:', vId, code);\r\n      \r\n      if (!vId || !code) {\r\n        this.showError('邀请信息不完整，请重新获取链接');\r\n        return;\r\n      }\r\n\r\n      this.volunteerId = vId;\r\n      this.inviteCode = code;\r\n\r\n      // 2. 核心逻辑：向后端换取房间令牌\r\n      try {\r\n        const res = await this.$api.verifyAndJoin({\r\n          volunteerId: this.volunteerId,\r\n          inviteCode: this.inviteCode\r\n        });\r\n\r\n        if (res.success) {\r\n          this.processText = '验证通过，正在进入房间...';\r\n          this.enterChatRoom(res.roomId, res.token);\r\n        } else {\r\n          this.showError(res.message || '邀请码或编号校验错误');\r\n        }\r\n      } catch (err) {\r\n        this.showError('网络异常，身份验证失败');\r\n      }\r\n    },\r\n\r\n    enterChatRoom(roomId, token) {\r\n      // 3. 携带令牌和房间号跳转到真正的聊天室\r\n      // 这里的路径可以是 /chat，通过 query 传参\r\n      this.$router.replace({\r\n        path: '/chat',\r\n        query: {\r\n          roomId: roomId,\r\n          token: token\r\n        }\r\n      });\r\n    },\r\n\r\n    showError(msg) {\r\n      this.isProcessing = false;\r\n      this.hasError = true;\r\n      this.errorTip = msg;\r\n    },\r\n\r\n    closeWindow() {\r\n      // 如果是微信或移动端浏览器，尝试关闭\r\n      window.close();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.join-room { padding: 50px 20px; text-align: center; }\r\n.error-box h3 { color: #333; margin-top: 20px; }\r\n.error-box p { color: #999; font-size: 14px; margin: 10px 0 30px; }\r\nbutton {\r\n  padding: 10px 30px; background: #3498db; color: #fff;\r\n  border: none; border-radius: 4px; cursor: pointer;\r\n}\r\n</style>"],"mappings":";;;;;;iCAiBA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,YAAA;MACAC,WAAA;MACAC,QAAA;MACAC,QAAA;MACA;MACAC,WAAA;MACAC,UAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,oBAAA;EACA;EACAC,OAAA;IACA,MAAAD,qBAAA;MACA;MACA;QAAAE,GAAA;QAAAC;MAAA,SAAAC,MAAA,CAAAC,MAAA;MAEAC,OAAA,CAAAC,GAAA,mBAAAL,GAAA,EAAAC,IAAA;MAEA,KAAAD,GAAA,KAAAC,IAAA;QACA,KAAAK,SAAA;QACA;MACA;MAEA,KAAAX,WAAA,GAAAK,GAAA;MACA,KAAAJ,UAAA,GAAAK,IAAA;;MAEA;MACA;QACA,MAAAM,GAAA,cAAAC,IAAA,CAAAC,aAAA;UACAd,WAAA,OAAAA,WAAA;UACAC,UAAA,OAAAA;QACA;QAEA,IAAAW,GAAA,CAAAG,OAAA;UACA,KAAAlB,WAAA;UACA,KAAAmB,aAAA,CAAAJ,GAAA,CAAAK,MAAA,EAAAL,GAAA,CAAAM,KAAA;QACA;UACA,KAAAP,SAAA,CAAAC,GAAA,CAAAO,OAAA;QACA;MACA,SAAAC,GAAA;QACA,KAAAT,SAAA;MACA;IACA;IAEAK,cAAAC,MAAA,EAAAC,KAAA;MACA;MACA;MACA,KAAAG,OAAA,CAAAC,OAAA;QACAC,IAAA;QACAC,KAAA;UACAP,MAAA,EAAAA,MAAA;UACAC,KAAA,EAAAA;QACA;MACA;IACA;IAEAP,UAAAc,GAAA;MACA,KAAA7B,YAAA;MACA,KAAAE,QAAA;MACA,KAAAC,QAAA,GAAA0B,GAAA;IACA;IAEAC,YAAA;MACA;MACAC,MAAA,CAAAC,KAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}