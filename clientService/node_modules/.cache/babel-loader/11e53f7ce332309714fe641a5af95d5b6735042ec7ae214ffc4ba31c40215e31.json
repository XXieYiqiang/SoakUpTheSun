{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport FileTable from '@/components/common/FileTable.vue';\nimport FileGrid from './components/FileGrid.vue';\nimport FileTimeLine from './components/FileTimeLine.vue';\nimport OperationMenu from '@/components/file/OperationMenu.vue';\nimport BreadCrumb from '@/components/file/components/BreadCrumb.vue';\nimport { getFileListByPath, getFileListByType, getRecoveryFile, getMyShareFileList, searchFile } from '@/api/file.js';\nexport default {\n  name: 'FileList',\n  components: {\n    FileTable,\n    OperationMenu,\n    FileGrid,\n    BreadCrumb,\n    FileTimeLine\n  },\n  props: {\n    refreshData: {\n      type: String,\n      required: true,\n      default: '0'\n    }\n  },\n  data() {\n    return {\n      fileNameSearch: '',\n      loading: true,\n      //  表格数据-loading\n      fileList: [],\n      //  表格数据-文件列表\n      // 分页数据\n      pageData: {\n        currentPage: 1,\n        pageCount: 50,\n        total: 0\n      }\n    };\n  },\n  computed: {\n    // 左侧菜单选中的文件类型\n    fileType() {\n      return this.$route.query.fileType ? Number(this.$route.query.fileType) : 0;\n    },\n    // 当前所在路径\n    filePath() {\n      return this.$route.query.filePath ? this.$route.query.filePath : '/';\n    },\n    // 文件查看模式 0列表模式 1网格模式 2 时间线模式\n    fileModel() {\n      return this.$store.getters.fileModel;\n    },\n    // 屏幕宽度\n    screenWidth() {\n      return this.$store.state.common.screenWidth;\n    }\n  },\n  watch: {\n    //lml\n    filePath() {\n      // 当左侧菜单选择“全部”或“我的分享”，文件路径发生变化时，再重新获取文件列表\n      if (this.$route.name === 'File' && [0, 8].includes(this.fileType)) {\n        this.setPageCount();\n        this.getTableDataByType();\n      }\n    },\n    //lml\n    fileType() {\n      if (this.$route.name === 'File') {\n        this.setPageCount();\n        this.getTableDataByType();\n      }\n    },\n    // 监听文件查看模式\n    fileModel() {\n      this.setPageCount();\n    },\n    refreshData(newVal) {\n      // 每当 message 变化，执行逻辑\n      console.log('父组件传值变化:', newVal);\n      this.showFileList();\n    }\n  },\n  created() {\n    this.setPageCount();\n    //lml\n    this.getTableDataByType();\n  },\n  methods: {\n    /**\r\n     * 文件展示区域的空白处右键事件\r\n     * @param {Document} event 右键事件对象\r\n     * //lml\r\n     */\n    handleClickRight(event) {\n      console.log('文件展示区域的空白处右键事件:');\n      event.preventDefault();\n      // 只有在全部页面才可以进行以下操作\n      if (![6, 8].includes(this.fileType)) {\n        this.$openBox.contextMenu({\n          selectedFile: undefined,\n          domEvent: event,\n          serviceEl: this\n        }).then(res => {\n          if (res === 'confirm') {\n            this.getTableDataByType(); //  刷新文件列表\n            // this.$store.dispatch('showStorage') //  刷新存储容量\n          }\n        });\n      }\n    },\n    /**\r\n     * 表格数据获取相关事件 | 调整分页大小\r\n     */\n    setPageCount() {\n      this.pageData.currentPage = 1;\n      if (this.fileModel === 0) {\n        this.pageData.pageCount = 50;\n      }\n      if (this.fileModel === 1) {\n        this.pageData.pageCount = 100;\n      }\n    },\n    /**\r\n     * 表格数据获取相关事件 | 获取文件列表数据\r\n     * lml\r\n     */\n    getTableDataByType() {\n      this.loading = true;\n      console.log('getTableDataByType===');\n      // 分类型\n      if (Number(this.fileType)) {\n        switch (Number(this.fileType)) {\n          case 6:\n            {\n              this.showFileRecovery(); //  回收站\n              break;\n            }\n          case 8:\n            {\n              this.showMyShareFile(); //  我的分享\n              break;\n            }\n          default:\n            {\n              this.showFileList();\n              break;\n            }\n        }\n      } else {\n        // 全部文件\n        this.showFileList();\n      }\n      // this.$store.dispatch('showStorage')\n    },\n    /**\r\n     * 表格数据获取相关事件 | 获取当前路径下的文件列表\r\n     */\n    showFileList() {\n      console.log('showFileList==');\n      let data = {\n        fileType: this.fileType,\n        filePath: this.filePath,\n        currentPage: this.pageData.currentPage,\n        pageCount: this.pageData.pageCount\n      };\n      if (this.refreshData) {\n        data.fileType = this.refreshData;\n      }\n      getFileListByPath(data).then(res => {\n        if (res && res.data && res.data.code === 200) {\n          this.fileList = res.data.data.records;\n          this.pageData.total = Number(res.data.data.total);\n          this.loading = false;\n        } else {\n          this.$message.error(res.data.message);\n        }\n      });\n    },\n    /**\r\n     * 表格数据获取相关事件 | 分页组件 | 当前页码改变\r\n     * \r\n     * //lml\r\n     */\n    handleCurrentChange(currentPage) {\n      this.pageData.currentPage = currentPage;\n      this.getTableDataByType();\n    },\n    /**\r\n     * 表格数据获取相关事件 | 分页组件 | 页大小改变时\r\n     * //lml\r\n     */\n    handleSizeChange(pageCount) {\n      this.pageData.pageCount = pageCount;\n      this.getTableDataByType();\n    },\n    /**\r\n     * 表格数据获取相关事件 | 获取回收站文件列表\r\n     */\n    showFileRecovery() {\n      console.log('showFileRecovery==');\n      getRecoveryFile().then(res => {\n        if (res.success) {\n          this.fileList = res.dataList;\n          this.loading = false;\n        } else {\n          this.$message.error(res.message);\n        }\n      });\n    },\n    /**\r\n     * 表格数据获取相关事件 | 获取我的分享列表\r\n     */\n    showMyShareFile() {\n      console.log('showMyShareFile==');\n      let data = {\n        shareFilePath: this.filePath,\n        shareBatchNum: this.$route.query.shareBatchNum,\n        currentPage: this.pageData.currentPage,\n        pageCount: this.pageData.pageCount\n      };\n      getMyShareFileList(data).then(res => {\n        if (res.success) {\n          this.fileList = res.dataList;\n          this.pageData.total = Number(res.total);\n          this.loading = false;\n        } else {\n          this.$message.error(res.message);\n        }\n      });\n    },\n    /**\r\n     * 表格数据获取相关事件 | 根据文件类型展示文件列表\r\n     */\n    showFileListByType() {\n      console.log('showFileListByType==');\n      //  分类型\n      let data = {\n        fileType: this.fileType,\n        currentPage: this.pageData.currentPage,\n        pageCount: this.pageData.pageCount\n      };\n      // 模拟数据\n      const res = {\n        \"success\": true,\n        \"code\": 0,\n        \"message\": \"成功\",\n        \"data\": null,\n        \"dataList\": [{\n          \"fileId\": null,\n          \"timeStampName\": null,\n          \"fileUrl\": null,\n          \"fileSize\": null,\n          \"storageType\": null,\n          \"pointCount\": null,\n          \"identifier\": null,\n          \"userFileId\": \"1896819986112012288\",\n          \"userId\": 1,\n          \"fileName\": \"node_modules\",\n          \"filePath\": \"/\",\n          \"extendName\": \"\",\n          \"isDir\": 1,\n          \"uploadTime\": \"2025-03-04 15:08:20\",\n          \"deleteFlag\": 0,\n          \"deleteTime\": null,\n          \"deleteBatchNum\": null,\n          \"imageWidth\": null,\n          \"imageHeight\": null\n        }, {\n          \"fileId\": null,\n          \"timeStampName\": null,\n          \"fileUrl\": null,\n          \"fileSize\": null,\n          \"storageType\": null,\n          \"pointCount\": null,\n          \"identifier\": null,\n          \"userFileId\": \"1902567581638225920\",\n          \"userId\": 1,\n          \"fileName\": \"文件1\",\n          \"filePath\": \"/\",\n          \"extendName\": \"\",\n          \"isDir\": 1,\n          \"uploadTime\": \"2025-03-20 11:47:14\",\n          \"deleteFlag\": 0,\n          \"deleteTime\": null,\n          \"deleteBatchNum\": null,\n          \"imageWidth\": null,\n          \"imageHeight\": null\n        }, {\n          \"fileId\": null,\n          \"timeStampName\": null,\n          \"fileUrl\": null,\n          \"fileSize\": null,\n          \"storageType\": null,\n          \"pointCount\": null,\n          \"identifier\": null,\n          \"userFileId\": \"1902567638034837504\",\n          \"userId\": 1,\n          \"fileName\": \"文件及2\",\n          \"filePath\": \"/\",\n          \"extendName\": \"\",\n          \"isDir\": 1,\n          \"uploadTime\": \"2025-03-20 11:47:27\",\n          \"deleteFlag\": 0,\n          \"deleteTime\": null,\n          \"deleteBatchNum\": null,\n          \"imageWidth\": null,\n          \"imageHeight\": null\n        }, {\n          \"fileId\": \"1902571481250418688\",\n          \"timeStampName\": null,\n          \"fileUrl\": \"upload/20250320/633424203495cc0eb540a00de0ccd515.docx\",\n          \"fileSize\": 10082,\n          \"storageType\": 0,\n          \"pointCount\": null,\n          \"identifier\": \"633424203495cc0eb540a00de0ccd515\",\n          \"userFileId\": \"1902571481602740224\",\n          \"userId\": 1,\n          \"fileName\": \"12\",\n          \"filePath\": \"/\",\n          \"extendName\": \"docx\",\n          \"isDir\": 0,\n          \"uploadTime\": \"2025-03-20 12:02:43\",\n          \"deleteFlag\": 0,\n          \"deleteTime\": null,\n          \"deleteBatchNum\": null,\n          \"imageWidth\": null,\n          \"imageHeight\": null\n        }, {\n          \"fileId\": \"1924646103659642880\",\n          \"timeStampName\": null,\n          \"fileUrl\": \"upload/20250520/89e81c27cf89c246870f0db520a9b34f.mp3\",\n          \"fileSize\": 160111,\n          \"storageType\": 0,\n          \"pointCount\": null,\n          \"identifier\": \"89e81c27cf89c246870f0db520a9b34f\",\n          \"userFileId\": \"1924646103990992896\",\n          \"userId\": 1,\n          \"fileName\": \"13\",\n          \"filePath\": \"/\",\n          \"extendName\": \"mp3\",\n          \"isDir\": 0,\n          \"uploadTime\": \"2025-05-20 09:59:24\",\n          \"deleteFlag\": 0,\n          \"deleteTime\": null,\n          \"deleteBatchNum\": null,\n          \"imageWidth\": null,\n          \"imageHeight\": null\n        }],\n        \"total\": 14\n      };\n      console.log('res=====');\n      console.log(res);\n      if (res.success) {\n        this.fileList = res.dataList;\n        this.pageData.total = Number(res.total);\n        this.loading = false;\n      } else {\n        this.$message.error(res.message);\n      }\n      // getFileListByType(data).then((res) => {\n      // \tif (res.success) {\n      // \t\tthis.fileList = res.dataList\n      // \t\tthis.pageData.total = Number(res.total)\n      // \t\tthis.loading = false\n      // \t} else {\n      // \t\tthis.$message.error(res.message)\n      // \t}\n      // })\n    },\n    /**\r\n     * 获取搜索文件结果列表\r\n     * @param {string} fileName 文件名称\r\n     */\n    getSearchFileList(fileName) {\n      this.loading = true;\n      searchFile({\n        currentPage: this.pageData.currentPage,\n        pageCount: this.pageData.pageCount,\n        fileName: fileName\n      }).then(res => {\n        this.loading = false;\n        if (res.success) {\n          this.fileList = res.dataList.map(item => {\n            return {\n              ...item,\n              highlightFields: item.highLight.fileName[0]\n            };\n          });\n          this.pageData.total = res.data.totalHits;\n        } else {\n          this.$message.error(res.message);\n        }\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}