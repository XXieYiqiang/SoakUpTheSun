{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\n/**\r\n * ðŸ“¬ Vuex ç«™å†…ä¿¡æ¶ˆæ¯æ¨¡å—\r\n * - å­˜å‚¨æ¯ä¸ªè”ç³»äººæˆ–ç¾¤ç»„çš„æ¶ˆæ¯åˆ—è¡¨\r\n * - ç®¡ç†æ¯ä¸ªä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ•°é‡\r\n */\nimport Vue from 'vue';\nexport default {\n  namespaced: true,\n  state: {\n    messageMap: {},\n    // { contactId: [message, ...] } æ¯ä¸ªä¼šè¯çš„æ¶ˆæ¯åˆ—è¡¨\n    unreadMap: {},\n    // { contactId: unreadCount } æ¯ä¸ªä¼šè¯çš„æœªè¯»æ•°\n    userList: [] // âœ… å½“å‰ç”¨æˆ·çš„è”ç³»äºº/åœ¨çº¿ç”¨æˆ·åˆ—è¡¨\n  },\n  mutations: {\n    /**\r\n     * âœ… è®¾ç½®ç”¨æˆ·åˆ—è¡¨\r\n     * @param {Array} users ç”¨æˆ·æ•°ç»„\r\n     */\n    SET_USER_LIST(state, users) {\n      console.log('[Vuex:message] ðŸ‘¥ è®¾ç½®ç”¨æˆ·åˆ—è¡¨:', users);\n      state.userList = users;\n    },\n    /**\r\n     * âœ… æ¸…ç©ºç”¨æˆ·åˆ—è¡¨\r\n     */\n    CLEAR_USER_LIST(state) {\n      console.warn('[Vuex:message] âš ï¸ æ¸…ç©ºç”¨æˆ·åˆ—è¡¨');\n      state.userList = [];\n    },\n    /**\r\n     * âœ… å‘æŸä¸ªä¼šè¯è¿½åŠ ä¸€æ¡æ¶ˆæ¯\r\n     * @param {String} contactId ä¼šè¯ IDï¼ˆç”¨æˆ·ID æˆ– ç¾¤IDï¼‰\r\n     * @param {Object} message æ¶ˆæ¯å¯¹è±¡\r\n     */\n    ADD_MESSAGE(state, {\n      contactId,\n      message\n    }) {\n      if (!state.messageMap[contactId]) {\n        console.log(`[Vuex:message] åˆå§‹åŒ–ä¼šè¯æ¶ˆæ¯åˆ—è¡¨: ${contactId}`);\n        Vue.set(state.messageMap, contactId, []); // âœ… å“åº”å¼æ–°å¢ž key\n      }\n      console.log(`[Vuex:message] âž• æ·»åŠ æ¶ˆæ¯åˆ° ${contactId}:`, message);\n      state.messageMap[contactId].push(message);\n    },\n    /**\r\n     * âœ… æŒ‡å®šä¼šè¯æœªè¯»æ•° +1\r\n     * @param {String} contactId ä¼šè¯ ID\r\n     */\n    INCREMENT_UNREAD(state, contactId) {\n      if (!state.unreadMap[contactId]) {\n        console.log(`[Vuex:message] åˆå§‹åŒ–æœªè¯»è®¡æ•°: ${contactId}`);\n        state.unreadMap[contactId] = 0;\n      }\n      state.unreadMap[contactId]++;\n      console.log(`[Vuex:message] ðŸ”´ æœªè¯»æ•° +1 (${contactId}):`, state.unreadMap[contactId]);\n    },\n    /**\r\n     * âœ… é‡ç½®æŒ‡å®šä¼šè¯æœªè¯»æ¶ˆæ¯æ•°ä¸º 0ï¼ˆå·²è¯»ï¼‰\r\n     * @param {String} contactId ä¼šè¯ ID\r\n     */\n    RESET_UNREAD(state, contactId) {\n      console.log(`[Vuex:message] âœ… æ¸…é™¤æœªè¯»æ•°: ${contactId}`);\n      state.unreadMap[contactId] = 0;\n    },\n    /**\r\n     * âœ… æ¸…ç©ºæŒ‡å®šä¼šè¯æ‰€æœ‰æ¶ˆæ¯\r\n     * @param {String} contactId ä¼šè¯ ID\r\n     */\n    CLEAR_MESSAGES(state, contactId) {\n      console.warn(`[Vuex:message] âš ï¸ æ¸…ç©ºæ¶ˆæ¯: ${contactId}`);\n      state.messageMap[contactId] = [];\n    }\n  },\n  getters: {\n    /**\r\n     * âœ… èŽ·å–ç”¨æˆ·åˆ—è¡¨\r\n     */\n    getUserList: state => {\n      return state.userList;\n    },\n    /**\r\n     * ðŸŸ¢ èŽ·å–æŒ‡å®šä¼šè¯çš„æ¶ˆæ¯æ•°ç»„\r\n     */\n    getMessages: state => contactId => {\n      return state.messageMap[contactId] || [];\n    },\n    /**\r\n     * ðŸŸ¡ èŽ·å–æŒ‡å®šä¼šè¯çš„æœªè¯»æ•°\r\n     */\n    getUnread: state => contactId => {\n      return state.unreadMap[contactId] || 0;\n    },\n    /**\r\n     * ðŸ”´ èŽ·å–æ‰€æœ‰ä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ€»å’Œ\r\n     */\n    getTotalUnread: state => {\n      const total = Object.values(state.unreadMap).reduce((a, b) => a + b, 0);\n      console.log(`[Vuex:message] ðŸ”¢ æ€»æœªè¯»æ•°: ${total}`);\n      return total;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}