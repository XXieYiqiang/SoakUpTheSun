{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\n// ‚ö†Ô∏è ËØ∑Ê†πÊçÆÊÇ®ÁöÑ Go ÂêéÁ´ØÂÆûÈôÖÂú∞ÂùÄ‰øÆÊîπÊ≠§Â§ÑÁöÑ IP ÂíåÁ´ØÂè£\nconst WS_URL = 'ws://localhost:8080';\nvar _default = exports.default = {\n  name: 'WebRTCView',\n  data() {\n    return {\n      // ================= WebRTC (SFU Ê®°Âºè) =================\n      upPC: null,\n      // ‰∏äË°å PeerConnection (ÂèëÂ∏É/Êé®ÊµÅ)\n      downPC: null,\n      // ‰∏ãË°å PeerConnection (ËÆ¢ÈòÖ/ÊãâÊµÅ)\n      localStream: null,\n      // Êú¨Âú∞Â™í‰ΩìÊµÅ\n\n      // ================= WebSocket ‰ø°‰ª§ =================\n      ws: null,\n      wsStatus: 'Êú™ËøûÊé•',\n      // ‰ΩøÁî®ÈöèÊú∫ IDÔºåÁ°Æ‰øùÂ§öÊ†áÁ≠æÈ°µÊµãËØïÊó∂ÁöÑÂîØ‰∏ÄÊÄß\n      userId: 'client-' + Math.random().toString(36).slice(2, 8),\n      roomID: 'B5rQGQGUgVJohwX9EjwrjY',\n      // ‚ö†Ô∏è ËØ∑Á°Æ‰øùÂíå Go ÂêéÁ´Ø‰ΩøÁî®ÁöÑ roomID ÂåπÈÖç\n      isPublisher: false,\n      // Ê†áËÆ∞ÂΩìÂâçÊòØÂê¶Ê≠£Âú®ÂèëÂ∏É‰∏≠\n\n      // Â≠òÂÇ®ÊâÄÊúâËÆ¢ÈòÖÊµÅ Key: PublisherID, Value: MediaStream\n      downStreams: new Map(),\n      onlinePublishers: {},\n      // ÊàøÈó¥ÂÜÖÂú®Á∫øÁî®Êà∑/ÂèëÂ∏ÉËÄÖÂàóË°® (Áî®‰∫é UI Â±ïÁ§∫)\n\n      iceServers: {\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      }\n    };\n  },\n  mounted() {\n    this.initSignalWS();\n    this.initMedia();\n  },\n  methods: {\n    /* ================= ‰ø°‰ª§ WS & ÊàøÈó¥ÁÆ°ÁêÜ ================= */\n    initSignalWS() {\n      // ‰∏•Ê†ºÂåπÈÖçÂêéÁ´Ø Go ÁöÑË∑ØÁî±ÂíåÂèÇÊï∞\n      this.ws = new WebSocket(`${WS_URL}/room/join?uid=${this.userId}&roomID=${this.roomID}`);\n      this.ws.onopen = () => {\n        this.wsStatus = 'Â∑≤ËøûÊé•';\n        console.log('üì° ‰ø°‰ª§ WS Â∑≤ËøûÊé•, userId=', this.userId);\n      };\n      this.ws.onmessage = async e => {\n        try {\n          const rawMsg = JSON.parse(e.data);\n          console.log('‚¨ÖÔ∏è Êî∂Âà∞ SFU ‰ø°‰ª§:', rawMsg.event, rawMsg.data);\n          await this.handleSignal(rawMsg);\n        } catch (error) {\n          console.error('‰ø°‰ª§Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', error, e.data);\n        }\n      };\n      this.ws.onclose = () => {\n        this.wsStatus = 'Â∑≤Êñ≠ÂºÄ';\n        // ‚ö†Ô∏è ÂΩì WS Ë¢´Âä®Êñ≠ÂºÄÊó∂ÔºåÊâßË°åÂÆåÊï¥ÁöÑÊ∏ÖÁêÜ\n        this.hangup(true);\n      };\n      this.ws.onerror = err => {\n        this.wsStatus = 'ÈîôËØØ';\n        console.error('WebSocket ÈîôËØØ:', err);\n      };\n    },\n    sendSignal(event, data) {\n      if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n        const message = {\n          event: event,\n          data: data\n        };\n        this.ws.send(JSON.stringify(message));\n      } else {\n        console.warn('WebSocket Êú™ËøûÊé•ÔºåÊó†Ê≥ïÂèëÈÄÅ‰ø°‰ª§:', event);\n      }\n    },\n    /* ================= Â™í‰ΩìÂàùÂßãÂåñ ================= */\n    async initMedia() {\n      if (this.localStream) return;\n      try {\n        this.localStream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (this.$refs.localVideo) {\n          // Â¢ûÂä†ÂÆâÂÖ®Ê£ÄÊü•\n          this.$refs.localVideo.srcObject = this.localStream;\n        }\n      } catch (error) {\n        console.error(\"Ëé∑ÂèñÂ™í‰ΩìÊµÅÂ§±Ë¥•:\", error);\n      }\n    },\n    /* ================= ÂèëÂ∏ÉËÄÖ (UpPC) ÊµÅÁ®ã ================= */\n    createUpPeerConnection() {\n      if (this.upPC) {\n        this.upPC.close();\n      }\n      this.upPC = new RTCPeerConnection(this.iceServers);\n\n      // 1. Ê∑ªÂä†Êú¨Âú∞ËΩ®ÈÅì\n      this.localStream.getTracks().forEach(track => {\n        this.upPC.addTrack(track, this.localStream);\n      });\n\n      // 2. ICE candidate ÁîüÊàêÊó∂ÂèëÈÄÅÁªô SFU (up_candidate)\n      this.upPC.onicecandidate = e => {\n        if (e.candidate) {\n          this.sendSignal('up_candidate', {\n            candidate: e.candidate.toJSON()\n          });\n        }\n      };\n\n      // 3. ÁõëÂê¨ËøûÊé•Áä∂ÊÄÅ\n      this.upPC.onconnectionstatechange = () => {\n        console.log(`‚¨ÜÔ∏è UpPC Áä∂ÊÄÅ: ${this.upPC.connectionState}`);\n        if (this.upPC.connectionState === 'connected') {\n          this.$set(this.onlinePublishers, this.userId, 'Â∑≤ÂèëÂ∏É (ËøûÊé•ÊàêÂäü)');\n        } else if (this.upPC.connectionState === 'failed' || this.upPC.connectionState === 'closed') {\n          this.$set(this.onlinePublishers, this.userId, 'ÂèëÂ∏ÉÂ§±Ë¥•/ÂÖ≥Èó≠');\n        }\n      };\n    },\n    async startPublish() {\n      if (this.isPublisher) return;\n      if (!this.localStream) {\n        await this.initMedia();\n        if (!this.localStream) return;\n      }\n      this.createUpPeerConnection();\n\n      // 1. ÂàõÂª∫ offer\n      const offer = await this.upPC.createOffer();\n      await this.upPC.setLocalDescription(offer);\n      console.log('‚û°Ô∏è ÂèëÈÄÅ up_offer (Local SDP):', offer.sdp);\n\n      // 2. ÂèëÈÄÅ up_offer Áªô SFU\n      this.sendSignal('up_offer', {\n        uid: this.userId,\n        sdp: offer.sdp\n      });\n      this.isPublisher = true;\n    },\n    /* ================= ËÆ¢ÈòÖËÄÖ (DownPC) ÊµÅÁ®ã ================= */\n    createDownPeerConnection() {\n      if (this.downPC) {\n        return; // DownPC Âè™ÈúÄË¶ÅÂàõÂª∫‰∏ÄÊ¨°\n      }\n      this.downPC = new RTCPeerConnection(this.iceServers);\n\n      // 1. ÁõëÂê¨ËøúÁ´ØÊµÅÔºàontrack ‰øÆÊ≠£Ôºå‰øùËØÅ Stream ID ‰Ωú‰∏∫ KeyÔºâ\n      this.downPC.ontrack = e => {\n        const remoteStream = e.streams[0];\n        // üö® ‰æùËµñ SFU ÂêéÁ´ØÂ∞ÜÂèëÂ∏ÉËÄÖ UID ‰Ωú‰∏∫ Stream ID Ê≥®ÂÖ• SDP\n        const pubId = remoteStream.id;\n        if (!pubId) {\n          console.error('Ontrack Êî∂Âà∞Êó† Stream ID ÁöÑÊµÅÔºåÊó†Ê≥ïÁªëÂÆöÔºÅ');\n          return;\n        }\n        console.log('üéØ Êî∂Âà∞ËøúÁ´ØÊµÅ (DownPC), Stream ID:', pubId, 'Track Kind:', e.track.kind);\n\n        // Â¶ÇÊûúÊòØÊñ∞ÁöÑ StreamÔºåÂ≠òÂÖ• Map\n        if (!this.downStreams.has(pubId)) {\n          this.downStreams.set(pubId, remoteStream);\n          // Âº∫Âà∂ Vue Âà∑Êñ∞ Map (Vue 2 ÈúÄË¶ÅËøôÁßçÊñπÂºèËß¶ÂèëÊõ¥Êñ∞)\n          this.downStreams = new Map(this.downStreams);\n        }\n\n        // Á°Æ‰øù Vue Ê∏≤ÊüìÂô®Êõ¥Êñ∞Âπ∂ÊåáÂêëÊ≠£Á°ÆÁöÑÊµÅ\n        this.$nextTick(() => {\n          // `$refs` Êï∞ÁªÑ‰∏ãÊ†á `[0]` ËÆøÈóÆ v-for Âä®ÊÄÅÁîüÊàêÁöÑÂÖÉÁ¥†\n          const videoEl = this.$refs[`remoteVideo-${pubId}`];\n          if (videoEl && videoEl[0] && videoEl[0].srcObject !== remoteStream) {\n            videoEl[0].srcObject = remoteStream;\n            console.log(`‚úÖ ËßÜÈ¢ëÂÖÉÁ¥†ÁªëÂÆöÊàêÂäü: ${pubId}`);\n          }\n        });\n      };\n\n      // 2. ICE candidate ÁîüÊàêÊó∂ÂèëÈÄÅÁªô SFU (down_candidate)\n      this.downPC.onicecandidate = e => {\n        if (e.candidate) {\n          this.sendSignal('down_candidate', {\n            candidate: e.candidate.toJSON()\n          });\n        }\n      };\n\n      // 3. ÁõëÂê¨ËøûÊé•Áä∂ÊÄÅ\n      this.downPC.onconnectionstatechange = () => {\n        console.log(`‚¨áÔ∏è DownPC Áä∂ÊÄÅ: ${this.downPC.connectionState}`);\n      };\n    },\n    async handleDownOffer(payload) {\n      this.createDownPeerConnection();\n\n      // 1. ËÆæÁΩÆ SFU ÂèëÊù•ÁöÑ Offer ‰∏∫ËøúÁ´ØÊèèËø∞\n      await this.downPC.setRemoteDescription(new RTCSessionDescription({\n        type: 'offer',\n        sdp: payload.sdp\n      }));\n\n      // 2. ÂàõÂª∫ Answer\n      const answer = await this.downPC.createAnswer();\n      await this.downPC.setLocalDescription(answer);\n      console.log('‚û°Ô∏è ÂèëÈÄÅ down_answer (Local SDP):', answer.sdp);\n\n      // 3. ÂèëÈÄÅ down_answer Áªô SFU\n      this.sendSignal('down_answer', {\n        sdp: answer.sdp\n      });\n\n      // Êõ¥Êñ∞ UI ÂàóË°®ÔºåÊ†áËÆ∞ËØ•ÂèëÂ∏ÉËÄÖÊ≠£Âú®Ë¢´ËÆ¢ÈòÖ\n      if (payload.from) {\n        this.$set(this.onlinePublishers, payload.from, 'Ê≠£Âú®ËÆ¢ÈòÖ');\n      }\n    },\n    /* ================= ÊµÅÁßªÈô§Â§ÑÁêÜ (Êñ∞Â¢ûÊ†∏ÂøÉ‰øÆÂ§ç) ================= */\n    handleStreamRemoval(publisherId) {\n      console.log(`‚ùå Êî∂Âà∞ÊµÅÁßªÈô§ÈÄöÁü•, Publisher ID: ${publisherId}`);\n\n      // 1. ÂÅúÊ≠¢ MediaStream Track Âπ∂ÁßªÈô§ Map ‰∏≠ÁöÑ Stream\n      if (this.downStreams.has(publisherId)) {\n        const streamToStop = this.downStreams.get(publisherId);\n        streamToStop.getTracks().forEach(track => track.stop());\n        this.downStreams.delete(publisherId);\n        this.downStreams = new Map(this.downStreams); // Âº∫Âà∂ Vue Êõ¥Êñ∞\n        console.log(`‚úÖ Â∑≤‰ªé downStreams ‰∏≠ÁßªÈô§ÊµÅ: ${publisherId}`);\n      }\n\n      // 2. Êõ¥Êñ∞ UI ÂàóË°®\n      // ÁßªÈô§ÂèëÂ∏ÉËÄÖÁä∂ÊÄÅÔºà‰ΩÜÂ¶ÇÊûúËØ•Áî®Êà∑ËøòÊ≤°Á¶ªÂºÄÊàøÈó¥ÔºåÂèØ‰ª•ËÆæ‰∏∫'Âú®Á∫ø/Êú™ÂèëÂ∏É'Ôºâ\n      this.$delete(this.onlinePublishers, publisherId);\n    },\n    /* ================= ‰ø°‰ª§Â§ÑÁêÜ‰∏≠ÂøÉ ================= */\n    async handleSignal(msg) {\n      const event = msg.event;\n      let dataPayload = null;\n      try {\n        if (msg.data) {\n          // Go ÊúçÂä°Âô®‰ΩøÁî® json.RawMessageÔºåÂâçÁ´ØÈúÄË¶ÅÂÜçÊ¨°Ëß£Êûê data Â≠óÊÆµ\n          dataPayload = typeof msg.data === 'string' ? JSON.parse(msg.data) : msg.data;\n        }\n        switch (event) {\n          case 'up_answer':\n            if (!this.upPC) {\n              console.error(\"UpPC‰∏çÂ≠òÂú®\");\n              return;\n            }\n            await this.upPC.setRemoteDescription(new RTCSessionDescription({\n              type: 'answer',\n              sdp: dataPayload.sdp\n            }));\n            console.log('‚úÖ UpPC ËøûÊé•ÊàêÂäüÔºÅ');\n            break;\n          case 'down_offer':\n            // SFU ÂèëÊù•Êñ∞ÁöÑ Offer (ÂèØËÉΩÂåÖÂê´Êñ∞ÁöÑ Track)\n            await this.handleDownOffer(dataPayload);\n            break;\n          case 'unpublish_stream':\n            // „ÄêÊñ∞Â¢ûÂ§ÑÁêÜ„Äë\n            if (dataPayload && dataPayload.publisherId) {\n              this.handleStreamRemoval(dataPayload.publisherId);\n            }\n            break;\n          case 'up_candidate':\n          case 'down_candidate':\n            // Candidate ÁöÑ JSON ÁªìÊûÑ‰∏é RTCIceCandidateInit ÂÖºÂÆπ\n            if (dataPayload && dataPayload.candidate) {\n              const candidate = new RTCIceCandidate(dataPayload.candidate);\n              let targetPC = null;\n              if (event === 'up_candidate') {\n                targetPC = this.upPC;\n              } else if (event === 'down_candidate') {\n                targetPC = this.downPC;\n              }\n              if (targetPC && targetPC.remoteDescription) {\n                await targetPC.addIceCandidate(candidate);\n                // console.log(`‚úÖ ${event} Candidate Ê∑ªÂä†ÊàêÂäü`);\n              } else if (targetPC) {\n                // ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÔºåÈúÄË¶ÅÁºìÂÜ≤ candidate Áõ¥Âà∞ setRemoteDescription ÂÆåÊàê\n                // console.warn(`‚ö†Ô∏è ÁºìÂÜ≤ ${event} Candidate`);\n              }\n            }\n            break;\n\n          // ÂÅáËÆæÂêéÁ´ØÊ≤°Êúâ user_join/leaveÔºå‰ªÖÈÄöËøáÂèëÂ∏ÉÁä∂ÊÄÅÂèòÂåñÊù•Êõ¥Êñ∞ UI\n          case 'user_join':\n          case 'user_leave':\n            // ‰øùÊåÅÁé∞ÊúâÈÄªËæëÔºåÂ¶ÇÊûúÊÇ®ÁöÑÂêéÁ´ØÂÆûÁé∞‰∫ÜËøô‰∫õ‰∫ã‰ª∂\n            this.handleUserStatusUpdate(event, dataPayload);\n            break;\n          default:\n            console.warn('Êú™Áü• SFU ‰ø°‰ª§‰∫ã‰ª∂:', event);\n        }\n      } catch (e) {\n        console.error(`Â§ÑÁêÜ ${event} Ê∂àÊÅØÂ§±Ë¥•:`, e);\n      }\n    },\n    handleUserStatusUpdate(event, payload) {\n      // ËøôÊòØ‰∏Ä‰∏™Âç†‰ΩçÂáΩÊï∞ÔºåÂ¶ÇÊûúÊÇ®ÂêéÁ´ØÊú™ÂÆûÁé∞Ê≠§ÂäüËÉΩÔºåÂèØÂà†Èô§ÊàñÂøΩÁï•\n      if (event === 'user_join' && payload.uid !== this.userId) {\n        this.$set(this.onlinePublishers, payload.uid, 'Âú®Á∫ø/Êú™ÂèëÂ∏É');\n      } else if (event === 'user_leave') {\n        this.$delete(this.onlinePublishers, payload.uid);\n        this.handleStreamRemoval(payload.uid); // Á°Æ‰øùÁ¶ªÂºÄÊó∂‰πüÁßªÈô§ÊµÅ\n      }\n    },\n    /* ================= ÊåÇÊñ≠/Ê∏ÖÁêÜ (ÂÆåÂÖ®ÈÄÄÂá∫ÊàøÈó¥) ================= */\n    hangup(isPassive = false) {\n      if (!isPassive) {\n        // ‰ªÖÂú®‰∏ªÂä®ÊåÇÊñ≠Êó∂ÂèëÈÄÅ unpublish ‰ø°‰ª§\n        if (this.isPublisher) {\n          this.sendSignal('unpublish', {\n            uid: this.userId\n          });\n        }\n        // ‰∏ªÂä®ÊåÇÊñ≠Êó∂ÔºåÂÖ≥Èó≠ WS ËøûÊé•ÔºåËøô‰πü‰ºöËß¶Âèë onclose -> hangup(true)\n        if (this.ws) {\n          this.ws.close();\n          this.ws = null;\n        }\n      }\n\n      // ÂÖ≥Èó≠ PeerConnections\n      if (this.upPC) {\n        this.upPC.close();\n        this.upPC = null;\n      }\n      if (this.downPC) {\n        this.downPC.close();\n        this.downPC = null;\n      }\n\n      // ÂÅúÊ≠¢Êú¨Âú∞ÊµÅ\n      if (this.localStream) {\n        this.localStream.getTracks().forEach(t => t.stop());\n        this.localStream = null;\n      }\n\n      // Ê∏ÖÁêÜ UI Áä∂ÊÄÅ (Ëß£ÂÜ≥ TypeError: Cannot set properties of undefined)\n      if (this.$refs.localVideo) {\n        this.$refs.localVideo.srcObject = null;\n      }\n      this.downStreams = new Map(); // Ê∏ÖÁ©∫ÊâÄÊúâËøúÁ´ØÊµÅ\n      this.isPublisher = false;\n      this.$delete(this.onlinePublishers, this.userId); // Ê∏ÖÁêÜËá™Â∑±ÂèëÂ∏ÉÁöÑËÆ∞ÂΩï\n\n      console.log('‚òéÔ∏è Â∑≤ÊåÇÊñ≠/ÈÄÄÂá∫ÊàøÈó¥');\n    }\n  },\n  beforeDestroy() {\n    this.hangup(true); // Âú®ÁªÑ‰ª∂ÈîÄÊØÅÂâçÊâßË°åÊúÄÁªàÊ∏ÖÁêÜ\n  }\n};","map":{"version":3,"names":["WS_URL","_default","exports","default","name","data","upPC","downPC","localStream","ws","wsStatus","userId","Math","random","toString","slice","roomID","isPublisher","downStreams","Map","onlinePublishers","iceServers","urls","mounted","initSignalWS","initMedia","methods","WebSocket","onopen","console","log","onmessage","e","rawMsg","JSON","parse","event","handleSignal","error","onclose","hangup","onerror","err","sendSignal","readyState","OPEN","message","send","stringify","warn","navigator","mediaDevices","getUserMedia","video","audio","$refs","localVideo","srcObject","createUpPeerConnection","close","RTCPeerConnection","getTracks","forEach","track","addTrack","onicecandidate","candidate","toJSON","onconnectionstatechange","connectionState","$set","startPublish","offer","createOffer","setLocalDescription","sdp","uid","createDownPeerConnection","ontrack","remoteStream","streams","pubId","id","kind","has","set","$nextTick","videoEl","handleDownOffer","payload","setRemoteDescription","RTCSessionDescription","type","answer","createAnswer","from","handleStreamRemoval","publisherId","streamToStop","get","stop","delete","$delete","msg","dataPayload","RTCIceCandidate","targetPC","remoteDescription","addIceCandidate","handleUserStatusUpdate","isPassive","t","beforeDestroy"],"sources":["src/views/utils/test2.vue"],"sourcesContent":["<template>\r\n  <div class=\"webrtc-container\">\r\n    <h2>üé• WebRTC SFU Demo</h2>\r\n\r\n    <div class=\"video-box\">\r\n      <div class=\"video-item\">\r\n        <h3>Êú¨Âú∞ËßÜÈ¢ë (ID: {{ userId }})</h3>\r\n        <video ref=\"localVideo\" autoplay muted playsinline></video>\r\n      </div>\r\n      <div v-for=\"([pubId, stream]) in downStreams.entries()\" :key=\"pubId\" class=\"video-item\">\r\n        <h3>ËøúÁ®ãÊµÅ (ID: {{ pubId }})</h3>\r\n        <video :ref=\"'remoteVideo-' + pubId\" autoplay playsinline :srcObject=\"stream\"></video>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"actions\">\r\n      <el-button type=\"primary\" :disabled=\"isPublisher\" @click=\"startPublish\">ÂèëÂ∏ÉÊàëÁöÑÊµÅ</el-button>\r\n      <el-button type=\"danger\" @click=\"hangup\">ÂÅúÊ≠¢ÂèëÂ∏É / ÊåÇÊñ≠ (ÈÄÄÂá∫ÊàøÈó¥)</el-button>\r\n    </div>\r\n\r\n    <div class=\"online-users-box\">\r\n      <h3>üë• ÊàøÈó¥ÂÜÖÂèëÂ∏ÉËÄÖ/Áî®Êà∑Áä∂ÊÄÅ</h3>\r\n      <div v-if=\"Object.keys(onlinePublishers).length === 0\">ÊöÇÊó†ÂÖ∂‰ªñÁî®Êà∑</div>\r\n      <ul v-else>\r\n        <li v-for=\"(status, user) in onlinePublishers\" :key=\"user\">\r\n          Áî®Êà∑ ID: **{{ user }}** - Áä∂ÊÄÅ: {{ status }}\r\n        </li>\r\n      </ul>\r\n    </div>\r\n\r\n    <pre>WebSocket Áä∂ÊÄÅ: {{ wsStatus }}</pre>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// ‚ö†Ô∏è ËØ∑Ê†πÊçÆÊÇ®ÁöÑ Go ÂêéÁ´ØÂÆûÈôÖÂú∞ÂùÄ‰øÆÊîπÊ≠§Â§ÑÁöÑ IP ÂíåÁ´ØÂè£\r\nconst WS_URL = 'ws://localhost:8080'; \r\n\r\nexport default {\r\n  name: 'WebRTCView',\r\n\r\n  data() {\r\n    return {\r\n      // ================= WebRTC (SFU Ê®°Âºè) =================\r\n      upPC: null,         // ‰∏äË°å PeerConnection (ÂèëÂ∏É/Êé®ÊµÅ)\r\n      downPC: null,       // ‰∏ãË°å PeerConnection (ËÆ¢ÈòÖ/ÊãâÊµÅ)\r\n      localStream: null,  // Êú¨Âú∞Â™í‰ΩìÊµÅ\r\n\r\n      // ================= WebSocket ‰ø°‰ª§ =================\r\n      ws: null,\r\n      wsStatus: 'Êú™ËøûÊé•',\r\n      // ‰ΩøÁî®ÈöèÊú∫ IDÔºåÁ°Æ‰øùÂ§öÊ†áÁ≠æÈ°µÊµãËØïÊó∂ÁöÑÂîØ‰∏ÄÊÄß\r\n      userId: 'client-' + Math.random().toString(36).slice(2, 8),\r\n      roomID: 'B5rQGQGUgVJohwX9EjwrjY', // ‚ö†Ô∏è ËØ∑Á°Æ‰øùÂíå Go ÂêéÁ´Ø‰ΩøÁî®ÁöÑ roomID ÂåπÈÖç\r\n      isPublisher: false, // Ê†áËÆ∞ÂΩìÂâçÊòØÂê¶Ê≠£Âú®ÂèëÂ∏É‰∏≠\r\n\r\n      // Â≠òÂÇ®ÊâÄÊúâËÆ¢ÈòÖÊµÅ Key: PublisherID, Value: MediaStream\r\n      downStreams: new Map(),\r\n      onlinePublishers: {}, // ÊàøÈó¥ÂÜÖÂú®Á∫øÁî®Êà∑/ÂèëÂ∏ÉËÄÖÂàóË°® (Áî®‰∫é UI Â±ïÁ§∫)\r\n\r\n      iceServers: {\r\n        iceServers: [\r\n          { urls: 'stun:stun.l.google.com:19302' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    this.initSignalWS()\r\n    this.initMedia()\r\n  },\r\n\r\n  methods: {\r\n    /* ================= ‰ø°‰ª§ WS & ÊàøÈó¥ÁÆ°ÁêÜ ================= */\r\n    initSignalWS() {\r\n      // ‰∏•Ê†ºÂåπÈÖçÂêéÁ´Ø Go ÁöÑË∑ØÁî±ÂíåÂèÇÊï∞\r\n      this.ws = new WebSocket(`${WS_URL}/room/join?uid=${this.userId}&roomID=${this.roomID}`)\r\n\r\n      this.ws.onopen = () => {\r\n        this.wsStatus = 'Â∑≤ËøûÊé•';\r\n        console.log('üì° ‰ø°‰ª§ WS Â∑≤ËøûÊé•, userId=', this.userId)\r\n      }\r\n\r\n      this.ws.onmessage = async e => {\r\n        try {\r\n          const rawMsg = JSON.parse(e.data)\r\n          console.log('‚¨ÖÔ∏è Êî∂Âà∞ SFU ‰ø°‰ª§:', rawMsg.event, rawMsg.data)\r\n          await this.handleSignal(rawMsg)\r\n        } catch (error) {\r\n          console.error('‰ø°‰ª§Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', error, e.data)\r\n        }\r\n      }\r\n\r\n      this.ws.onclose = () => {\r\n        this.wsStatus = 'Â∑≤Êñ≠ÂºÄ';\r\n        // ‚ö†Ô∏è ÂΩì WS Ë¢´Âä®Êñ≠ÂºÄÊó∂ÔºåÊâßË°åÂÆåÊï¥ÁöÑÊ∏ÖÁêÜ\r\n        this.hangup(true); \r\n      }\r\n      this.ws.onerror = (err) => {\r\n        this.wsStatus = 'ÈîôËØØ';\r\n        console.error('WebSocket ÈîôËØØ:', err);\r\n      }\r\n    },\r\n\r\n    sendSignal(event, data) {\r\n      if (this.ws && this.ws.readyState === WebSocket.OPEN) {\r\n        const message = {\r\n          event: event,\r\n          data: data \r\n        }\r\n        this.ws.send(JSON.stringify(message))\r\n      } else {\r\n        console.warn('WebSocket Êú™ËøûÊé•ÔºåÊó†Ê≥ïÂèëÈÄÅ‰ø°‰ª§:', event)\r\n      }\r\n    },\r\n\r\n    /* ================= Â™í‰ΩìÂàùÂßãÂåñ ================= */\r\n    async initMedia() {\r\n      if (this.localStream) return\r\n      try {\r\n        this.localStream = await navigator.mediaDevices.getUserMedia({\r\n          video: true,\r\n          audio: true\r\n        })\r\n        if (this.$refs.localVideo) { // Â¢ûÂä†ÂÆâÂÖ®Ê£ÄÊü•\r\n             this.$refs.localVideo.srcObject = this.localStream\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Ëé∑ÂèñÂ™í‰ΩìÊµÅÂ§±Ë¥•:\", error)\r\n      }\r\n    },\r\n\r\n    /* ================= ÂèëÂ∏ÉËÄÖ (UpPC) ÊµÅÁ®ã ================= */\r\n    createUpPeerConnection() {\r\n      if (this.upPC) {\r\n        this.upPC.close()\r\n      }\r\n      this.upPC = new RTCPeerConnection(this.iceServers)\r\n\r\n      // 1. Ê∑ªÂä†Êú¨Âú∞ËΩ®ÈÅì\r\n      this.localStream.getTracks().forEach(track => {\r\n        this.upPC.addTrack(track, this.localStream)\r\n      })\r\n\r\n      // 2. ICE candidate ÁîüÊàêÊó∂ÂèëÈÄÅÁªô SFU (up_candidate)\r\n      this.upPC.onicecandidate = e => {\r\n        if (e.candidate) {\r\n          this.sendSignal('up_candidate', { candidate: e.candidate.toJSON() })\r\n        }\r\n      }\r\n\r\n      // 3. ÁõëÂê¨ËøûÊé•Áä∂ÊÄÅ\r\n      this.upPC.onconnectionstatechange = () => {\r\n        console.log(`‚¨ÜÔ∏è UpPC Áä∂ÊÄÅ: ${this.upPC.connectionState}`)\r\n        if (this.upPC.connectionState === 'connected') {\r\n            this.$set(this.onlinePublishers, this.userId, 'Â∑≤ÂèëÂ∏É (ËøûÊé•ÊàêÂäü)');\r\n        } else if (this.upPC.connectionState === 'failed' || this.upPC.connectionState === 'closed') {\r\n             this.$set(this.onlinePublishers, this.userId, 'ÂèëÂ∏ÉÂ§±Ë¥•/ÂÖ≥Èó≠');\r\n        }\r\n      }\r\n    },\r\n\r\n    async startPublish() {\r\n      if (this.isPublisher) return;\r\n\r\n      if (!this.localStream) {\r\n        await this.initMedia()\r\n        if (!this.localStream) return;\r\n      }\r\n      this.createUpPeerConnection()\r\n\r\n      // 1. ÂàõÂª∫ offer\r\n      const offer = await this.upPC.createOffer()\r\n      await this.upPC.setLocalDescription(offer)\r\n\r\n      console.log('‚û°Ô∏è ÂèëÈÄÅ up_offer (Local SDP):', offer.sdp)\r\n\r\n      // 2. ÂèëÈÄÅ up_offer Áªô SFU\r\n      this.sendSignal('up_offer', { uid: this.userId, sdp: offer.sdp })\r\n      this.isPublisher = true\r\n    },\r\n\r\n    /* ================= ËÆ¢ÈòÖËÄÖ (DownPC) ÊµÅÁ®ã ================= */\r\n    createDownPeerConnection() {\r\n      if (this.downPC) {\r\n        return // DownPC Âè™ÈúÄË¶ÅÂàõÂª∫‰∏ÄÊ¨°\r\n      }\r\n\r\n      this.downPC = new RTCPeerConnection(this.iceServers)\r\n\r\n      // 1. ÁõëÂê¨ËøúÁ´ØÊµÅÔºàontrack ‰øÆÊ≠£Ôºå‰øùËØÅ Stream ID ‰Ωú‰∏∫ KeyÔºâ\r\n      this.downPC.ontrack = e => {\r\n        const remoteStream = e.streams[0];\r\n        // üö® ‰æùËµñ SFU ÂêéÁ´ØÂ∞ÜÂèëÂ∏ÉËÄÖ UID ‰Ωú‰∏∫ Stream ID Ê≥®ÂÖ• SDP\r\n        const pubId = remoteStream.id; \r\n\r\n        if (!pubId) {\r\n            console.error('Ontrack Êî∂Âà∞Êó† Stream ID ÁöÑÊµÅÔºåÊó†Ê≥ïÁªëÂÆöÔºÅ');\r\n            return;\r\n        }\r\n\r\n        console.log('üéØ Êî∂Âà∞ËøúÁ´ØÊµÅ (DownPC), Stream ID:', pubId, 'Track Kind:', e.track.kind);\r\n\r\n        // Â¶ÇÊûúÊòØÊñ∞ÁöÑ StreamÔºåÂ≠òÂÖ• Map\r\n        if (!this.downStreams.has(pubId)) {\r\n          this.downStreams.set(pubId, remoteStream);\r\n          // Âº∫Âà∂ Vue Âà∑Êñ∞ Map (Vue 2 ÈúÄË¶ÅËøôÁßçÊñπÂºèËß¶ÂèëÊõ¥Êñ∞)\r\n          this.downStreams = new Map(this.downStreams);\r\n        }\r\n        \r\n        // Á°Æ‰øù Vue Ê∏≤ÊüìÂô®Êõ¥Êñ∞Âπ∂ÊåáÂêëÊ≠£Á°ÆÁöÑÊµÅ\r\n        this.$nextTick(() => {\r\n          // `$refs` Êï∞ÁªÑ‰∏ãÊ†á `[0]` ËÆøÈóÆ v-for Âä®ÊÄÅÁîüÊàêÁöÑÂÖÉÁ¥†\r\n          const videoEl = this.$refs[`remoteVideo-${pubId}`];\r\n          if (videoEl && videoEl[0] && videoEl[0].srcObject !== remoteStream) {\r\n            videoEl[0].srcObject = remoteStream;\r\n            console.log(`‚úÖ ËßÜÈ¢ëÂÖÉÁ¥†ÁªëÂÆöÊàêÂäü: ${pubId}`);\r\n          }\r\n        });\r\n      };\r\n\r\n      // 2. ICE candidate ÁîüÊàêÊó∂ÂèëÈÄÅÁªô SFU (down_candidate)\r\n      this.downPC.onicecandidate = e => {\r\n        if (e.candidate) {\r\n          this.sendSignal('down_candidate', { candidate: e.candidate.toJSON() })\r\n        }\r\n      }\r\n\r\n      // 3. ÁõëÂê¨ËøûÊé•Áä∂ÊÄÅ\r\n      this.downPC.onconnectionstatechange = () => {\r\n        console.log(`‚¨áÔ∏è DownPC Áä∂ÊÄÅ: ${this.downPC.connectionState}`)\r\n      }\r\n    },\r\n\r\n    async handleDownOffer(payload) {\r\n      this.createDownPeerConnection()\r\n\r\n      // 1. ËÆæÁΩÆ SFU ÂèëÊù•ÁöÑ Offer ‰∏∫ËøúÁ´ØÊèèËø∞\r\n      await this.downPC.setRemoteDescription(new RTCSessionDescription({\r\n        type: 'offer',\r\n        sdp: payload.sdp\r\n      }))\r\n\r\n      // 2. ÂàõÂª∫ Answer\r\n      const answer = await this.downPC.createAnswer()\r\n      await this.downPC.setLocalDescription(answer)\r\n\r\n      console.log('‚û°Ô∏è ÂèëÈÄÅ down_answer (Local SDP):', answer.sdp)\r\n\r\n      // 3. ÂèëÈÄÅ down_answer Áªô SFU\r\n      this.sendSignal('down_answer', { sdp: answer.sdp })\r\n\r\n      // Êõ¥Êñ∞ UI ÂàóË°®ÔºåÊ†áËÆ∞ËØ•ÂèëÂ∏ÉËÄÖÊ≠£Âú®Ë¢´ËÆ¢ÈòÖ\r\n      if (payload.from) {\r\n        this.$set(this.onlinePublishers, payload.from, 'Ê≠£Âú®ËÆ¢ÈòÖ');\r\n      }\r\n    },\r\n\r\n    /* ================= ÊµÅÁßªÈô§Â§ÑÁêÜ (Êñ∞Â¢ûÊ†∏ÂøÉ‰øÆÂ§ç) ================= */\r\n    handleStreamRemoval(publisherId) {\r\n        console.log(`‚ùå Êî∂Âà∞ÊµÅÁßªÈô§ÈÄöÁü•, Publisher ID: ${publisherId}`);\r\n\r\n        // 1. ÂÅúÊ≠¢ MediaStream Track Âπ∂ÁßªÈô§ Map ‰∏≠ÁöÑ Stream\r\n        if (this.downStreams.has(publisherId)) {\r\n            const streamToStop = this.downStreams.get(publisherId);\r\n            streamToStop.getTracks().forEach(track => track.stop());\r\n            \r\n            this.downStreams.delete(publisherId); \r\n            this.downStreams = new Map(this.downStreams); // Âº∫Âà∂ Vue Êõ¥Êñ∞\r\n            console.log(`‚úÖ Â∑≤‰ªé downStreams ‰∏≠ÁßªÈô§ÊµÅ: ${publisherId}`);\r\n        }\r\n\r\n        // 2. Êõ¥Êñ∞ UI ÂàóË°®\r\n        // ÁßªÈô§ÂèëÂ∏ÉËÄÖÁä∂ÊÄÅÔºà‰ΩÜÂ¶ÇÊûúËØ•Áî®Êà∑ËøòÊ≤°Á¶ªÂºÄÊàøÈó¥ÔºåÂèØ‰ª•ËÆæ‰∏∫'Âú®Á∫ø/Êú™ÂèëÂ∏É'Ôºâ\r\n        this.$delete(this.onlinePublishers, publisherId);\r\n    },\r\n\r\n    /* ================= ‰ø°‰ª§Â§ÑÁêÜ‰∏≠ÂøÉ ================= */\r\n    async handleSignal(msg) {\r\n      const event = msg.event\r\n      let dataPayload = null;\r\n\r\n      try {\r\n        if (msg.data) {\r\n          // Go ÊúçÂä°Âô®‰ΩøÁî® json.RawMessageÔºåÂâçÁ´ØÈúÄË¶ÅÂÜçÊ¨°Ëß£Êûê data Â≠óÊÆµ\r\n          dataPayload = (typeof msg.data === 'string') ? JSON.parse(msg.data) : msg.data;\r\n        }\r\n\r\n        switch (event) {\r\n          case 'up_answer':\r\n            if (!this.upPC) { console.error(\"UpPC‰∏çÂ≠òÂú®\"); return; }\r\n            await this.upPC.setRemoteDescription(new RTCSessionDescription({\r\n              type: 'answer',\r\n              sdp: dataPayload.sdp\r\n            }))\r\n            console.log('‚úÖ UpPC ËøûÊé•ÊàêÂäüÔºÅ');\r\n            break\r\n\r\n          case 'down_offer':\r\n            // SFU ÂèëÊù•Êñ∞ÁöÑ Offer (ÂèØËÉΩÂåÖÂê´Êñ∞ÁöÑ Track)\r\n            await this.handleDownOffer(dataPayload)\r\n            break\r\n            \r\n          case 'unpublish_stream': // „ÄêÊñ∞Â¢ûÂ§ÑÁêÜ„Äë\r\n            if (dataPayload && dataPayload.publisherId) {\r\n                this.handleStreamRemoval(dataPayload.publisherId); \r\n            }\r\n            break\r\n\r\n          case 'up_candidate':\r\n          case 'down_candidate':\r\n            // Candidate ÁöÑ JSON ÁªìÊûÑ‰∏é RTCIceCandidateInit ÂÖºÂÆπ\r\n            if (dataPayload && dataPayload.candidate) {\r\n              const candidate = new RTCIceCandidate(dataPayload.candidate);\r\n\r\n              let targetPC = null;\r\n              if (event === 'up_candidate') {\r\n                targetPC = this.upPC;\r\n              } else if (event === 'down_candidate') {\r\n                targetPC = this.downPC;\r\n              }\r\n\r\n              if (targetPC && targetPC.remoteDescription) {\r\n                await targetPC.addIceCandidate(candidate)\r\n                // console.log(`‚úÖ ${event} Candidate Ê∑ªÂä†ÊàêÂäü`);\r\n              } else if (targetPC) {\r\n                // ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÔºåÈúÄË¶ÅÁºìÂÜ≤ candidate Áõ¥Âà∞ setRemoteDescription ÂÆåÊàê\r\n                // console.warn(`‚ö†Ô∏è ÁºìÂÜ≤ ${event} Candidate`);\r\n              }\r\n            }\r\n            break\r\n\r\n          // ÂÅáËÆæÂêéÁ´ØÊ≤°Êúâ user_join/leaveÔºå‰ªÖÈÄöËøáÂèëÂ∏ÉÁä∂ÊÄÅÂèòÂåñÊù•Êõ¥Êñ∞ UI\r\n          case 'user_join':\r\n          case 'user_leave':\r\n            // ‰øùÊåÅÁé∞ÊúâÈÄªËæëÔºåÂ¶ÇÊûúÊÇ®ÁöÑÂêéÁ´ØÂÆûÁé∞‰∫ÜËøô‰∫õ‰∫ã‰ª∂\r\n            this.handleUserStatusUpdate(event, dataPayload);\r\n            break;\r\n\r\n          default:\r\n            console.warn('Êú™Áü• SFU ‰ø°‰ª§‰∫ã‰ª∂:', event)\r\n        }\r\n      } catch (e) {\r\n        console.error(`Â§ÑÁêÜ ${event} Ê∂àÊÅØÂ§±Ë¥•:`, e);\r\n      }\r\n    },\r\n\r\n    handleUserStatusUpdate(event, payload) {\r\n      // ËøôÊòØ‰∏Ä‰∏™Âç†‰ΩçÂáΩÊï∞ÔºåÂ¶ÇÊûúÊÇ®ÂêéÁ´ØÊú™ÂÆûÁé∞Ê≠§ÂäüËÉΩÔºåÂèØÂà†Èô§ÊàñÂøΩÁï•\r\n      if (event === 'user_join' && payload.uid !== this.userId) {\r\n        this.$set(this.onlinePublishers, payload.uid, 'Âú®Á∫ø/Êú™ÂèëÂ∏É');\r\n      } else if (event === 'user_leave') {\r\n        this.$delete(this.onlinePublishers, payload.uid);\r\n        this.handleStreamRemoval(payload.uid); // Á°Æ‰øùÁ¶ªÂºÄÊó∂‰πüÁßªÈô§ÊµÅ\r\n      }\r\n    },\r\n\r\n    /* ================= ÊåÇÊñ≠/Ê∏ÖÁêÜ (ÂÆåÂÖ®ÈÄÄÂá∫ÊàøÈó¥) ================= */\r\n    hangup(isPassive = false) {\r\n      if (!isPassive) {\r\n          // ‰ªÖÂú®‰∏ªÂä®ÊåÇÊñ≠Êó∂ÂèëÈÄÅ unpublish ‰ø°‰ª§\r\n          if (this.isPublisher) {\r\n              this.sendSignal('unpublish', { uid: this.userId });\r\n          }\r\n          // ‰∏ªÂä®ÊåÇÊñ≠Êó∂ÔºåÂÖ≥Èó≠ WS ËøûÊé•ÔºåËøô‰πü‰ºöËß¶Âèë onclose -> hangup(true)\r\n          if (this.ws) {\r\n              this.ws.close();\r\n              this.ws = null;\r\n          }\r\n      }\r\n      \r\n      // ÂÖ≥Èó≠ PeerConnections\r\n      if (this.upPC) {\r\n        this.upPC.close();\r\n        this.upPC = null;\r\n      }\r\n      if (this.downPC) {\r\n        this.downPC.close();\r\n        this.downPC = null;\r\n      }\r\n\r\n      // ÂÅúÊ≠¢Êú¨Âú∞ÊµÅ\r\n      if (this.localStream) {\r\n        this.localStream.getTracks().forEach(t => t.stop());\r\n        this.localStream = null;\r\n      }\r\n\r\n      // Ê∏ÖÁêÜ UI Áä∂ÊÄÅ (Ëß£ÂÜ≥ TypeError: Cannot set properties of undefined)\r\n      if (this.$refs.localVideo) {\r\n          this.$refs.localVideo.srcObject = null;\r\n      }\r\n      this.downStreams = new Map(); // Ê∏ÖÁ©∫ÊâÄÊúâËøúÁ´ØÊµÅ\r\n      this.isPublisher = false;\r\n      this.$delete(this.onlinePublishers, this.userId); // Ê∏ÖÁêÜËá™Â∑±ÂèëÂ∏ÉÁöÑËÆ∞ÂΩï\r\n      \r\n      console.log('‚òéÔ∏è Â∑≤ÊåÇÊñ≠/ÈÄÄÂá∫ÊàøÈó¥');\r\n    }\r\n  },\r\n  \r\n  beforeDestroy() {\r\n    this.hangup(true); // Âú®ÁªÑ‰ª∂ÈîÄÊØÅÂâçÊâßË°åÊúÄÁªàÊ∏ÖÁêÜ\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webrtc-container {\r\n  padding: 20px;\r\n}\r\n\r\n.video-box {\r\n  display: flex;\r\n  gap: 20px;\r\n  margin-bottom: 20px;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.video-item h3 {\r\n  font-size: 16px;\r\n  margin-bottom: 5px;\r\n}\r\n\r\nvideo {\r\n  width: 320px;\r\n  height: 240px;\r\n  background: #222;\r\n  border-radius: 8px;\r\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.actions {\r\n  display: flex;\r\n  gap: 10px;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.online-users-box {\r\n  margin-top: 30px;\r\n  padding: 15px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n}\r\n\r\n.online-users-box ul {\r\n  list-style: none;\r\n  padding: 0;\r\n}\r\n\r\n.online-users-box li {\r\n  padding: 8px 0;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  border-bottom: 1px dashed #f0f0f0;\r\n}\r\n\r\n.online-users-box li:hover {\r\n  background-color: #f9ff9f;\r\n}\r\n</style>"],"mappings":";;;;;;;;AAmCA;AACA,MAAAA,MAAA;AAAA,IAAAC,QAAA,GAAAC,OAAA,CAAAC,OAAA,GAEA;EACAC,IAAA;EAEAC,KAAA;IACA;MACA;MACAC,IAAA;MAAA;MACAC,MAAA;MAAA;MACAC,WAAA;MAAA;;MAEA;MACAC,EAAA;MACAC,QAAA;MACA;MACAC,MAAA,cAAAC,IAAA,CAAAC,MAAA,GAAAC,QAAA,KAAAC,KAAA;MACAC,MAAA;MAAA;MACAC,WAAA;MAAA;;MAEA;MACAC,WAAA,MAAAC,GAAA;MACAC,gBAAA;MAAA;;MAEAC,UAAA;QACAA,UAAA,GACA;UAAAC,IAAA;QAAA;MAEA;IACA;EACA;EAEAC,QAAA;IACA,KAAAC,YAAA;IACA,KAAAC,SAAA;EACA;EAEAC,OAAA;IACA;IACAF,aAAA;MACA;MACA,KAAAf,EAAA,OAAAkB,SAAA,IAAA3B,MAAA,uBAAAW,MAAA,gBAAAK,MAAA;MAEA,KAAAP,EAAA,CAAAmB,MAAA;QACA,KAAAlB,QAAA;QACAmB,OAAA,CAAAC,GAAA,+BAAAnB,MAAA;MACA;MAEA,KAAAF,EAAA,CAAAsB,SAAA,SAAAC,CAAA;QACA;UACA,MAAAC,MAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAH,CAAA,CAAA3B,IAAA;UACAwB,OAAA,CAAAC,GAAA,kBAAAG,MAAA,CAAAG,KAAA,EAAAH,MAAA,CAAA5B,IAAA;UACA,WAAAgC,YAAA,CAAAJ,MAAA;QACA,SAAAK,KAAA;UACAT,OAAA,CAAAS,KAAA,cAAAA,KAAA,EAAAN,CAAA,CAAA3B,IAAA;QACA;MACA;MAEA,KAAAI,EAAA,CAAA8B,OAAA;QACA,KAAA7B,QAAA;QACA;QACA,KAAA8B,MAAA;MACA;MACA,KAAA/B,EAAA,CAAAgC,OAAA,GAAAC,GAAA;QACA,KAAAhC,QAAA;QACAmB,OAAA,CAAAS,KAAA,kBAAAI,GAAA;MACA;IACA;IAEAC,WAAAP,KAAA,EAAA/B,IAAA;MACA,SAAAI,EAAA,SAAAA,EAAA,CAAAmC,UAAA,KAAAjB,SAAA,CAAAkB,IAAA;QACA,MAAAC,OAAA;UACAV,KAAA,EAAAA,KAAA;UACA/B,IAAA,EAAAA;QACA;QACA,KAAAI,EAAA,CAAAsC,IAAA,CAAAb,IAAA,CAAAc,SAAA,CAAAF,OAAA;MACA;QACAjB,OAAA,CAAAoB,IAAA,0BAAAb,KAAA;MACA;IACA;IAEA;IACA,MAAAX,UAAA;MACA,SAAAjB,WAAA;MACA;QACA,KAAAA,WAAA,SAAA0C,SAAA,CAAAC,YAAA,CAAAC,YAAA;UACAC,KAAA;UACAC,KAAA;QACA;QACA,SAAAC,KAAA,CAAAC,UAAA;UAAA;UACA,KAAAD,KAAA,CAAAC,UAAA,CAAAC,SAAA,QAAAjD,WAAA;QACA;MACA,SAAA8B,KAAA;QACAT,OAAA,CAAAS,KAAA,aAAAA,KAAA;MACA;IACA;IAEA;IACAoB,uBAAA;MACA,SAAApD,IAAA;QACA,KAAAA,IAAA,CAAAqD,KAAA;MACA;MACA,KAAArD,IAAA,OAAAsD,iBAAA,MAAAvC,UAAA;;MAEA;MACA,KAAAb,WAAA,CAAAqD,SAAA,GAAAC,OAAA,CAAAC,KAAA;QACA,KAAAzD,IAAA,CAAA0D,QAAA,CAAAD,KAAA,OAAAvD,WAAA;MACA;;MAEA;MACA,KAAAF,IAAA,CAAA2D,cAAA,GAAAjC,CAAA;QACA,IAAAA,CAAA,CAAAkC,SAAA;UACA,KAAAvB,UAAA;YAAAuB,SAAA,EAAAlC,CAAA,CAAAkC,SAAA,CAAAC,MAAA;UAAA;QACA;MACA;;MAEA;MACA,KAAA7D,IAAA,CAAA8D,uBAAA;QACAvC,OAAA,CAAAC,GAAA,qBAAAxB,IAAA,CAAA+D,eAAA;QACA,SAAA/D,IAAA,CAAA+D,eAAA;UACA,KAAAC,IAAA,MAAAlD,gBAAA,OAAAT,MAAA;QACA,gBAAAL,IAAA,CAAA+D,eAAA,sBAAA/D,IAAA,CAAA+D,eAAA;UACA,KAAAC,IAAA,MAAAlD,gBAAA,OAAAT,MAAA;QACA;MACA;IACA;IAEA,MAAA4D,aAAA;MACA,SAAAtD,WAAA;MAEA,UAAAT,WAAA;QACA,WAAAiB,SAAA;QACA,UAAAjB,WAAA;MACA;MACA,KAAAkD,sBAAA;;MAEA;MACA,MAAAc,KAAA,cAAAlE,IAAA,CAAAmE,WAAA;MACA,WAAAnE,IAAA,CAAAoE,mBAAA,CAAAF,KAAA;MAEA3C,OAAA,CAAAC,GAAA,gCAAA0C,KAAA,CAAAG,GAAA;;MAEA;MACA,KAAAhC,UAAA;QAAAiC,GAAA,OAAAjE,MAAA;QAAAgE,GAAA,EAAAH,KAAA,CAAAG;MAAA;MACA,KAAA1D,WAAA;IACA;IAEA;IACA4D,yBAAA;MACA,SAAAtE,MAAA;QACA;MACA;MAEA,KAAAA,MAAA,OAAAqD,iBAAA,MAAAvC,UAAA;;MAEA;MACA,KAAAd,MAAA,CAAAuE,OAAA,GAAA9C,CAAA;QACA,MAAA+C,YAAA,GAAA/C,CAAA,CAAAgD,OAAA;QACA;QACA,MAAAC,KAAA,GAAAF,YAAA,CAAAG,EAAA;QAEA,KAAAD,KAAA;UACApD,OAAA,CAAAS,KAAA;UACA;QACA;QAEAT,OAAA,CAAAC,GAAA,kCAAAmD,KAAA,iBAAAjD,CAAA,CAAA+B,KAAA,CAAAoB,IAAA;;QAEA;QACA,UAAAjE,WAAA,CAAAkE,GAAA,CAAAH,KAAA;UACA,KAAA/D,WAAA,CAAAmE,GAAA,CAAAJ,KAAA,EAAAF,YAAA;UACA;UACA,KAAA7D,WAAA,OAAAC,GAAA,MAAAD,WAAA;QACA;;QAEA;QACA,KAAAoE,SAAA;UACA;UACA,MAAAC,OAAA,QAAAhC,KAAA,gBAAA0B,KAAA;UACA,IAAAM,OAAA,IAAAA,OAAA,OAAAA,OAAA,IAAA9B,SAAA,KAAAsB,YAAA;YACAQ,OAAA,IAAA9B,SAAA,GAAAsB,YAAA;YACAlD,OAAA,CAAAC,GAAA,gBAAAmD,KAAA;UACA;QACA;MACA;;MAEA;MACA,KAAA1E,MAAA,CAAA0D,cAAA,GAAAjC,CAAA;QACA,IAAAA,CAAA,CAAAkC,SAAA;UACA,KAAAvB,UAAA;YAAAuB,SAAA,EAAAlC,CAAA,CAAAkC,SAAA,CAAAC,MAAA;UAAA;QACA;MACA;;MAEA;MACA,KAAA5D,MAAA,CAAA6D,uBAAA;QACAvC,OAAA,CAAAC,GAAA,uBAAAvB,MAAA,CAAA8D,eAAA;MACA;IACA;IAEA,MAAAmB,gBAAAC,OAAA;MACA,KAAAZ,wBAAA;;MAEA;MACA,WAAAtE,MAAA,CAAAmF,oBAAA,KAAAC,qBAAA;QACAC,IAAA;QACAjB,GAAA,EAAAc,OAAA,CAAAd;MACA;;MAEA;MACA,MAAAkB,MAAA,cAAAtF,MAAA,CAAAuF,YAAA;MACA,WAAAvF,MAAA,CAAAmE,mBAAA,CAAAmB,MAAA;MAEAhE,OAAA,CAAAC,GAAA,mCAAA+D,MAAA,CAAAlB,GAAA;;MAEA;MACA,KAAAhC,UAAA;QAAAgC,GAAA,EAAAkB,MAAA,CAAAlB;MAAA;;MAEA;MACA,IAAAc,OAAA,CAAAM,IAAA;QACA,KAAAzB,IAAA,MAAAlD,gBAAA,EAAAqE,OAAA,CAAAM,IAAA;MACA;IACA;IAEA;IACAC,oBAAAC,WAAA;MACApE,OAAA,CAAAC,GAAA,6BAAAmE,WAAA;;MAEA;MACA,SAAA/E,WAAA,CAAAkE,GAAA,CAAAa,WAAA;QACA,MAAAC,YAAA,QAAAhF,WAAA,CAAAiF,GAAA,CAAAF,WAAA;QACAC,YAAA,CAAArC,SAAA,GAAAC,OAAA,CAAAC,KAAA,IAAAA,KAAA,CAAAqC,IAAA;QAEA,KAAAlF,WAAA,CAAAmF,MAAA,CAAAJ,WAAA;QACA,KAAA/E,WAAA,OAAAC,GAAA,MAAAD,WAAA;QACAW,OAAA,CAAAC,GAAA,2BAAAmE,WAAA;MACA;;MAEA;MACA;MACA,KAAAK,OAAA,MAAAlF,gBAAA,EAAA6E,WAAA;IACA;IAEA;IACA,MAAA5D,aAAAkE,GAAA;MACA,MAAAnE,KAAA,GAAAmE,GAAA,CAAAnE,KAAA;MACA,IAAAoE,WAAA;MAEA;QACA,IAAAD,GAAA,CAAAlG,IAAA;UACA;UACAmG,WAAA,UAAAD,GAAA,CAAAlG,IAAA,gBAAA6B,IAAA,CAAAC,KAAA,CAAAoE,GAAA,CAAAlG,IAAA,IAAAkG,GAAA,CAAAlG,IAAA;QACA;QAEA,QAAA+B,KAAA;UACA;YACA,UAAA9B,IAAA;cAAAuB,OAAA,CAAAS,KAAA;cAAA;YAAA;YACA,WAAAhC,IAAA,CAAAoF,oBAAA,KAAAC,qBAAA;cACAC,IAAA;cACAjB,GAAA,EAAA6B,WAAA,CAAA7B;YACA;YACA9C,OAAA,CAAAC,GAAA;YACA;UAEA;YACA;YACA,WAAA0D,eAAA,CAAAgB,WAAA;YACA;UAEA;YAAA;YACA,IAAAA,WAAA,IAAAA,WAAA,CAAAP,WAAA;cACA,KAAAD,mBAAA,CAAAQ,WAAA,CAAAP,WAAA;YACA;YACA;UAEA;UACA;YACA;YACA,IAAAO,WAAA,IAAAA,WAAA,CAAAtC,SAAA;cACA,MAAAA,SAAA,OAAAuC,eAAA,CAAAD,WAAA,CAAAtC,SAAA;cAEA,IAAAwC,QAAA;cACA,IAAAtE,KAAA;gBACAsE,QAAA,QAAApG,IAAA;cACA,WAAA8B,KAAA;gBACAsE,QAAA,QAAAnG,MAAA;cACA;cAEA,IAAAmG,QAAA,IAAAA,QAAA,CAAAC,iBAAA;gBACA,MAAAD,QAAA,CAAAE,eAAA,CAAA1C,SAAA;gBACA;cACA,WAAAwC,QAAA;gBACA;gBACA;cAAA;YAEA;YACA;;UAEA;UACA;UACA;YACA;YACA,KAAAG,sBAAA,CAAAzE,KAAA,EAAAoE,WAAA;YACA;UAEA;YACA3E,OAAA,CAAAoB,IAAA,iBAAAb,KAAA;QACA;MACA,SAAAJ,CAAA;QACAH,OAAA,CAAAS,KAAA,OAAAF,KAAA,UAAAJ,CAAA;MACA;IACA;IAEA6E,uBAAAzE,KAAA,EAAAqD,OAAA;MACA;MACA,IAAArD,KAAA,oBAAAqD,OAAA,CAAAb,GAAA,UAAAjE,MAAA;QACA,KAAA2D,IAAA,MAAAlD,gBAAA,EAAAqE,OAAA,CAAAb,GAAA;MACA,WAAAxC,KAAA;QACA,KAAAkE,OAAA,MAAAlF,gBAAA,EAAAqE,OAAA,CAAAb,GAAA;QACA,KAAAoB,mBAAA,CAAAP,OAAA,CAAAb,GAAA;MACA;IACA;IAEA;IACApC,OAAAsE,SAAA;MACA,KAAAA,SAAA;QACA;QACA,SAAA7F,WAAA;UACA,KAAA0B,UAAA;YAAAiC,GAAA,OAAAjE;UAAA;QACA;QACA;QACA,SAAAF,EAAA;UACA,KAAAA,EAAA,CAAAkD,KAAA;UACA,KAAAlD,EAAA;QACA;MACA;;MAEA;MACA,SAAAH,IAAA;QACA,KAAAA,IAAA,CAAAqD,KAAA;QACA,KAAArD,IAAA;MACA;MACA,SAAAC,MAAA;QACA,KAAAA,MAAA,CAAAoD,KAAA;QACA,KAAApD,MAAA;MACA;;MAEA;MACA,SAAAC,WAAA;QACA,KAAAA,WAAA,CAAAqD,SAAA,GAAAC,OAAA,CAAAiD,CAAA,IAAAA,CAAA,CAAAX,IAAA;QACA,KAAA5F,WAAA;MACA;;MAEA;MACA,SAAA+C,KAAA,CAAAC,UAAA;QACA,KAAAD,KAAA,CAAAC,UAAA,CAAAC,SAAA;MACA;MACA,KAAAvC,WAAA,OAAAC,GAAA;MACA,KAAAF,WAAA;MACA,KAAAqF,OAAA,MAAAlF,gBAAA,OAAAT,MAAA;;MAEAkB,OAAA,CAAAC,GAAA;IACA;EACA;EAEAkF,cAAA;IACA,KAAAxE,MAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}