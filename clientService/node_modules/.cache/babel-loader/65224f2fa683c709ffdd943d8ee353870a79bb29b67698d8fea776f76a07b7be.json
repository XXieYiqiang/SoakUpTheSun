{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n/**\r\n * WebSocketService Â∞ÅË£ÖÁ±ª\r\n * - Ëá™Âä®ÈáçËøû\r\n * - ÂøÉË∑≥Êú∫Âà∂\r\n * - Áªü‰∏ÄÊ∂àÊÅØÂàÜÂèëÂà∞ Vuex\r\n */\n\nclass WebSocketService {\n  constructor(url, store) {\n    this.url = url; // WebSocket ÊúçÂä°Âú∞ÂùÄ\n    this.store = store; // Vuex store ÂÆû‰æã\n    this.socket = null; // WebSocket ÂÆû‰æã\n    this.reconnectInterval = 5000; // Êñ≠Á∫øÂêéÈáçËøûÈó¥ÈöîÔºàÊØ´ÁßíÔºâ\n    this.heartbeatInterval = 30000; // ÂøÉË∑≥Èó¥ÈöîÔºàÊØ´ÁßíÔºâ\n    this.heartbeatTimer = null; // ÂøÉË∑≥ÂÆöÊó∂Âô®\n  }\n\n  /**\r\n   * Âª∫Á´ã WebSocket ËøûÊé•\r\n   */\n  connect() {\n    console.log('[WebSocket] Ê≠£Âú®ËøûÊé•Âà∞:', this.url);\n    this.socket = new WebSocket(this.url);\n    this.socket.onopen = () => {\n      console.log('[WebSocket] ‚úÖ ËøûÊé•ÊàêÂäü');\n      this.startHeartbeat(); // ÂêØÂä®ÂøÉË∑≥\n    };\n    this.socket.onmessage = event => {\n      try {\n        console.log('[WebSocket] üì© ÂìçÂ∫îÊï∞ÊçÆ:', event);\n        const data = JSON.parse(event.data);\n        console.log('[WebSocket] üì© Êî∂Âà∞Ê∂àÊÅØ:', data);\n        this.handleMessage(data);\n      } catch (err) {\n        console.error('[WebSocket] ‚ùå Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', event.data, err);\n      }\n    };\n    this.socket.onclose = () => {\n      console.warn('[WebSocket] ‚ö†Ô∏è ËøûÊé•Â∑≤ÂÖ≥Èó≠Ôºå5ÁßíÂêéÈáçËøû...');\n      this.reconnect();\n    };\n    this.socket.onerror = err => {\n      console.error('[WebSocket] ‚ùå ËøûÊé•ÈîôËØØ:', err);\n      this.socket.close(); // Ëß¶Âèë onclose -> reconnect\n    };\n  }\n\n  /**\r\n   * Ëá™Âä®ÈáçËøûÈÄªËæë\r\n   */\n  reconnect() {\n    setTimeout(() => {\n      console.log('[WebSocket] üîÑ Â∞ùËØïÈáçÊñ∞ËøûÊé•...');\n      this.connect();\n    }, this.reconnectInterval);\n  }\n\n  /**\r\n   * ÂêØÂä®ÂøÉË∑≥Êú∫Âà∂ÔºàÊØè30ÁßíÂèëÈÄÅ pingÔºâ\r\n   */\n  startHeartbeat() {\n    if (this.heartbeatTimer) clearInterval(this.heartbeatTimer);\n    this.heartbeatTimer = setInterval(() => {\n      console.log('[WebSocket] üü¢ ÂèëÈÄÅÂøÉË∑≥ ping');\n      this.send({\n        cmd: 100002,\n        timestamp: Date.now(),\n        data: {}\n      });\n    }, this.heartbeatInterval);\n  }\n\n  /**\r\n   * ÂèëÈÄÅÊ∂àÊÅØ\r\n   * @param {Object} data Ë¶ÅÂèëÈÄÅÁöÑÊï∞ÊçÆÂØπË±°\r\n   */\n  send(data) {\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n      const str = JSON.stringify(data);\n      console.log('[WebSocket] üì§ ÂèëÈÄÅÊ∂àÊÅØ:', str);\n      this.socket.send(str);\n    } else {\n      console.warn('[WebSocket] ‚ö†Ô∏è ÂèëÈÄÅÂ§±Ë¥•ÔºåËøûÊé•Êú™Â∞±Áª™');\n    }\n  }\n\n  /**\r\n   * Â§ÑÁêÜÊî∂Âà∞ÁöÑÊ∂àÊÅØÔºåÁªü‰∏Ä‰∫§Áªô Vuex ÂàÜÂèëÂô®Â§ÑÁêÜ\r\n   * @param {Object} msg\r\n   */\n  handleMessage(msg) {\n    // ÂÅáËÆæÊ†ºÂºè‰∏∫ { type: 'chat' | 'system' | 'broadcast', data: {} }\n    console.log('[WebSocket] üì¨ Ê¥æÂèëÊ∂àÊÅØÂà∞ Vuex: ', msg.cmd);\n    this.store.dispatch('messageDispatcher/dispatch', msg);\n  }\n}\nvar _default = exports.default = WebSocketService;","map":{"version":3,"names":["WebSocketService","constructor","url","store","socket","reconnectInterval","heartbeatInterval","heartbeatTimer","connect","console","log","WebSocket","onopen","startHeartbeat","onmessage","event","data","JSON","parse","handleMessage","err","error","onclose","warn","reconnect","onerror","close","setTimeout","clearInterval","setInterval","send","cmd","timestamp","Date","now","readyState","OPEN","str","stringify","msg","dispatch","_default","exports","default"],"sources":["C:/Users/Administrator/Desktop/GimChat/gimChatVue/src/plugins/ws.js"],"sourcesContent":["/**\r\n * WebSocketService Â∞ÅË£ÖÁ±ª\r\n * - Ëá™Âä®ÈáçËøû\r\n * - ÂøÉË∑≥Êú∫Âà∂\r\n * - Áªü‰∏ÄÊ∂àÊÅØÂàÜÂèëÂà∞ Vuex\r\n */\r\n\r\nclass WebSocketService {\r\n  constructor(url, store) {\r\n    this.url = url;                     // WebSocket ÊúçÂä°Âú∞ÂùÄ\r\n    this.store = store;                 // Vuex store ÂÆû‰æã\r\n    this.socket = null;                // WebSocket ÂÆû‰æã\r\n    this.reconnectInterval = 5000;     // Êñ≠Á∫øÂêéÈáçËøûÈó¥ÈöîÔºàÊØ´ÁßíÔºâ\r\n    this.heartbeatInterval = 30000;    // ÂøÉË∑≥Èó¥ÈöîÔºàÊØ´ÁßíÔºâ\r\n    this.heartbeatTimer = null;        // ÂøÉË∑≥ÂÆöÊó∂Âô®\r\n  }\r\n\r\n  /**\r\n   * Âª∫Á´ã WebSocket ËøûÊé•\r\n   */\r\n  connect() {\r\n    console.log('[WebSocket] Ê≠£Âú®ËøûÊé•Âà∞:', this.url);\r\n    this.socket = new WebSocket(this.url);\r\n\r\n    this.socket.onopen = () => {\r\n      console.log('[WebSocket] ‚úÖ ËøûÊé•ÊàêÂäü');\r\n      this.startHeartbeat(); // ÂêØÂä®ÂøÉË∑≥\r\n    };\r\n\r\n    this.socket.onmessage = (event) => {\r\n      try {\r\n        console.log('[WebSocket] üì© ÂìçÂ∫îÊï∞ÊçÆ:', event);\r\n        const data = JSON.parse(event.data);\r\n        console.log('[WebSocket] üì© Êî∂Âà∞Ê∂àÊÅØ:', data);\r\n        this.handleMessage(data);\r\n      } catch (err) {\r\n        console.error('[WebSocket] ‚ùå Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', event.data, err);\r\n      }\r\n    };\r\n\r\n    this.socket.onclose = () => {\r\n      console.warn('[WebSocket] ‚ö†Ô∏è ËøûÊé•Â∑≤ÂÖ≥Èó≠Ôºå5ÁßíÂêéÈáçËøû...');\r\n      this.reconnect();\r\n    };\r\n\r\n    this.socket.onerror = (err) => {\r\n      console.error('[WebSocket] ‚ùå ËøûÊé•ÈîôËØØ:', err);\r\n      this.socket.close(); // Ëß¶Âèë onclose -> reconnect\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Ëá™Âä®ÈáçËøûÈÄªËæë\r\n   */\r\n  reconnect() {\r\n    setTimeout(() => {\r\n      console.log('[WebSocket] üîÑ Â∞ùËØïÈáçÊñ∞ËøûÊé•...');\r\n      this.connect();\r\n    }, this.reconnectInterval);\r\n  }\r\n\r\n  /**\r\n   * ÂêØÂä®ÂøÉË∑≥Êú∫Âà∂ÔºàÊØè30ÁßíÂèëÈÄÅ pingÔºâ\r\n   */\r\n  startHeartbeat() {\r\n    if (this.heartbeatTimer) clearInterval(this.heartbeatTimer);\r\n\r\n    this.heartbeatTimer = setInterval(() => {\r\n      console.log('[WebSocket] üü¢ ÂèëÈÄÅÂøÉË∑≥ ping');\r\n      this.send({ cmd: 100002, timestamp: Date.now(),data: {} });\r\n    }, this.heartbeatInterval);\r\n  }\r\n\r\n  /**\r\n   * ÂèëÈÄÅÊ∂àÊÅØ\r\n   * @param {Object} data Ë¶ÅÂèëÈÄÅÁöÑÊï∞ÊçÆÂØπË±°\r\n   */\r\n  send(data) {\r\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) {\r\n      const str = JSON.stringify(data);\r\n      console.log('[WebSocket] üì§ ÂèëÈÄÅÊ∂àÊÅØ:', str);\r\n      this.socket.send(str);\r\n    } else {\r\n      console.warn('[WebSocket] ‚ö†Ô∏è ÂèëÈÄÅÂ§±Ë¥•ÔºåËøûÊé•Êú™Â∞±Áª™');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Â§ÑÁêÜÊî∂Âà∞ÁöÑÊ∂àÊÅØÔºåÁªü‰∏Ä‰∫§Áªô Vuex ÂàÜÂèëÂô®Â§ÑÁêÜ\r\n   * @param {Object} msg\r\n   */\r\n  handleMessage(msg) {\r\n    // ÂÅáËÆæÊ†ºÂºè‰∏∫ { type: 'chat' | 'system' | 'broadcast', data: {} }\r\n    console.log('[WebSocket] üì¨ Ê¥æÂèëÊ∂àÊÅØÂà∞ Vuex: ', msg.cmd);\r\n    this.store.dispatch('messageDispatcher/dispatch', msg);\r\n  }\r\n}\r\n\r\nexport default WebSocketService;\r\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,gBAAgB,CAAC;EACrBC,WAAWA,CAACC,GAAG,EAAEC,KAAK,EAAE;IACtB,IAAI,CAACD,GAAG,GAAGA,GAAG,CAAC,CAAqB;IACpC,IAAI,CAACC,KAAK,GAAGA,KAAK,CAAC,CAAiB;IACpC,IAAI,CAACC,MAAM,GAAG,IAAI,CAAC,CAAgB;IACnC,IAAI,CAACC,iBAAiB,GAAG,IAAI,CAAC,CAAK;IACnC,IAAI,CAACC,iBAAiB,GAAG,KAAK,CAAC,CAAI;IACnC,IAAI,CAACC,cAAc,GAAG,IAAI,CAAC,CAAQ;EACrC;;EAEA;AACF;AACA;EACEC,OAAOA,CAAA,EAAG;IACRC,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAE,IAAI,CAACR,GAAG,CAAC;IAC3C,IAAI,CAACE,MAAM,GAAG,IAAIO,SAAS,CAAC,IAAI,CAACT,GAAG,CAAC;IAErC,IAAI,CAACE,MAAM,CAACQ,MAAM,GAAG,MAAM;MACzBH,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;MACjC,IAAI,CAACG,cAAc,CAAC,CAAC,CAAC,CAAC;IACzB,CAAC;IAED,IAAI,CAACT,MAAM,CAACU,SAAS,GAAIC,KAAK,IAAK;MACjC,IAAI;QACFN,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEK,KAAK,CAAC;QAC1C,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACC,IAAI,CAAC;QACnCP,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEM,IAAI,CAAC;QACzC,IAAI,CAACG,aAAa,CAACH,IAAI,CAAC;MAC1B,CAAC,CAAC,OAAOI,GAAG,EAAE;QACZX,OAAO,CAACY,KAAK,CAAC,uBAAuB,EAAEN,KAAK,CAACC,IAAI,EAAEI,GAAG,CAAC;MACzD;IACF,CAAC;IAED,IAAI,CAAChB,MAAM,CAACkB,OAAO,GAAG,MAAM;MAC1Bb,OAAO,CAACc,IAAI,CAAC,+BAA+B,CAAC;MAC7C,IAAI,CAACC,SAAS,CAAC,CAAC;IAClB,CAAC;IAED,IAAI,CAACpB,MAAM,CAACqB,OAAO,GAAIL,GAAG,IAAK;MAC7BX,OAAO,CAACY,KAAK,CAAC,qBAAqB,EAAED,GAAG,CAAC;MACzC,IAAI,CAAChB,MAAM,CAACsB,KAAK,CAAC,CAAC,CAAC,CAAC;IACvB,CAAC;EACH;;EAEA;AACF;AACA;EACEF,SAASA,CAAA,EAAG;IACVG,UAAU,CAAC,MAAM;MACflB,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC;MACvC,IAAI,CAACF,OAAO,CAAC,CAAC;IAChB,CAAC,EAAE,IAAI,CAACH,iBAAiB,CAAC;EAC5B;;EAEA;AACF;AACA;EACEQ,cAAcA,CAAA,EAAG;IACf,IAAI,IAAI,CAACN,cAAc,EAAEqB,aAAa,CAAC,IAAI,CAACrB,cAAc,CAAC;IAE3D,IAAI,CAACA,cAAc,GAAGsB,WAAW,CAAC,MAAM;MACtCpB,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC;MACvC,IAAI,CAACoB,IAAI,CAAC;QAAEC,GAAG,EAAE,MAAM;QAAEC,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;QAAClB,IAAI,EAAE,CAAC;MAAE,CAAC,CAAC;IAC5D,CAAC,EAAE,IAAI,CAACV,iBAAiB,CAAC;EAC5B;;EAEA;AACF;AACA;AACA;EACEwB,IAAIA,CAACd,IAAI,EAAE;IACT,IAAI,IAAI,CAACZ,MAAM,IAAI,IAAI,CAACA,MAAM,CAAC+B,UAAU,KAAKxB,SAAS,CAACyB,IAAI,EAAE;MAC5D,MAAMC,GAAG,GAAGpB,IAAI,CAACqB,SAAS,CAACtB,IAAI,CAAC;MAChCP,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAE2B,GAAG,CAAC;MACxC,IAAI,CAACjC,MAAM,CAAC0B,IAAI,CAACO,GAAG,CAAC;IACvB,CAAC,MAAM;MACL5B,OAAO,CAACc,IAAI,CAAC,2BAA2B,CAAC;IAC3C;EACF;;EAEA;AACF;AACA;AACA;EACEJ,aAAaA,CAACoB,GAAG,EAAE;IACjB;IACA9B,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAE6B,GAAG,CAACR,GAAG,CAAC;IACnD,IAAI,CAAC5B,KAAK,CAACqC,QAAQ,CAAC,4BAA4B,EAAED,GAAG,CAAC;EACxD;AACF;AAAC,IAAAE,QAAA,GAAAC,OAAA,CAAAC,OAAA,GAEc3C,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}