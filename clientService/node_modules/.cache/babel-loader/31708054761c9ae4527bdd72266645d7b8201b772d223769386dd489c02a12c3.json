{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Administrator/Desktop/GimChat/gimChatVue/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _index = _interopRequireDefault(require(\"@/store/index.js\"));\nvar _default = exports.default = {\n  name: 'ImgPreview',\n  data() {\n    return {\n      visible: false,\n      //  图片预览遮罩层组件是否显示\n      inputActiveIndex: 1,\n      //  对用户而言 显示的图片索引 从 1 开始 顶部栏输入框控制此值变化\n      rotate: 0,\n      //  旋转角度\n      activeIndex: 0,\n      //  当前图片索引 从 0 开始\n      imgZoom: 100,\n      //  图片缩放比例\n      imgZoomMin: 1,\n      //  图片缩放最小比例\n      imgZoomMax: 200,\n      //  图片缩放最大比例\n      isShowMinImgList: true //  是否显示缩略图列表\n    };\n  },\n  computed: {\n    activeImage() {\n      return this.imgList[this.activeIndex];\n    },\n    activeImageName() {\n      return this.$file.getFileNameComplete(this.activeImage);\n    },\n    imageHeight() {\n      return this.activeImage.imageHeight;\n    },\n    imageWidth() {\n      return this.activeImage.imageWidth;\n    },\n    // 当前显示的图片下载链接\n    activeDownloadLink() {\n      return this.activeImage.downloadLink;\n    },\n    // 屏幕宽度\n    screenWidth() {\n      return _index.default.state.common.screenWidth;\n    }\n  },\n  watch: {\n    // 监听 图片查看组件 显隐状态变化\n    visible(val) {\n      if (val) {\n        this.activeIndex = this.defaultIndex;\n        document.addEventListener('keyup', this.handleAddKeyupEvent); // 添加键盘相关事件\n        // 获取用户是否显示缩略图的操作习惯设置\n        this.isShowMinImgList = localStorage.getItem('qiwen_file_img_preview_show_min') === 'false' ? false : true;\n        this.$nextTick(() => {\n          this.handleCalculateImgZoom(this.activeIndex); // 确定图片缩放比例\n          this.handleScrollMinImg(); // 将当前查看图片对应的缩略图滚动到视野中\n        });\n      } else {\n        // 移除键盘相关事件\n        document.removeEventListener('keyup', this.handleAddKeyupEvent);\n      }\n    },\n    // 监听 图片索引变化\n    activeIndex(newValue) {\n      this.rotate = 0;\n      this.$nextTick(() => {\n        if (this.$refs.imgLarge[newValue].style.zoom) {\n          this.imgZoom = Number(this.$refs.imgLarge[newValue].style.zoom.split('%')[0]);\n        } else {\n          // 确定图片缩放比例\n          this.handleCalculateImgZoom(newValue);\n        }\n      });\n    },\n    // 监听 是否展示缩略图列表，将变化值保存在 localStorage 中\n    isShowMinImgList(val) {\n      localStorage.setItem('qiwen_file_img_preview_show_min', val);\n    }\n  },\n  methods: {\n    /**\r\n     * 顶部栏输入框绑定值被改变时触发\r\n     * @param {number} currentValue 当前值\r\n     */\n    handleChangeInputIndex(currentValue) {\n      this.activeIndex = currentValue - 1;\n      this.handleChangeActiveImg(currentValue - 1);\n    },\n    /**\r\n     * DOM 绑定 Esc 键、左方向键、右方向键的键盘按下事件\r\n     * @param {event} event 事件\r\n     */\n    handleAddKeyupEvent(event) {\n      switch (event.key) {\n        case 'Escape':\n          {\n            this.handleCloseImgPreview(); // 关闭预览\n            break;\n          }\n        case 'ArrowLeft':\n          {\n            this.handleChangeActiveImg(this.activeIndex - 1); // 切换到上一张\n            break;\n          }\n        case 'ArrowRight':\n          {\n            this.handleChangeActiveImg(this.activeIndex + 1); // 切换到下一张\n            break;\n          }\n      }\n    },\n    /**\r\n     * 计算图片缩放比例\r\n     */\n    handleCalculateImgZoom(currentIndex) {\n      // 包裹元素\n      const wrapperDom = document.querySelector('.img-wrapper');\n      // 宽度原比例\n      const widthRate = Number(((wrapperDom.clientWidth - 264) / this.imageWidth).toFixed(2));\n      // 高度原比例\n      const heightRate = Number(((wrapperDom.clientHeight - 80) / this.imageHeight).toFixed(2));\n      let zoomRate = 1; // 缩放比例\n      if (widthRate >= 1 && heightRate >= 1) {\n        // 原图宽、高都小于/等于包裹元素\n        zoomRate = 1;\n      } else if (widthRate >= 1 && heightRate < 1) {\n        // 原图宽小于/等于显示区域，高大于包裹元素\n        zoomRate = heightRate;\n      } else if (widthRate < 1 && heightRate >= 1) {\n        // 原图宽大于显示区域，高小于/等于包裹元素\n        zoomRate = widthRate;\n      } else if (widthRate < 1 && heightRate < 1) {\n        // 原图宽、高都大于包裹元素\n        zoomRate = Math.min(widthRate, heightRate);\n      }\n      this.imgZoom = Number(zoomRate.toFixed(2)) * 100; //  缩放百分比\n      this.$refs.imgLarge[currentIndex].style.zoom = `${this.imgZoom}%`;\n    },\n    /**\r\n     * 关闭图片预览，恢复旋转角度\r\n     */\n    handleCloseImgPreview() {\n      this.rotate = 0;\n      this.$refs.imgLarge[this.activeIndex].style.transform = `rotate(${this.rotate}deg)`;\n      this.visible = false;\n      this.callback('cancel');\n    },\n    /**\r\n     * 格式化 tooltip message - 显示图片缩放比例\r\n     * @param {number} value 缩放数字\r\n     * @returns {string}  图片缩放比例\r\n     */\n    formatZoomSize(value) {\n      return value + '%';\n    },\n    /**\r\n     * 数据改变时触发（使用鼠标拖曳时，活动过程实时触发）\r\n     * @param {number} value 缩放数字\r\n     */\n    handleZoomImg(value) {\n      if (this.$refs.imgLarge) {\n        this.$refs.imgLarge[this.activeIndex].style.zoom = value + '%'; //  实时设置图片缩放比例\n      }\n    },\n    /**\r\n     * 鼠标滚动事件\r\n     * @description 缩放图片\r\n     */\n    handleMouseWheel() {\n      let zoom = parseInt(this.$refs.imgLarge[this.activeIndex].style.zoom) || 100;\n      zoom += event.wheelDelta / 12;\n      if (zoom >= this.imgZoomMin && zoom < this.imgZoomMax) {\n        this.imgZoom = zoom;\n        this.$refs.imgLarge[this.activeIndex].style.zoom = zoom + '%';\n      }\n      return false;\n    },\n    /**\r\n     * 旋转图片\r\n     */\n    handleRotateImg() {\n      this.rotate += 90;\n      this.$refs.imgLarge[this.activeIndex].style.transform = `rotate(${this.rotate}deg)`;\n    },\n    /**\r\n     * 改变当前查看的图片索引\r\n     */\n    handleChangeActiveImg(index) {\n      if (index >= 0 && index < this.imgList.length) {\n        this.activeIndex = index;\n        this.handleScrollMinImg();\n      }\n    },\n    /**\r\n     * 将缩略图中当前查看的图片缩略图滚动到视野中\r\n     */\n    handleScrollMinImg() {\n      const parentEle = this.$refs.minImgListRef; //  包裹缩略图的父元素\n      const activeEle = this.$refs.minImgRef[this.activeIndex]; //  当前缩略图\n      // 当前元素距离可视区域顶部的距离\n      const currentEleTop = activeEle.offsetTop - activeEle.clientHeight;\n      // 当前元素距离可视区域底部的距离\n      const currentEleBottom = parentEle.clientHeight - activeEle.offsetTop;\n      // 如果当前查看的图片缩略图有一部分在可视区域之外（之上或之下）\n      if (currentEleBottom < activeEle.clientHeight || currentEleTop < activeEle.clientHeight) {\n        // 将父元素的滚动条向可视区域方向滚动两个图片的高度\n        parentEle.scrollTop = -currentEleBottom + activeEle.clientHeight * 2;\n      }\n    }\n  },\n  mounted() {\n    console.log('imgPreviewlml=lml');\n  }\n};","map":{"version":3,"names":["_index","_interopRequireDefault","require","_default","exports","default","name","data","visible","inputActiveIndex","rotate","activeIndex","imgZoom","imgZoomMin","imgZoomMax","isShowMinImgList","computed","activeImage","imgList","activeImageName","$file","getFileNameComplete","imageHeight","imageWidth","activeDownloadLink","downloadLink","screenWidth","store","state","common","watch","val","defaultIndex","document","addEventListener","handleAddKeyupEvent","localStorage","getItem","$nextTick","handleCalculateImgZoom","handleScrollMinImg","removeEventListener","newValue","$refs","imgLarge","style","zoom","Number","split","setItem","methods","handleChangeInputIndex","currentValue","handleChangeActiveImg","event","key","handleCloseImgPreview","currentIndex","wrapperDom","querySelector","widthRate","clientWidth","toFixed","heightRate","clientHeight","zoomRate","Math","min","transform","callback","formatZoomSize","value","handleZoomImg","handleMouseWheel","parseInt","wheelDelta","handleRotateImg","index","length","parentEle","minImgListRef","activeEle","minImgRef","currentEleTop","offsetTop","currentEleBottom","scrollTop","mounted","console","log"],"sources":["src/components/file/box/imgPreview/BoxMask.vue"],"sourcesContent":["<template>\r\n\t<transition name=\"el-fade-in-linear el-fade-in\">\r\n\t\t<div class=\"img-preview-wrapper\" v-show=\"visible\">\r\n\t\t\t<!-- 顶部信息栏 & 工具栏 -->\r\n\t\t\t<div class=\"tip-wrapper\" v-if=\"visible\">\r\n\t\t\t\t<i\r\n\t\t\t\t\tclass=\"fold-icon\"\r\n\t\t\t\t\t:class=\"\r\n\t\t\t\t\t\tisShowMinImgList\r\n\t\t\t\t\t\t\t? 'no-fold el-icon-d-arrow-left'\r\n\t\t\t\t\t\t\t: 'fold el-icon-d-arrow-right'\r\n\t\t\t\t\t\"\r\n\t\t\t\t\t:title=\"isShowMinImgList ? '折叠缩略图' : '展开缩略图'\"\r\n\t\t\t\t\t@click=\"isShowMinImgList = !isShowMinImgList\"\r\n\t\t\t\t></i>\r\n\t\t\t\t<div class=\"name\" :title=\"activeImageName\">\r\n\t\t\t\t\t{{ activeImageName }}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"opera-btn-group\">\r\n\t\t\t\t\t<el-input-number\r\n\t\t\t\t\t\tv-model=\"inputActiveIndex\"\r\n\t\t\t\t\t\t:min=\"1\"\r\n\t\t\t\t\t\t:max=\"imgList.length\"\r\n\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\t@change=\"handleChangeInputIndex\"\r\n\t\t\t\t\t></el-input-number>\r\n\t\t\t\t\t<span class=\"split-line\">/</span>{{ imgList.length }}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"tool-wrapper\">\r\n\t\t\t\t\t<i\r\n\t\t\t\t\t\tclass=\"item el-icon-refresh-right\"\r\n\t\t\t\t\t\ttitle=\"向右旋转\"\r\n\t\t\t\t\t\t@click=\"handleRotateImg\"\r\n\t\t\t\t\t></i>\r\n\t\t\t\t\t<a\r\n\t\t\t\t\t\tclass=\"item download-link\"\r\n\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t:href=\"activeDownloadLink\"\r\n\t\t\t\t\t\t:download=\"activeImageName\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<i class=\"el-icon-download\" title=\"保存到本地\"></i>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t\t<el-tooltip effect=\"dark\" placement=\"bottom\">\r\n\t\t\t\t\t\t<div slot=\"content\" style=\"line-height: 1.5\">\r\n\t\t\t\t\t\t\t1. 点击图片以外的区域可退出预览<br />\r\n\t\t\t\t\t\t\t2. 按 Escape 键可退出预览<br />\r\n\t\t\t\t\t\t\t3. 按左、右方向键可切换为上一张、下一张图片<br />\r\n\t\t\t\t\t\t\t4. 鼠标滚轮可放大、缩小图片<br />\r\n\t\t\t\t\t\t\t5. 点击左上角\r\n\t\t\t\t\t\t\t<i class=\"el-icon-d-arrow-left\"></i> 图标可折叠、展开缩略图<br />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"item text-wrapper\">\r\n\t\t\t\t\t\t\t<span class=\"text\">操作提示</span>\r\n\t\t\t\t\t\t\t<i class=\"el-icon-s-opportunity\"></i>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</el-tooltip>\r\n\t\t\t\t\t<i\r\n\t\t\t\t\t\tclass=\"item close-icon el-icon-close\"\r\n\t\t\t\t\t\ttitle=\"关闭预览\"\r\n\t\t\t\t\t\t@click=\"handleCloseImgPreview\"\r\n\t\t\t\t\t></i>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- 左侧缩略图 -->\r\n\t\t\t<ul class=\"min-img-list\" ref=\"minImgListRef\" v-show=\"isShowMinImgList\">\r\n\t\t\t\t<li\r\n\t\t\t\t\tclass=\"min-img-item\"\r\n\t\t\t\t\tv-for=\"(item, index) in imgList\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:class=\"{ active: activeIndex === index }\"\r\n\t\t\t\t\t:title=\"$file.getFileNameComplete(item)\"\r\n\t\t\t\t\tref=\"minImgRef\"\r\n\t\t\t\t\t@click=\"activeIndex = index\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclass=\"min-img\"\r\n\t\t\t\t\t\t:src=\"$file.setFileImg(item)\"\r\n\t\t\t\t\t\t:alt=\"`${item.fileName} 缩略图`\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t\t<!-- 右侧预览区域 -->\r\n\t\t\t<div\r\n\t\t\t\tclass=\"img-wrapper\"\r\n\t\t\t\t:class=\"{ 'full-width': !isShowMinImgList }\"\r\n\t\t\t\t@mousewheel.prevent=\"handleMouseWheel()\"\r\n\t\t\t\t@click.self=\"handleCloseImgPreview\"\r\n\t\t\t>\r\n\t\t\t\t<!-- 大图查看 -->\r\n\t\t\t\t<img\r\n\t\t\t\t\tclass=\"img-large\"\r\n\t\t\t\t\tref=\"imgLarge\"\r\n\t\t\t\t\tv-for=\"(item, index) in imgList\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:src=\"item.fileUrl\"\r\n\t\t\t\t\tv-show=\"index === activeIndex\"\r\n\t\t\t\t/>\r\n\t\t\t\t<!-- 左右切换图标 -->\r\n\t\t\t\t<i\r\n\t\t\t\t\tclass=\"pre-icon el-icon-arrow-left\"\r\n\t\t\t\t\ttitle=\"上一张\"\r\n\t\t\t\t\tv-show=\"activeIndex > 0\"\r\n\t\t\t\t\t@click.stop=\"handleChangeActiveImg(activeIndex - 1)\"\r\n\t\t\t\t></i>\r\n\t\t\t\t<i\r\n\t\t\t\t\tclass=\"next-icon el-icon-arrow-right\"\r\n\t\t\t\t\ttitle=\"下一张\"\r\n\t\t\t\t\tv-show=\"activeIndex < imgList.length - 1\"\r\n\t\t\t\t\t@click.stop=\"handleChangeActiveImg(activeIndex + 1)\"\r\n\t\t\t\t></i>\r\n\t\t\t\t<!-- 底部显示放大缩小比例 -->\r\n\t\t\t\t<div class=\"zoom-bar\">\r\n\t\t\t\t\t<el-slider\r\n\t\t\t\t\t\tv-model=\"imgZoom\"\r\n\t\t\t\t\t\t:min=\"imgZoomMin\"\r\n\t\t\t\t\t\t:max=\"imgZoomMax\"\r\n\t\t\t\t\t\t:format-tooltip=\"formatZoomSize\"\r\n\t\t\t\t\t\t@input=\"handleZoomImg\"\r\n\t\t\t\t\t></el-slider>\r\n\t\t\t\t\t<div class=\"zoom-count\">{{ imgZoom }}%</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</transition>\r\n</template>\r\n\r\n<script>\r\nimport store from '@/store/index.js'\r\n\r\nexport default {\r\n\tname: 'ImgPreview',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tvisible: false, //  图片预览遮罩层组件是否显示\r\n\t\t\tinputActiveIndex: 1, //  对用户而言 显示的图片索引 从 1 开始 顶部栏输入框控制此值变化\r\n\t\t\trotate: 0, //  旋转角度\r\n\t\t\tactiveIndex: 0, //  当前图片索引 从 0 开始\r\n\t\t\timgZoom: 100, //  图片缩放比例\r\n\t\t\timgZoomMin: 1, //  图片缩放最小比例\r\n\t\t\timgZoomMax: 200, //  图片缩放最大比例\r\n\t\t\tisShowMinImgList: true //  是否显示缩略图列表\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tactiveImage() {\r\n\t\t\treturn this.imgList[this.activeIndex]\r\n\t\t},\r\n\t\tactiveImageName() {\r\n\t\t\treturn this.$file.getFileNameComplete(this.activeImage)\r\n\t\t},\r\n\t\timageHeight() {\r\n\t\t\treturn this.activeImage.imageHeight\r\n\t\t},\r\n\t\timageWidth() {\r\n\t\t\treturn this.activeImage.imageWidth\r\n\t\t},\r\n\t\t// 当前显示的图片下载链接\r\n\t\tactiveDownloadLink() {\r\n\t\t\treturn this.activeImage.downloadLink\r\n\t\t},\r\n\t\t// 屏幕宽度\r\n\t\tscreenWidth() {\r\n\t\t\treturn store.state.common.screenWidth\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\t// 监听 图片查看组件 显隐状态变化\r\n\t\tvisible(val) {\r\n\t\t\tif (val) {\r\n\t\t\t\tthis.activeIndex = this.defaultIndex\r\n\t\t\t\tdocument.addEventListener('keyup', this.handleAddKeyupEvent) // 添加键盘相关事件\r\n\t\t\t\t// 获取用户是否显示缩略图的操作习惯设置\r\n\t\t\t\tthis.isShowMinImgList =\r\n\t\t\t\t\tlocalStorage.getItem('qiwen_file_img_preview_show_min') === 'false'\r\n\t\t\t\t\t\t? false\r\n\t\t\t\t\t\t: true\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.handleCalculateImgZoom(this.activeIndex) // 确定图片缩放比例\r\n\t\t\t\t\tthis.handleScrollMinImg() // 将当前查看图片对应的缩略图滚动到视野中\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\t// 移除键盘相关事件\r\n\t\t\t\tdocument.removeEventListener('keyup', this.handleAddKeyupEvent)\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 监听 图片索引变化\r\n\t\tactiveIndex(newValue) {\r\n\t\t\tthis.rotate = 0\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tif (this.$refs.imgLarge[newValue].style.zoom) {\r\n\t\t\t\t\tthis.imgZoom = Number(\r\n\t\t\t\t\t\tthis.$refs.imgLarge[newValue].style.zoom.split('%')[0]\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 确定图片缩放比例\r\n\t\t\t\t\tthis.handleCalculateImgZoom(newValue)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// 监听 是否展示缩略图列表，将变化值保存在 localStorage 中\r\n\t\tisShowMinImgList(val) {\r\n\t\t\tlocalStorage.setItem('qiwen_file_img_preview_show_min', val)\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 顶部栏输入框绑定值被改变时触发\r\n\t\t * @param {number} currentValue 当前值\r\n\t\t */\r\n\t\thandleChangeInputIndex(currentValue) {\r\n\t\t\tthis.activeIndex = currentValue - 1\r\n\t\t\tthis.handleChangeActiveImg(currentValue - 1)\r\n\t\t},\r\n\t\t/**\r\n\t\t * DOM 绑定 Esc 键、左方向键、右方向键的键盘按下事件\r\n\t\t * @param {event} event 事件\r\n\t\t */\r\n\t\thandleAddKeyupEvent(event) {\r\n\t\t\tswitch (event.key) {\r\n\t\t\t\tcase 'Escape': {\r\n\t\t\t\t\tthis.handleCloseImgPreview() // 关闭预览\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tcase 'ArrowLeft': {\r\n\t\t\t\t\tthis.handleChangeActiveImg(this.activeIndex - 1) // 切换到上一张\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tcase 'ArrowRight': {\r\n\t\t\t\t\tthis.handleChangeActiveImg(this.activeIndex + 1) // 切换到下一张\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * 计算图片缩放比例\r\n\t\t */\r\n\t\thandleCalculateImgZoom(currentIndex) {\r\n\t\t\t// 包裹元素\r\n\t\t\tconst wrapperDom = document.querySelector('.img-wrapper')\r\n\t\t\t// 宽度原比例\r\n\t\t\tconst widthRate = Number(\r\n\t\t\t\t((wrapperDom.clientWidth - 264) / this.imageWidth).toFixed(2)\r\n\t\t\t)\r\n\t\t\t// 高度原比例\r\n\t\t\tconst heightRate = Number(\r\n\t\t\t\t((wrapperDom.clientHeight - 80) / this.imageHeight).toFixed(2)\r\n\t\t\t)\r\n\t\t\tlet zoomRate = 1 // 缩放比例\r\n\t\t\tif (widthRate >= 1 && heightRate >= 1) {\r\n\t\t\t\t// 原图宽、高都小于/等于包裹元素\r\n\t\t\t\tzoomRate = 1\r\n\t\t\t} else if (widthRate >= 1 && heightRate < 1) {\r\n\t\t\t\t// 原图宽小于/等于显示区域，高大于包裹元素\r\n\t\t\t\tzoomRate = heightRate\r\n\t\t\t} else if (widthRate < 1 && heightRate >= 1) {\r\n\t\t\t\t// 原图宽大于显示区域，高小于/等于包裹元素\r\n\t\t\t\tzoomRate = widthRate\r\n\t\t\t} else if (widthRate < 1 && heightRate < 1) {\r\n\t\t\t\t// 原图宽、高都大于包裹元素\r\n\t\t\t\tzoomRate = Math.min(widthRate, heightRate)\r\n\t\t\t}\r\n\t\t\tthis.imgZoom = Number(zoomRate.toFixed(2)) * 100 //  缩放百分比\r\n\t\t\tthis.$refs.imgLarge[currentIndex].style.zoom = `${this.imgZoom}%`\r\n\t\t},\r\n\t\t/**\r\n\t\t * 关闭图片预览，恢复旋转角度\r\n\t\t */\r\n\t\thandleCloseImgPreview() {\r\n\t\t\tthis.rotate = 0\r\n\t\t\tthis.$refs.imgLarge[\r\n\t\t\t\tthis.activeIndex\r\n\t\t\t].style.transform = `rotate(${this.rotate}deg)`\r\n\t\t\tthis.visible = false\r\n\t\t\tthis.callback('cancel')\r\n\t\t},\r\n\t\t/**\r\n\t\t * 格式化 tooltip message - 显示图片缩放比例\r\n\t\t * @param {number} value 缩放数字\r\n\t\t * @returns {string}  图片缩放比例\r\n\t\t */\r\n\t\tformatZoomSize(value) {\r\n\t\t\treturn value + '%'\r\n\t\t},\r\n\t\t/**\r\n\t\t * 数据改变时触发（使用鼠标拖曳时，活动过程实时触发）\r\n\t\t * @param {number} value 缩放数字\r\n\t\t */\r\n\t\thandleZoomImg(value) {\r\n\t\t\tif (this.$refs.imgLarge) {\r\n\t\t\t\tthis.$refs.imgLarge[this.activeIndex].style.zoom = value + '%' //  实时设置图片缩放比例\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * 鼠标滚动事件\r\n\t\t * @description 缩放图片\r\n\t\t */\r\n\t\thandleMouseWheel() {\r\n\t\t\tlet zoom =\r\n\t\t\t\tparseInt(this.$refs.imgLarge[this.activeIndex].style.zoom) || 100\r\n\t\t\tzoom += event.wheelDelta / 12\r\n\t\t\tif (zoom >= this.imgZoomMin && zoom < this.imgZoomMax) {\r\n\t\t\t\tthis.imgZoom = zoom\r\n\t\t\t\tthis.$refs.imgLarge[this.activeIndex].style.zoom = zoom + '%'\r\n\t\t\t}\r\n\t\t\treturn false\r\n\t\t},\r\n\t\t/**\r\n\t\t * 旋转图片\r\n\t\t */\r\n\t\thandleRotateImg() {\r\n\t\t\tthis.rotate += 90\r\n\t\t\tthis.$refs.imgLarge[\r\n\t\t\t\tthis.activeIndex\r\n\t\t\t].style.transform = `rotate(${this.rotate}deg)`\r\n\t\t},\r\n\t\t/**\r\n\t\t * 改变当前查看的图片索引\r\n\t\t */\r\n\t\thandleChangeActiveImg(index) {\r\n\t\t\tif (index >= 0 && index < this.imgList.length) {\r\n\t\t\t\tthis.activeIndex = index\r\n\t\t\t\tthis.handleScrollMinImg()\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * 将缩略图中当前查看的图片缩略图滚动到视野中\r\n\t\t */\r\n\t\thandleScrollMinImg() {\r\n\t\t\tconst parentEle = this.$refs.minImgListRef //  包裹缩略图的父元素\r\n\t\t\tconst activeEle = this.$refs.minImgRef[this.activeIndex] //  当前缩略图\r\n\t\t\t// 当前元素距离可视区域顶部的距离\r\n\t\t\tconst currentEleTop = activeEle.offsetTop - activeEle.clientHeight\r\n\t\t\t// 当前元素距离可视区域底部的距离\r\n\t\t\tconst currentEleBottom = parentEle.clientHeight - activeEle.offsetTop\r\n\t\t\t// 如果当前查看的图片缩略图有一部分在可视区域之外（之上或之下）\r\n\t\t\tif (\r\n\t\t\t\tcurrentEleBottom < activeEle.clientHeight ||\r\n\t\t\t\tcurrentEleTop < activeEle.clientHeight\r\n\t\t\t) {\r\n\t\t\t\t// 将父元素的滚动条向可视区域方向滚动两个图片的高度\r\n\t\t\t\tparentEle.scrollTop = -currentEleBottom + activeEle.clientHeight * 2\r\n\t\t\t}\r\n\t\t}\r\n\t},mounted(){\r\n\t  console.log('imgPreviewlml=lml')\t\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n@import '~_a/styles/varibles.styl';\r\n@import '~_a/styles/mixins.styl';\r\n\r\n.img-preview-wrapper {\r\n  position: fixed;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  overflow: auto;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 2;\r\n  text-align: center;\r\n  display: flex;\r\n  align-items: center;\r\n  animation: imgPreviewAnimation 0.3s;\r\n  animation-iteration-count: 0.3;\r\n  animation-fill-mode: forwards;\r\n\r\n  @keyframes imgPreviewAnimation {\r\n    0% {\r\n      background: transparent;\r\n    }\r\n\r\n    100% {\r\n      background: rgba(0, 0, 0, 0.8);\r\n    }\r\n  }\r\n\r\n  .tip-wrapper {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 2;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    padding-right: 48px;\r\n    width: 100%;\r\n    height: 48px;\r\n    line-height: 48px;\r\n    color: #fff;\r\n    font-size: 16px;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    .fold-icon {\r\n      margin-right: 16px;\r\n      font-size: 24px;\r\n      cursor: pointer;\r\n      &:hover {\r\n        opacity: 0.6;\r\n      }\r\n      &.no-fold {\r\n        width: 120px;\r\n      }\r\n      &.fold {\r\n        width: 64px;\r\n      }\r\n    }\r\n\r\n    .name {\r\n      flex: 1;\r\n      padding-right: 16px;\r\n      text-align: left;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n\r\n    .opera-btn-group {\r\n      width: 100px;\r\n      display: flex;\r\n\r\n      >>> .el-input-number {\r\n        width: 40px;\r\n\r\n        .el-input-number__decrease, .el-input-number__increase {\r\n          display: none;\r\n        }\r\n\r\n        .el-input__inner {\r\n          margin-top: 14px;\r\n          background: rgba(0, 0, 0, 0.5);\r\n          height: 20px;\r\n          line-height: 20px;\r\n          padding: 0;\r\n          font-size: 16px;\r\n          color: #fff;\r\n        }\r\n      }\r\n\r\n      .split-line {\r\n        margin: 0 8px;\r\n      }\r\n    }\r\n\r\n    .tool-wrapper {\r\n      flex: 1;\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      align-items: center;\r\n\r\n      .item {\r\n        margin-left: 16px;\r\n        cursor: pointer;\r\n\r\n        &:hover {\r\n          opacity: 0.7;\r\n        }\r\n      }\r\n\r\n      .el-icon-refresh-right,\r\n      .close-icon,\r\n      .download-link {\r\n        font-size: 18px;\r\n      }\r\n\r\n      .download-link {\r\n        color: inherit;\r\n      }\r\n\r\n      .text-wrapper {\r\n        margin-left: 32px;\r\n\r\n        .text {\r\n          margin-right: 8px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .min-img-list {\r\n    position: fixed;\r\n    top: 48px;\r\n    left: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    height: calc(100vh - 48px);\r\n    padding: 8px 16px;\r\n    overflow-y: auto;\r\n    list-style: none;\r\n    setScrollbar(8px, transparent, #C0C4CC);\r\n\r\n    .min-img-item {\r\n      position: relative;\r\n      margin-bottom: 4px;\r\n      width: 80px;\r\n      height: 80px;\r\n      cursor: pointer;\r\n      .min-img {\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n      &:last-of-type {\r\n        margin-bottom: 0;\r\n      }\r\n      &:not(.active)::after {\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        display: block;\r\n        width: 80px;\r\n        height: 80px;\r\n        background: #000;\r\n        opacity: 0.4;\r\n      }\r\n      &:hover {\r\n        &:not(.active)::after {\r\n          opacity: 0.2;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .img-wrapper {\r\n    position: fixed;\r\n    top: 48px;\r\n    right: 0;\r\n    left: 120px;\r\n    overflow: auto;\r\n    height: calc(100vh - 48px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    &.full-width {\r\n      left: 0;\r\n    }\r\n    .img-large {\r\n      margin: 0 auto;\r\n      transition: transform 0.5s;\r\n    }\r\n\r\n    .pre-icon, .next-icon {\r\n      font-size: 60px;\r\n      color: #fff;\r\n      position: absolute;\r\n      top: 50%;\r\n      cursor: pointer;\r\n      z-index: 3;\r\n\r\n      &:hover {\r\n        opacity: 0.7;\r\n      }\r\n    }\r\n\r\n    .pre-icon {\r\n      left: 64px;\r\n    }\r\n\r\n    .next-icon {\r\n      right: 64px;\r\n    }\r\n\r\n    .zoom-bar {\r\n      position: absolute;\r\n      right: 0;\r\n      bottom: 20px;\r\n      left: 0;\r\n      margin: 0 auto;\r\n      width: 600px;\r\n      display: flex;\r\n\r\n      >>> .el-slider {\r\n        flex: 1;\r\n\r\n        .el-slider__bar {\r\n          background: $PrimaryText;\r\n        }\r\n\r\n        .el-slider__button {\r\n          border-color: $PrimaryText;\r\n        }\r\n      }\r\n\r\n      .zoom-count {\r\n        width: 60px;\r\n        height: 38px;\r\n        line-height: 38px;\r\n        text-align: right;\r\n        color: #fff;\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}