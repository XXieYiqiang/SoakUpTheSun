{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.find.js\");\nrequire(\"core-js/modules/es.iterator.map.js\");\nvar _default = exports.default = {\n  data() {\n    return {\n      chatMessages: [{\n        id: Date.now(),\n        role: \"ai\",\n        content: \"ÂòøÔºÅÊàëÊòØ AI Â∞èÂä©ÊâãÔºåÊúâ‰ªª‰ΩïÈóÆÈ¢òÈÉΩÂèØ‰ª•ÈóÆÊàëÂì¶ÔΩû\",\n        rendered: true\n      }],\n      userInput: '',\n      socket: null,\n      loading: false,\n      currentAiMessageId: null,\n      typingQueue: [],\n      typingTimer: null,\n      isTyping: false\n    };\n  },\n  mounted() {\n    this.initSocket();\n  },\n  beforeDestroy() {\n    if (this.typingTimer) {\n      clearTimeout(this.typingTimer);\n    }\n  },\n  methods: {\n    formatToHtml(content) {\n      return marked.parse(content);\n    },\n    generateId() {\n      return Date.now() + Math.random();\n    },\n    initSocket() {\n      this.socket = new WebSocket('ws://127.0.0.1:9876/chat-ws');\n      this.socket.addEventListener('open', () => {\n        console.log('‚úÖ WebSocket Â∑≤ËøûÊé•');\n      });\n      this.socket.addEventListener('message', event => {\n        if (event.data === '[DONE]') {\n          this.loading = false;\n          const msg = this.chatMessages.find(m => m.id === this.currentAiMessageId);\n          if (msg) msg.rendered = true;\n          this.currentAiMessageId = null;\n          return;\n        }\n        this.queueTextForTyping(event.data);\n      });\n      this.socket.addEventListener('close', () => {\n        console.log('‚ùå WebSocket Â∑≤ÂÖ≥Èó≠');\n      });\n      this.socket.addEventListener('error', error => {\n        console.error('WebSocket ÈîôËØØ:', error);\n      });\n    },\n    handleSend() {\n      const msg = this.userInput.trim();\n      if (!msg || this.socket.readyState !== WebSocket.OPEN) return;\n      this.chatMessages.push({\n        id: this.generateId(),\n        role: 'user',\n        content: msg,\n        rendered: true\n      });\n      this.userInput = '';\n      this.loading = true;\n      this.scrollToBottom();\n      const context = this.chatMessages.map(m => (m.role === 'user' ? 'Áî®Êà∑Ôºö' : 'AIÔºö') + m.content).join('\\n');\n      this.socket.send(context);\n    },\n    queueTextForTyping(text) {\n      const chars = Array.from(text);\n      this.typingQueue.push(...chars);\n      if (!this.isTyping) {\n        this.startTyping();\n      }\n    },\n    startTyping() {\n      this.isTyping = true;\n      let last = this.chatMessages.find(msg => msg.id === this.currentAiMessageId);\n      if (!last) {\n        last = {\n          id: this.generateId(),\n          role: 'ai',\n          content: '',\n          rendered: false\n        };\n        this.chatMessages.push(last);\n        this.currentAiMessageId = last.id;\n      }\n      const typeNext = () => {\n        if (this.typingQueue.length === 0) {\n          this.isTyping = false;\n          return;\n        }\n        const nextChar = this.typingQueue.shift();\n        last.content += nextChar;\n        this.$forceUpdate();\n        this.scrollToBottom();\n        this.typingTimer = setTimeout(typeNext, 20);\n      };\n      typeNext();\n    },\n    scrollToBottom() {\n      this.$nextTick(() => {\n        const el = this.$refs.chatList;\n        if (el) el.scrollTop = el.scrollHeight;\n      });\n    }\n  }\n};","map":{"version":3,"names":["data","chatMessages","id","Date","now","role","content","rendered","userInput","socket","loading","currentAiMessageId","typingQueue","typingTimer","isTyping","mounted","initSocket","beforeDestroy","clearTimeout","methods","formatToHtml","marked","parse","generateId","Math","random","WebSocket","addEventListener","console","log","event","msg","find","m","queueTextForTyping","error","handleSend","trim","readyState","OPEN","push","scrollToBottom","context","map","join","send","text","chars","Array","from","startTyping","last","typeNext","length","nextChar","shift","$forceUpdate","setTimeout","$nextTick","el","$refs","chatList","scrollTop","scrollHeight"],"sources":["src/views/AIView.vue"],"sourcesContent":["<template>\r\n    <div class=\"chat-container\">\r\n        <!-- ËÅäÂ§©Ê∂àÊÅØÂå∫ -->\r\n        <div class=\"msg-list\" ref=\"chatList\">\r\n            <!-- <div v-for=\"(msg) in chatMessages\" :key=\"msg.id\" -->\r\n            <!-- :class=\"['msg', msg.role === 'user' ? 'msg-user' : 'msg-ai']\"> -->\r\n            <!-- <div class=\"avatar\" v-if=\"msg.role === 'ai'\">üí°</div> -->\r\n            <!-- <div class=\"msg-content\" v-html=\"formatToHtml(msg.content)\"></div> -->\r\n            <!-- <div class=\"msg-content\" v-text=\"msg.content\"></div> -->\r\n            <!-- <div class=\"msg-content\" v-html=\"formatToHtml(msg.content)\"></div> -->\r\n            <!-- <div class=\"avatar\" v-if=\"msg.role === 'user'\">üßë</div> -->\r\n            <!-- </div> -->\r\n            <div v-for=\"(msg) in chatMessages\" :key=\"msg.id\"\r\n                :class=\"['msg', msg.role === 'user' ? 'msg-user' : 'msg-ai']\">\r\n                <div class=\"avatar\" v-if=\"msg.role === 'ai'\">üí°</div>\r\n\r\n                <!-- Ê∏≤Êüì Markdown Âè™ÊúâÂú® AI Ê∏≤ÊüìÂÆåÊàêÂêé -->\r\n                <div class=\"msg-content\" v-if=\"msg.role === 'ai'\"\r\n                    v-html=\"msg.rendered ? formatToHtml(msg.content) : msg.content\"></div>\r\n\r\n                <!-- Áî®Êà∑Ê∂àÊÅØÁõ¥Êé•Â±ïÁ§∫ -->\r\n                <div class=\"msg-content\" v-if=\"msg.role === 'user'\">{{ msg.content }}</div>\r\n\r\n                <div class=\"avatar\" v-if=\"msg.role === 'user'\">üßë</div>\r\n            </div>\r\n\r\n            <div class=\"ai-loading\" v-if=\"loading\">\r\n                <span style=\"margin-right: 10px;\">AI Ê≠£Âú®ËæìÂÖ•</span>\r\n                <div class=\"dot-flash\">\r\n                    <div class=\"dot\" v-for=\"i in 3\" :key=\"i\" :style=\"{ animationDelay: (i * 0.2) + 's' }\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Â∫ïÈÉ®ËæìÂÖ•Ê†è -->\r\n        <div class=\"input-bar\" :class=\"{ 'input-bottom': chatMessages.length > 0 }\">\r\n            <div class=\"input-wrapper\">\r\n                <input v-model=\"userInput\" @keyup.enter=\"handleSend\" placeholder=\"ËØ∑ËæìÂÖ•ÈóÆÈ¢ò...\" class=\"input-box\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      chatMessages: [\r\n        {\r\n          id: Date.now(),\r\n          role: \"ai\",\r\n          content: \"ÂòøÔºÅÊàëÊòØ AI Â∞èÂä©ÊâãÔºåÊúâ‰ªª‰ΩïÈóÆÈ¢òÈÉΩÂèØ‰ª•ÈóÆÊàëÂì¶ÔΩû\",\r\n          rendered: true,\r\n        },\r\n      ],\r\n      userInput: '',\r\n      socket: null,\r\n      loading: false,\r\n      currentAiMessageId: null,\r\n      typingQueue: [],\r\n      typingTimer: null,\r\n      isTyping: false,\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initSocket()\r\n  },\r\n  beforeDestroy() {\r\n    if (this.typingTimer) {\r\n      clearTimeout(this.typingTimer)\r\n    }\r\n  },\r\n  methods: {\r\n    formatToHtml(content) {\r\n      return marked.parse(content)\r\n    },\r\n    generateId() {\r\n      return Date.now() + Math.random()\r\n    },\r\n    initSocket() {\r\n      this.socket = new WebSocket('ws://127.0.0.1:9876/chat-ws')\r\n\r\n      this.socket.addEventListener('open', () => {\r\n        console.log('‚úÖ WebSocket Â∑≤ËøûÊé•')\r\n      })\r\n\r\n      this.socket.addEventListener('message', (event) => {\r\n        if (event.data === '[DONE]') {\r\n          this.loading = false\r\n          const msg = this.chatMessages.find(m => m.id === this.currentAiMessageId)\r\n          if (msg) msg.rendered = true\r\n          this.currentAiMessageId = null\r\n          return\r\n        }\r\n        this.queueTextForTyping(event.data)\r\n      })\r\n\r\n      this.socket.addEventListener('close', () => {\r\n        console.log('‚ùå WebSocket Â∑≤ÂÖ≥Èó≠')\r\n      })\r\n\r\n      this.socket.addEventListener('error', (error) => {\r\n        console.error('WebSocket ÈîôËØØ:', error)\r\n      })\r\n    },\r\n    handleSend() {\r\n      const msg = this.userInput.trim()\r\n      if (!msg || this.socket.readyState !== WebSocket.OPEN) return\r\n\r\n      this.chatMessages.push({\r\n        id: this.generateId(),\r\n        role: 'user',\r\n        content: msg,\r\n        rendered: true,\r\n      })\r\n\r\n      this.userInput = ''\r\n      this.loading = true\r\n      this.scrollToBottom()\r\n\r\n      const context = this.chatMessages\r\n        .map((m) => (m.role === 'user' ? 'Áî®Êà∑Ôºö' : 'AIÔºö') + m.content)\r\n        .join('\\n')\r\n\r\n      this.socket.send(context)\r\n    },\r\n    queueTextForTyping(text) {\r\n      const chars = Array.from(text)\r\n      this.typingQueue.push(...chars)\r\n      if (!this.isTyping) {\r\n        this.startTyping()\r\n      }\r\n    },\r\n    startTyping() {\r\n      this.isTyping = true\r\n\r\n      let last = this.chatMessages.find(msg => msg.id === this.currentAiMessageId)\r\n      if (!last) {\r\n        last = {\r\n          id: this.generateId(),\r\n          role: 'ai',\r\n          content: '',\r\n          rendered: false,\r\n        }\r\n        this.chatMessages.push(last)\r\n        this.currentAiMessageId = last.id\r\n      }\r\n\r\n      const typeNext = () => {\r\n        if (this.typingQueue.length === 0) {\r\n          this.isTyping = false\r\n          return\r\n        }\r\n\r\n        const nextChar = this.typingQueue.shift()\r\n        last.content += nextChar\r\n        this.$forceUpdate()\r\n        this.scrollToBottom()\r\n\r\n        this.typingTimer = setTimeout(typeNext, 20)\r\n      }\r\n\r\n      typeNext()\r\n    },\r\n    scrollToBottom() {\r\n      this.$nextTick(() => {\r\n        const el = this.$refs.chatList\r\n        if (el) el.scrollTop = el.scrollHeight\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.msg-content {\r\n    white-space: pre-wrap;\r\n    /* ‰øùÁïôÊç¢Ë°å‰∏éÁ©∫Ê†º */\r\n    word-break: break-word;\r\n    line-height: 1.8;\r\n}\r\n\r\n.chat-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    height: 100%;\r\n    background: #f4f6f8;\r\n    font-family: 'Helvetica Neue', Arial, sans-serif;\r\n    padding-bottom: 100px;\r\n    box-sizing: border-box;\r\n    overflow: hidden;\r\n}\r\n\r\n.msg-list {\r\n    flex: 1;\r\n    padding: 20px 12px 0;\r\n    overflow-y: auto;\r\n    box-sizing: border-box;\r\n    scroll-behavior: smooth;\r\n}\r\n\r\n/************** ËÅäÂ§©Ê∞îÊ≥° **************/\r\n.msg {\r\n    display: flex;\r\n    align-items: flex-end;\r\n    margin-bottom: 18px;\r\n    max-width: 70%;\r\n    font-size: 14.5px;\r\n    line-height: 1.6;\r\n    position: relative;\r\n}\r\n\r\n/* Áî®Êà∑Ê∞îÊ≥°ÔºàÂè≥Ôºâ */\r\n.msg-user {\r\n    margin-left: auto;\r\n    justify-content: flex-end;\r\n}\r\n\r\n.msg-user .msg-content {\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #fff;\r\n    border-radius: 18px 4px 18px 18px;\r\n    padding: 10px 14px;\r\n    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.25);\r\n    min-width: 100px;\r\n    max-width: 500px;\r\n}\r\n\r\n.msg-user .avatar {\r\n    margin-left: 8px;\r\n    border: 2px solid #667eea;\r\n}\r\n\r\n/* AI Ê∞îÊ≥°ÔºàÂ∑¶Ôºâ */\r\n.msg-ai {\r\n    margin-right: auto;\r\n    justify-content: flex-start;\r\n}\r\n\r\n.msg-ai .msg-content {\r\n    background: #fff;\r\n    color: #333;\r\n    border-radius: 4px 18px 18px 18px;\r\n    padding: 10px 14px;\r\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);\r\n    min-width: 100px;\r\n    max-width: 500px;\r\n}\r\n\r\n.msg-ai .avatar {\r\n    margin-right: 8px;\r\n    border: 2px solid #f1f2f6;\r\n}\r\n\r\n/* Â§¥ÂÉèÁªü‰∏ÄÁæéÂåñ */\r\n.avatar {\r\n    width: 34px;\r\n    height: 34px;\r\n    border-radius: 50%;\r\n    background: #fff;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 20px;\r\n    flex-shrink: 0;\r\n    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n/* ËæìÂÖ•Ê†èÊ†∑Âºè */\r\n.input-bar {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    width: 100%;\r\n    max-width: 720px;\r\n    display: flex;\r\n    gap: 12px;\r\n    padding: 12px 16px;\r\n    background-color: white;\r\n    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);\r\n    box-sizing: border-box;\r\n    border-radius: 20px;\r\n}\r\n\r\n/* ËæìÂÖ•Ê°Ü */\r\n.input-wrapper {\r\n    display: flex;\r\n    width: 100%;\r\n}\r\n\r\n.input-box {\r\n    flex: 1;\r\n    height: 40px;\r\n    resize: none;\r\n    border: none;\r\n    background: #f4f6f8;\r\n    min-height: 40px;\r\n    max-height: 120px;\r\n    border-radius: 20px;\r\n    padding: 10px 14px;\r\n    font-size: 15px;\r\n    line-height: 1.4;\r\n    outline: none;\r\n    overflow-y: auto;\r\n    transition: none;\r\n}\r\n\r\n/* ÂèëÈÄÅÊåâÈíÆ */\r\n.send-btn {\r\n    padding: 10px 18px;\r\n    background-color: #1890ff;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 18px;\r\n    cursor: pointer;\r\n    font-size: 15px;\r\n    transition: background 0.2s ease;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.send-btn:disabled {\r\n    background-color: #a0cfff;\r\n    cursor: not-allowed;\r\n}\r\n\r\n/* loading ÁÇπÂä®Áîª */\r\n.ai-loading {\r\n    display: flex;\r\n    align-items: center;\r\n    color: #888;\r\n    font-size: 14px;\r\n    margin-left: 12px;\r\n}\r\n\r\n.dot-flash {\r\n    display: flex;\r\n    margin-left: 10px;\r\n}\r\n\r\n.dot {\r\n    width: 8px;\r\n    height: 8px;\r\n    background-color: #1890ff;\r\n    border-radius: 50%;\r\n    margin-left: 6px;\r\n    animation: flashDot 1.2s infinite;\r\n}\r\n\r\n@keyframes flashDot {\r\n    0% {\r\n        opacity: 0.2;\r\n        transform: scale(0.8);\r\n    }\r\n\r\n    50% {\r\n        opacity: 1;\r\n        transform: scale(1.2);\r\n    }\r\n\r\n    100% {\r\n        opacity: 0.2;\r\n        transform: scale(0.8);\r\n    }\r\n}\r\n\r\n/* ÁßªÂä®Á´ØÈÄÇÈÖç */\r\n@media (max-width: 768px) {\r\n    .input-bar {\r\n        padding: 10px 12px;\r\n    }\r\n\r\n    .input-box {\r\n        font-size: 14px;\r\n        padding: 8px 12px;\r\n    }\r\n\r\n    .send-btn {\r\n        padding: 8px 14px;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .msg {\r\n        max-width: 85%;\r\n        font-size: 14px;\r\n    }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}