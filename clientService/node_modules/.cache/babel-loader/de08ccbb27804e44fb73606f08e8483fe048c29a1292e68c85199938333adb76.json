{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Administrator/Desktop/GimChat/gimChatVue/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _store = _interopRequireDefault(require(\"@/store\"));\n/**\r\n * ğŸ“¨ æ¶ˆæ¯åˆ†å‘å™¨æ¨¡å—\r\n * - WebSocket æ”¶åˆ°çš„æ¶ˆæ¯å°†ç»Ÿä¸€ç”±è¿™é‡Œåˆ†ç±»åˆ†å‘\r\n * - æ”¯æŒç§èŠã€ç¾¤èŠã€ç³»ç»Ÿé€šçŸ¥ã€å…¨ç«™å¹¿æ’­ã€ping ç­‰ç±»å‹\r\n */\n// store/modules/messageDispatcher.js\nvar _default = exports.default = {\n  namespaced: true,\n  actions: {\n    /**\r\n     * ğŸ”§ æ¶ˆæ¯æ€»å…¥å£\r\n     * @param {Object} message WebSocket æ¥æ”¶åˆ°çš„åŸå§‹æ¶ˆæ¯å¯¹è±¡\r\n     * æ ¼å¼: { type: 'chat' | 'system' | 'broadcast' | 'ping', data: {...} }\r\n     */\n    dispatch({\n      dispatch\n    }, content) {\n      const {\n        cmd,\n        message,\n        data\n      } = content;\n      console.log(`[Dispatcher] ğŸ“© æ”¶åˆ°æ¶ˆæ¯ç±»å‹: ${cmd}`, data);\n      switch (cmd) {\n        case 111111:\n          console.log(\"å“åº”æˆåŠŸï¼š\" + message);\n          break;\n        // å“åº”æ¶ˆæ¯\n        case 100001:\n          dispatch('handleChatMessage', data);\n          break;\n        //å¤„ç†æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨å“åº”\n        case 1100003:\n          dispatch('handleUserList', data);\n        case 'chat':\n          dispatch('handleChatMessage', data);\n          break;\n        case 'system':\n          dispatch('handleSystemMessage', data);\n          break;\n        case 'broadcast':\n          dispatch('handleBroadcast', data);\n          break;\n        case 'ping':\n          // å¿ƒè·³å“åº”ï¼ˆå¯é€‰ï¼‰\n          console.log('[Dispatcher] ğŸ’“ æ”¶åˆ° ping å¿ƒè·³');\n          break;\n        default:\n          console.warn('[Dispatcher] âš ï¸ æœªçŸ¥æ¶ˆæ¯ç±»å‹:', cmd, data);\n      }\n    },\n    /**\r\n     * å¤„ç†ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢\r\n     */\n    handleUserList({\n      commit,\n      rootState\n    }, data) {\n      console.log('[Dispatcher] âœ… æ¥æ”¶åˆ°ç”¨æˆ·åˆ—è¡¨:', data);\n      commit('message/SET_USER_LIST', data, {\n        root: true\n      });\n    },\n    /**\r\n     * ğŸ’¬ å¤„ç†ç§èŠ / ç¾¤èŠæ¶ˆæ¯\r\n     * - åˆ¤æ–­æ˜¯å½“å‰èŠå¤©å¯¹è±¡å°±ç›´æ¥å±•ç¤º\r\n     * - å¦åˆ™å¢åŠ æœªè¯»æ•°\r\n     */\n    handleChatMessage({\n      commit,\n      rootState\n    }, data) {\n      const currentId = rootState.chat?.currentContactId;\n      const contactId = data.targetType === 'user' ? data.senderId : data.receiverId;\n      console.log(`[Dispatcher] ğŸ’¬ æ¥è‡ª ${data.targetType === 'user' ? 'ç§èŠ' : 'ç¾¤èŠ'} æ¶ˆæ¯: ${contactId}`, data);\n\n      // æ·»åŠ æ¶ˆæ¯åˆ° Vuex message æ¨¡å—\n      commit('message/ADD_MESSAGE', {\n        contactId,\n        message: data\n      }, {\n        root: true\n      });\n\n      // å½“å‰æ­£åœ¨èŠå¤©çª—å£ä¸æ˜¯è¯¥ä¼šè¯ï¼Œå¢åŠ æœªè¯»æ•°\n      if (contactId !== currentId) {\n        console.log(`[Dispatcher] ğŸ”´ ${contactId} ä¸æ˜¯å½“å‰çª—å£ï¼Œå¢åŠ æœªè¯»æ•°`);\n        commit('message/INCREMENT_UNREAD', contactId, {\n          root: true\n        });\n      } else {\n        console.log(`[Dispatcher] ğŸŸ¢ å½“å‰çª—å£æ¶ˆæ¯ï¼Œè‡ªåŠ¨å·²è¯»`);\n        commit('message/RESET_UNREAD', contactId, {\n          root: true\n        });\n      }\n    },\n    /**\r\n     * ğŸ“¢ å¤„ç†ç³»ç»Ÿé€šçŸ¥ï¼ˆå¦‚è´¦å·å¼‚å¸¸ã€å®¡æ ¸æˆåŠŸç­‰ï¼‰\r\n     */\n    handleSystemMessage({\n      commit\n    }, data) {\n      // è¿™é‡Œå¯æ‰©å±•ä¸ºä¿å­˜åˆ°ç³»ç»Ÿé€šçŸ¥è¡¨ã€æˆ–ç›´æ¥æ˜¾ç¤º UI é€šçŸ¥\n      console.info('[Dispatcher] ğŸ“¢ ç³»ç»Ÿé€šçŸ¥:', data.title || data.content);\n      // ç¤ºä¾‹ï¼šå¯é›†æˆ notification/toast æ’ä»¶æç¤º\n      // this._vm.$notify({ title: data.title, message: data.content });\n    },\n    /**\r\n     * ğŸŒ å¤„ç†å…¨ç«™å¹¿æ’­æ¶ˆæ¯ï¼ˆå¦‚ç³»ç»Ÿç»´æŠ¤æé†’ï¼‰\r\n     */\n    handleBroadcast({\n      commit\n    }, data) {\n      // é€šå¸¸ç”¨äºä¸æŒä¹…åŒ–çš„å³æ—¶æç¤º\n      console.info('[Dispatcher] ğŸŒ å¹¿æ’­æ¶ˆæ¯:', data);\n      // ç¤ºä¾‹ï¼šä½¿ç”¨å…¨å±€å¼¹çª—ç»„ä»¶æ˜¾ç¤º\n      // this._vm.$toast({ message: data.content, type: data.level || 'info' });\n    }\n  }\n};","map":{"version":3,"names":["_store","_interopRequireDefault","require","_default","exports","default","namespaced","actions","dispatch","content","cmd","message","data","console","log","warn","handleUserList","commit","rootState","root","handleChatMessage","currentId","chat","currentContactId","contactId","targetType","senderId","receiverId","handleSystemMessage","info","title","handleBroadcast"],"sources":["C:/Users/Administrator/Desktop/GimChat/gimChatVue/src/store/module/messageDispatcher.js"],"sourcesContent":["/**\r\n * ğŸ“¨ æ¶ˆæ¯åˆ†å‘å™¨æ¨¡å—\r\n * - WebSocket æ”¶åˆ°çš„æ¶ˆæ¯å°†ç»Ÿä¸€ç”±è¿™é‡Œåˆ†ç±»åˆ†å‘\r\n * - æ”¯æŒç§èŠã€ç¾¤èŠã€ç³»ç»Ÿé€šçŸ¥ã€å…¨ç«™å¹¿æ’­ã€ping ç­‰ç±»å‹\r\n */\r\n\r\nimport store from '@/store';\r\n// store/modules/messageDispatcher.js\r\nexport default {\r\n  namespaced: true,\r\n\r\n  actions: {\r\n    /**\r\n     * ğŸ”§ æ¶ˆæ¯æ€»å…¥å£\r\n     * @param {Object} message WebSocket æ¥æ”¶åˆ°çš„åŸå§‹æ¶ˆæ¯å¯¹è±¡\r\n     * æ ¼å¼: { type: 'chat' | 'system' | 'broadcast' | 'ping', data: {...} }\r\n     */\r\n    dispatch({ dispatch }, content) {\r\n\r\n      const { cmd,message, data } = content;\r\n\r\n      console.log(`[Dispatcher] ğŸ“© æ”¶åˆ°æ¶ˆæ¯ç±»å‹: ${cmd}`, data);\r\n\r\n      switch (cmd) {\r\n        case 111111:\r\n          console.log(\"å“åº”æˆåŠŸï¼š\"+message);\r\n          break\r\n        // å“åº”æ¶ˆæ¯\r\n        case 100001:\r\n          dispatch('handleChatMessage', data);\r\n          break\r\n        //å¤„ç†æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨å“åº”\r\n        case 1100003:  \r\n          dispatch('handleUserList', data);  \r\n        case 'chat':\r\n          dispatch('handleChatMessage', data);\r\n          break;\r\n        case 'system':\r\n          dispatch('handleSystemMessage', data);\r\n          break;\r\n        case 'broadcast':\r\n          dispatch('handleBroadcast', data);\r\n          break;\r\n        case 'ping':\r\n          // å¿ƒè·³å“åº”ï¼ˆå¯é€‰ï¼‰\r\n          console.log('[Dispatcher] ğŸ’“ æ”¶åˆ° ping å¿ƒè·³');\r\n          break;\r\n        default:\r\n          console.warn('[Dispatcher] âš ï¸ æœªçŸ¥æ¶ˆæ¯ç±»å‹:', cmd, data);\r\n      }\r\n    },\r\n    /**\r\n     * å¤„ç†ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢\r\n     */\r\n    handleUserList({ commit, rootState }, data) {\r\n      console.log('[Dispatcher] âœ… æ¥æ”¶åˆ°ç”¨æˆ·åˆ—è¡¨:', data);\r\n      commit('message/SET_USER_LIST', data, { root: true });\r\n    },\r\n    /**\r\n     * ğŸ’¬ å¤„ç†ç§èŠ / ç¾¤èŠæ¶ˆæ¯\r\n     * - åˆ¤æ–­æ˜¯å½“å‰èŠå¤©å¯¹è±¡å°±ç›´æ¥å±•ç¤º\r\n     * - å¦åˆ™å¢åŠ æœªè¯»æ•°\r\n     */\r\n    handleChatMessage({ commit, rootState }, data) {\r\n      const currentId = rootState.chat?.currentContactId;\r\n      const contactId = data.targetType === 'user' ? data.senderId : data.receiverId;\r\n\r\n      console.log(`[Dispatcher] ğŸ’¬ æ¥è‡ª ${data.targetType === 'user' ? 'ç§èŠ' : 'ç¾¤èŠ'} æ¶ˆæ¯: ${contactId}`, data);\r\n\r\n      // æ·»åŠ æ¶ˆæ¯åˆ° Vuex message æ¨¡å—\r\n      commit('message/ADD_MESSAGE', { contactId, message: data }, { root: true });\r\n\r\n      // å½“å‰æ­£åœ¨èŠå¤©çª—å£ä¸æ˜¯è¯¥ä¼šè¯ï¼Œå¢åŠ æœªè¯»æ•°\r\n      if (contactId !== currentId) {\r\n        console.log(`[Dispatcher] ğŸ”´ ${contactId} ä¸æ˜¯å½“å‰çª—å£ï¼Œå¢åŠ æœªè¯»æ•°`);\r\n        commit('message/INCREMENT_UNREAD', contactId, { root: true });\r\n      } else {\r\n        console.log(`[Dispatcher] ğŸŸ¢ å½“å‰çª—å£æ¶ˆæ¯ï¼Œè‡ªåŠ¨å·²è¯»`);\r\n        commit('message/RESET_UNREAD', contactId, { root: true });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * ğŸ“¢ å¤„ç†ç³»ç»Ÿé€šçŸ¥ï¼ˆå¦‚è´¦å·å¼‚å¸¸ã€å®¡æ ¸æˆåŠŸç­‰ï¼‰\r\n     */\r\n    handleSystemMessage({ commit }, data) {\r\n      // è¿™é‡Œå¯æ‰©å±•ä¸ºä¿å­˜åˆ°ç³»ç»Ÿé€šçŸ¥è¡¨ã€æˆ–ç›´æ¥æ˜¾ç¤º UI é€šçŸ¥\r\n      console.info('[Dispatcher] ğŸ“¢ ç³»ç»Ÿé€šçŸ¥:', data.title || data.content);\r\n      // ç¤ºä¾‹ï¼šå¯é›†æˆ notification/toast æ’ä»¶æç¤º\r\n      // this._vm.$notify({ title: data.title, message: data.content });\r\n    },\r\n\r\n    /**\r\n     * ğŸŒ å¤„ç†å…¨ç«™å¹¿æ’­æ¶ˆæ¯ï¼ˆå¦‚ç³»ç»Ÿç»´æŠ¤æé†’ï¼‰\r\n     */\r\n    handleBroadcast({ commit }, data) {\r\n      // é€šå¸¸ç”¨äºä¸æŒä¹…åŒ–çš„å³æ—¶æç¤º\r\n      console.info('[Dispatcher] ğŸŒ å¹¿æ’­æ¶ˆæ¯:', data);\r\n      // ç¤ºä¾‹ï¼šä½¿ç”¨å…¨å±€å¼¹çª—ç»„ä»¶æ˜¾ç¤º\r\n      // this._vm.$toast({ message: data.content, type: data.level || 'info' });\r\n    }\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}