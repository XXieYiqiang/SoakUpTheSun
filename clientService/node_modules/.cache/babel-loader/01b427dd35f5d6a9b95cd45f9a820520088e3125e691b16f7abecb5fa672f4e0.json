{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport FileUploader from '@/components/file/box/uploadFile/Box.vue';\nimport showUploadFileBox from '@/components/file/box/uploadFile/index.js';\nimport SelectColumn from './SelectColumn.vue';\nimport { mapState } from 'vuex';\nexport default {\n  name: 'OperationMenu',\n  components: {\n    FileUploader\n  },\n  props: {\n    // 文件类型\n    fileType: {\n      required: true,\n      type: Number\n    },\n    // 文件路径\n    filePath: {\n      required: true,\n      type: String\n    }\n  },\n  components: {\n    SelectColumn\n  },\n  data() {\n    return {\n      // 文件搜索数据\n      searchFile: {\n        fileName: ''\n      },\n      operatePopoverVisible: false,\n      //  收纳栏是否显示\n      fileGroupLable: 0,\n      //  文件展示模式\n      dirImg: require('_a/images/file/dir.png'),\n      wordImg: require('_a/images/file/file_word.svg'),\n      excelImg: require('_a/images/file/file_excel.svg'),\n      pptImg: require('_a/images/file/file_ppt.svg')\n    };\n  },\n  computed: {\n    ...mapState({\n      showUploadMask: state => state.uploadFile.showUploadMask\n    }),\n    // 上传文件组件参数\n    uploadFileParams() {\n      return {\n        filePath: this.filePath,\n        isDir: 0\n      };\n    },\n    // 文件查看模式 0 列表模式 1 网格模式 2 时间线模式\n    fileModel() {\n      return this.$store.getters.fileModel;\n    },\n    // 图标大小\n    gridSize: {\n      get() {\n        return this.$store.getters.gridSize;\n      },\n      set(val) {\n        this.$store.commit('changeGridSize', val);\n      }\n    },\n    // 被选中的文件列表\n    selectedFiles() {\n      return this.$store.state.fileList.selectedFiles;\n    },\n    // 是否批量操作\n    isBatchOperation() {\n      return this.$store.state.fileList.isBatchOperation;\n    },\n    // 屏幕宽度\n    screenWidth() {\n      return this.$store.state.common.screenWidth;\n    },\n    // 批量下载文件链接\n    batchDownloadLink() {\n      return `${this.$config.baseContext}/filetransfer/batchDownloadFile?userFileIds=${this.selectedFiles.map(item => item.userFileId).join(',')}`;\n    }\n  },\n  watch: {\n    // 显示拖拽上传文件遮罩\n    showUploadMask() {\n      this.handleUploadFileBtnClick(3);\n    },\n    fileType(newValue, oldValue) {\n      console.log('fileType===');\n      console.log('newValue=' + newValue);\n      console.log('oldValue=' + oldValue);\n      if (oldValue === 1 && this.fileModel === 2) {\n        this.$store.commit('changeFileModel', 0);\n        this.fileGroupLable = 0;\n      }\n    },\n    /**\r\n     * 监听收纳栏状态\r\n     * @description 打开时，body 添加点击事件的监听\r\n     */\n    operatePopoverVisible(newValue) {\n      if (newValue === true) {\n        document.body.addEventListener('click', this.closeOperatePopover);\n      } else {\n        document.body.removeEventListener('click', this.closeOperatePopover);\n      }\n    }\n  },\n  mounted() {\n    this.fileGroupLable = this.fileModel;\n  },\n  methods: {\n    /**\r\n     * 新建文件夹按钮点击事件\r\n     * @description 调用新建文件夹服务，并在弹窗确认回调事件中刷新文件列表\r\n     */\n    handleClickAddFolderBtn() {\n      this.$openDialog.addFolder({\n        filePath: this.$route.query.filePath || '/'\n      }).then(res => {\n        if (res === 'confirm') {\n          this.$emit('getTableDataByType');\n        }\n      });\n    },\n    /**\r\n     * 新建 office 文件\r\n     * @description 调用新建 office 文件服务，并在弹窗确认回调事件中刷新文件列表\r\n     * @param {string} 文件扩展名 docx xlsx pptx\r\n     */\n    handleCreateFile(extendName) {\n      this.$openDialog.addFile({\n        extendName: extendName\n      }).then(res => {\n        if (res === 'confirm') {\n          this.$emit('getTableDataByType');\n        }\n      });\n    },\n    /**\r\n     * 上传文件\r\n     */\n    async openUpload() {\n      console.log('this.$openBox.uploadFile');\n      console.log('filePath === ');\n      console.log(this.filePath);\n      console.log('fileType === ');\n      console.log(this.fileType);\n      const result = await showUploadFileBox({\n        params: {\n          headers: {\n            token: 'abc-123'\n          },\n          userId: 10001,\n          filePath: this.filePath\n        },\n        uploadWay: 1,\n        // 1=上传文件\n        serviceEl: this,\n        callType: 1\n      });\n      console.log('result');\n      console.log(result);\n      if (result !== 'cancel') {\n        console.log('上传结果：', result);\n      }\n    },\n    /**\r\n     * 批量删除按钮点击事件\r\n     * @description 区分 删除到回收站中 | 在回收站中彻底删除，调用相应的删除文件接口\r\n     */\n    handleBatchDeleteBtnClick() {\n      this.$openDialog.deleteFile({\n        isBatchOperation: true,\n        fileInfo: this.selectedFiles,\n        deleteMode: this.fileType === 6 ? 2 : 1 //  删除模式：1-删除到回收站 2-彻底删除\n      }).then(res => {\n        if (res === 'confirm') {\n          this.$emit('getTableDataByType');\n          this.$store.dispatch('showStorage');\n        }\n      });\n    },\n    /**\r\n     * 批量移动按钮点击事件\r\n     */\n    handleBatchMoveBtnClick() {\n      if (this.selectedFiles.length > 0) {\n        this.$openDialog.moveFile({\n          isBatchOperation: true,\n          fileInfo: this.selectedFiles\n        }).then(res => {\n          if (res === 'confirm') {\n            this.$emit('getTableDataByType');\n          }\n        });\n      } else {\n        this.$message.warning('请先勾选文件');\n      }\n    },\n    /**\r\n     * 批量分享按钮点击事件\r\n     */\n    handleBatchShareBtnClick() {\n      this.$openDialog.shareFile({\n        fileInfo: this.selectedFiles.map(item => {\n          return {\n            userFileId: item.userFileId\n          };\n        })\n      });\n    },\n    /**\r\n     * 打包批量下载按钮点击事件\r\n     */\n    handleBatchDownloadBtnClick() {\n      console.log('打包批量下载文件操作');\n      console.log(this.batchDownloadLink);\n      this.$refs['batchDownloadRef'].click();\n    },\n    /**\r\n     * 搜索输入框搜索事件\r\n     * @param {string} value 搜索内容\r\n     */\n    handleSearchInputChange(value) {\n      if (value === '') {\n        this.$emit('getTableDataByType');\n      } else {\n        this.$emit('getSearchFileList', value);\n      }\n    },\n    /**\r\n     * 网格模式下，批量操作状态切换\r\n     */\n    handleBatchOperationChange() {\n      this.$store.commit('changeIsBatchOperation', !this.isBatchOperation);\n    },\n    /**\r\n     * 文件查看模式切换\r\n     * @param {number} label 0 列表 1 网格 2 时间线\r\n     */\n    handleFileDisplayModelChange(label) {\n      this.fileGroupLable = label;\n      // 关闭右键菜单事件\n      this.$openBox.contextMenu.close();\n      this.$store.commit('changeFileModel', label);\n      this.handleSearchInputChange(this.searchFile.fileName);\n      // 关闭收纳栏\n      this.operatePopoverVisible = false;\n    },\n    /**\r\n     * 格式化图标大小显示\r\n     * @param {number} val 改变后的数值\r\n     */\n    formatTooltip(val) {\n      return `${val}px`;\n    },\n    /**\r\n     * 关闭收纳栏\r\n     */\n    closeOperatePopover(event) {\n      if (!event.target.className.includes('setting-icon')) {\n        this.operatePopoverVisible = false;\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}