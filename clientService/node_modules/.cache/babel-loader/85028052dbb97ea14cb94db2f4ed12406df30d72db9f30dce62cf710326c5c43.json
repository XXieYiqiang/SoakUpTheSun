{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport router from '@/router/index.js';\nimport { officeFileType, fileSuffixCodeModeMap, markdownFileType } from '@/libs/map.js';\nexport default {\n  name: 'ContextMenu',\n  data() {\n    return {\n      officeFileType,\n      fileSuffixCodeModeMap,\n      markdownFileType,\n      visible: false,\n      //  右键菜单是否显示\n      sortedFileList: [],\n      //  排序后的表格数据\n      // 右键菜单\n      rightMenu: {\n        top: 0,\n        left: 0,\n        bottom: 'auto',\n        right: 'auto'\n      },\n      // 右键解压缩菜单\n      unzipMenu: {\n        top: 0,\n        bottom: 'auto',\n        left: '126px',\n        right: 'auto'\n      },\n      dirImg: require('_a/images/file/dir.png'),\n      wordImg: require('_a/images/file/file_word.svg'),\n      excelImg: require('_a/images/file/file_excel.svg'),\n      pptImg: require('_a/images/file/file_ppt.svg')\n    };\n  },\n  computed: {\n    // 路由名称\n    routeName() {\n      return router.currentRoute.name;\n    },\n    // 左侧菜单选中的文件类型\n    fileType() {\n      return router.currentRoute.query.fileType ? Number(router.currentRoute.query.fileType) : 0;\n    },\n    // 当前路径\n    filePath() {\n      return router.currentRoute.query.filePath;\n    },\n    // 查看按钮是否显示\n    seeBtnShow() {\n      return this.fileType !== 6;\n    },\n    // 删除按钮是否显示\n    deleteBtnShow() {\n      return this.fileType !== 8 && !['Share'].includes(this.routeName);\n    },\n    // 还原按钮是否显示\n    restoreBtnShow() {\n      return this.fileType === 6 && !['Share'].includes(this.routeName);\n    },\n    // 复制按钮是否显示\n    copyBtnShow() {\n      return ![6, 8].includes(this.fileType) && !['Share'].includes(this.routeName);\n    },\n    // 移动按钮是否显示\n    moveBtnShow() {\n      return ![6, 8].includes(this.fileType) && !['Share'].includes(this.routeName);\n    },\n    // 重命名按钮是否显示\n    renameBtnShow() {\n      return ![6, 8].includes(this.fileType) && !['Share'].includes(this.routeName);\n    },\n    // 分享按钮是否显示\n    shareBtnShow() {\n      return ![6, 8].includes(this.fileType) && !['Share'].includes(this.routeName);\n    },\n    // 下载按钮是否显示\n    downloadBtnShow() {\n      return ![6, 8].includes(this.fileType);\n    },\n    // 解压缩按钮是否显示\n    unzipBtnShow() {\n      return ![6, 8].includes(this.fileType) && !['Share'].includes(this.routeName) && ['zip', 'rar', '7z', 'tar', 'gz'].includes(this.selectedFile.extendName);\n    },\n    // 编辑文件夹按钮是否显示\n    folderEditBtnShow() {\n      return ![6, 8].includes(this.fileType) && this.selectedFile.isDir === 1 && !['Share'].includes(this.routeName);\n    },\n    // 在线编辑按钮是否显示\n    onlineEditBtnShow() {\n      return ![6, 8].includes(this.fileType) && (this.officeFileType.includes(this.selectedFile.extendName) || this.markdownFileType.includes(this.selectedFile.extendName) || this.fileSuffixCodeModeMap.has(this.selectedFile.extendName)) && !['Share'].includes(this.routeName);\n    },\n    // 复制链接按钮是否显示\n    copyLinkBtnShow() {\n      return this.fileType === 8;\n    },\n    // 文件详情按钮是否显示\n    detailInfoBtnShow() {\n      return true;\n    },\n    // 上传文件组件参数\n    uploadFileParams() {\n      return {\n        filePath: this.filePath,\n        isDir: 0\n      };\n    }\n  },\n  watch: {\n    /**\r\n     * 监听右键列表状态\r\n     * @description 右键列表打开时，body 添加点击事件的监听\r\n     */\n    visible(newValue) {\n      if (newValue === true) {\n        document.body.addEventListener('click', this.closeRightMenu);\n        this.handleOpenContextMenu();\n      } else {\n        document.body.removeEventListener('click', this.closeRightMenu);\n      }\n    }\n  },\n  methods: {\n    /**\r\n     * 打开右键菜单\r\n     */\n    handleOpenContextMenu() {\n      // 纵坐标设置\n      if (document.body.clientHeight - this.domEvent.clientY < document.querySelectorAll('#rightMenuList > .right-menu-item').length * 36 + 10) {\n        // 如果到底部的距离小于元素总高度\n        this.rightMenu.top = 'auto';\n        this.rightMenu.bottom = `${document.body.clientHeight - this.domEvent.clientY}px`;\n        this.unzipMenu.top = 'auto';\n        this.unzipMenu.bottom = '0px';\n      } else {\n        this.rightMenu.top = `${this.domEvent.clientY}px`;\n        this.rightMenu.bottom = 'auto';\n        this.unzipMenu.top = '0px';\n        this.unzipMenu.bottom = 'auto';\n      }\n      // 横坐标设置\n      if (document.body.clientWidth - this.domEvent.clientX < 138) {\n        // 如果到右边的距离小于元素总宽度\n        this.rightMenu.left = 'auto';\n        this.rightMenu.right = `${document.body.clientWidth - this.domEvent.clientX}px`;\n        this.unzipMenu.left = '-200px';\n        this.unzipMenu.right = 'auto';\n      } else {\n        this.rightMenu.left = `${this.domEvent.clientX + 8}px`;\n        this.rightMenu.right = 'auto';\n        this.unzipMenu.left = '126px';\n        this.unzipMenu.right = 'auto';\n      }\n      this.visible = true;\n    },\n    /**\r\n     * 关闭右键列表\r\n     */\n    closeRightMenu(event) {\n      if (!event.target.className.includes('operate-more-') && !event.target.className.includes('unzip-menu-item')) {\n        this.visible = false;\n        if (this.selectedFile !== undefined) {\n          // 不是在空白处右键时\n          this.callback('cancel');\n        }\n      }\n    },\n    /**\r\n     * 复制按钮点击事件\r\n     * @description 向父组件传递当前操作的文件信息，并打开“复制文件对话框”\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleCopyFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.copyFile({\n        fileInfo\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 移动按钮点击事件\r\n     * @description 向父组件传递当前操作的文件信息，并打开“移动文件对话框”\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleMoveFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.moveFile({\n        isBatchMove: false,\n        fileInfo\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 解压缩按钮点击事件\r\n     * @description 调用解压缩文件接口，并展示新的文件列表\r\n     * @param {object} fileInfo 文件信息\r\n     * @param {number} unzipMode 解压模式 0-解压到当前文件夹， 1-自动创建该文件名目录，并解压到目录里， 2-手动选择解压目录\r\n     */\n    handleUnzipFileBtnClick(fileInfo, unzipMode) {\n      this.visible = false;\n      this.$openDialog.unzipFile({\n        unzipMode: unzipMode,\n        userFileId: fileInfo.userFileId\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 删除按钮点击事件\r\n     * @description 区分 删除到回收站中 | 在回收站中彻底删除，打开确认对话框\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleDeleteFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.deleteFile({\n        isBatchOperation: false,\n        fileInfo,\n        deleteMode: this.fileType === 6 ? 2 : 1 //  删除类型：1-删除到回收站 2-彻底删除\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 还原按钮点击事件\r\n     * @description 调用接口，在回收站中还原文件\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleRestoreFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.restoreFile({\n        deleteBatchNum: fileInfo.deleteBatchNum,\n        filePath: fileInfo.filePath\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 文件重命名按钮点击事件\r\n     * @description 打开确认对话框让用户输入新的文件名\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleRenameFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.renameFile({\n        oldFileName: fileInfo.fileName,\n        userFileId: fileInfo.userFileId\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 文件分享按钮点击事件\r\n     * @description 打开对话框让用户选择过期时间和提取码\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleShareFileBtnClick(fileInfo) {\n      this.visible = false;\n      this.$openDialog.shareFile({\n        fileInfo: [{\n          userFileId: fileInfo.userFileId\n        }]\n      });\n    },\n    /**\r\n     * 编辑文件夹按钮点击事件\r\n     */\n    handleClickFolderEdit() {\n      router.push({\n        name: 'WebIDE',\n        query: {\n          filePath: this.selectedFile.filePath\n        }\n      });\n    },\n    /**\r\n     * 文件在线编辑按钮点击事件\r\n     * @description 打开 代码预览对话框 或 office 编辑页面\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleClickFileEdit(fileInfo) {\n      if (this.officeFileType.includes(fileInfo.extendName)) {\n        // office 编辑页面\n        this.$file.getFileOnlineEditPathByOffice(fileInfo);\n      } else if (this.markdownFileType.includes(fileInfo.extendName)) {\n        // markdown 编辑浮层\n        this.$openBox.markdownPreview({\n          fileInfo: fileInfo,\n          editable: true\n        });\n      } else {\n        // 代码编辑对话框\n        this.$openBox.codePreview({\n          fileInfo: fileInfo,\n          isEdit: true\n        });\n      }\n    },\n    /**\r\n     * 文件详情按钮点击事件\r\n     * @description 打开对话框展示文件完整信息\r\n     * @param {object} fileInfo 文件信息\r\n     */\n    handleShowDetailInfo(fileInfo) {\n      this.visible = false;\n      this.$openDialog.showFileDetail({\n        fileInfo\n      });\n    },\n    /**\r\n     * 新建文件夹按钮点击事件\r\n     * @description 调用新建文件夹服务，并在弹窗确认回调事件中刷新文件列表\r\n     */\n    handleClickAddFolderBtn() {\n      this.$openDialog.addFolder({\n        filePath: router.currentRoute.query.filePath || '/'\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 新建 office 文件\r\n     * @description 调用新建 office 文件服务，并在弹窗确认回调事件中刷新文件列表\r\n     * @param {string} 文件扩展名 docx xlsx pptx\r\n     */\n    handleCreateFile(extendName) {\n      this.$openDialog.addFile({\n        extendName: extendName\n      }).then(res => {\n        this.callback(res);\n      });\n    },\n    /**\r\n     * 上传文件按钮点击事件\r\n     * @description 通过Bus通信，开启全局上传文件流程\r\n     * @param {boolean} uploadWay 上传方式 0-文件上传 1-文件夹上传 2-粘贴图片或拖拽上传\r\n     */\n    handleUploadFileBtnClick(uploadWay) {\n      this.$openBox.uploadFile({\n        params: this.uploadFileParams,\n        uploadWay,\n        serviceEl: this.serviceEl,\n        callType: true //  callType 调用此服务的方式：1 - 顶部栏，2 - 右键菜单\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}