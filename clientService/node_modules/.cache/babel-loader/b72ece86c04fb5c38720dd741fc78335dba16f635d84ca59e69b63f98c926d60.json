{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\nvar _default = exports.default = {\n  data() {\n    return {\n      // UI\n      tableData: [{\n        name: 'ÊµãËØï1'\n      }, {\n        name: 'ÊµãËØï2'\n      }],\n      // WebRTC / ËßÜÈ¢ë\n      stream: null,\n      videoEl: null,\n      canvasEl: null,\n      ctx: null,\n      // WebSocket\n      ws: null,\n      wsReady: false,\n      // ÂÆöÊó∂Âô®\n      captureTimer: null\n    };\n  },\n  computed: {\n    isLogin() {\n      return this.$store.getters['user/isLogin'];\n    },\n    userInfo() {\n      return this.$store.state.user.userInfo || {};\n    }\n  },\n  mounted() {\n    this.videoEl = this.$refs.video;\n    this.canvasEl = this.$refs.canvas;\n    this.ctx = this.canvasEl.getContext('2d');\n  },\n  methods: {\n    /* ================= ÊëÑÂÉèÂ§¥ ================= */\n    async startCamera() {\n      this.stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: 640,\n          height: 480,\n          frameRate: {\n            ideal: 10,\n            max: 15\n          }\n        },\n        audio: false\n      });\n      this.videoEl.srcObject = this.stream;\n    },\n    stopCamera() {\n      if (!this.stream) return;\n      this.stream.getTracks().forEach(t => t.stop());\n      this.stream = null;\n    },\n    /* ================= WebSocket ================= */\n    initWS() {\n      return new Promise((resolve, reject) => {\n        this.ws = new WebSocket('ws://localhost:8080/video');\n        this.ws.binaryType = 'arraybuffer';\n        this.ws.onopen = () => {\n          this.wsReady = true;\n          resolve();\n        };\n        this.ws.onerror = err => {\n          this.wsReady = false;\n          reject(err);\n        };\n        this.ws.onclose = () => {\n          this.wsReady = false;\n        };\n      });\n    },\n    closeWS() {\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n    },\n    /* ================= ÊäΩÂ∏ß ================= */\n    startCapture() {\n      this.canvasEl.width = 640;\n      this.canvasEl.height = 480;\n      this.captureTimer = setInterval(() => {\n        if (!this.wsReady) return;\n        if (this.ws.bufferedAmount > 2 * 1024 * 1024) return;\n        this.ctx.drawImage(this.videoEl, 0, 0, this.canvasEl.width, this.canvasEl.height);\n        this.canvasEl.toBlob(blob => {\n          blob && this.ws.send(blob);\n        }, 'image/jpeg', 0.6);\n      }, 100);\n    },\n    stopCapture() {\n      if (this.captureTimer) {\n        clearInterval(this.captureTimer);\n        this.captureTimer = null;\n      }\n    },\n    /* ================= ÊÄªÊéß ================= */\n    async start() {\n      try {\n        await this.startCamera();\n        await this.initWS();\n        this.startCapture();\n      } catch (e) {\n        console.error('ÂêØÂä®Â§±Ë¥•', e);\n        this.stop();\n      }\n    },\n    stop() {\n      this.stopCapture();\n      this.stopCamera();\n      this.closeWS();\n    }\n  },\n  beforeDestroy() {\n    this.stop();\n  }\n};","map":{"version":3,"names":["data","tableData","name","stream","videoEl","canvasEl","ctx","ws","wsReady","captureTimer","computed","isLogin","$store","getters","userInfo","state","user","mounted","$refs","video","canvas","getContext","methods","startCamera","navigator","mediaDevices","getUserMedia","width","height","frameRate","ideal","max","audio","srcObject","stopCamera","getTracks","forEach","t","stop","initWS","Promise","resolve","reject","WebSocket","binaryType","onopen","onerror","err","onclose","closeWS","close","startCapture","setInterval","bufferedAmount","drawImage","toBlob","blob","send","stopCapture","clearInterval","start","e","console","error","beforeDestroy"],"sources":["src/views/utils/test.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-view\">\r\n    <h1>üí¨ ËÅäÂ§© Âú®Á∫øÁä∂ÊÄÅÔºö{{ isLogin }}</h1>\r\n\r\n    <el-table :data=\"tableData\" border>\r\n      <el-table-column prop=\"name\" label=\"ÂêçÁß∞\" />\r\n    </el-table>\r\n\r\n    <!-- ËßÜÈ¢ëÈááÈõÜÂå∫Âüü -->\r\n    <section class=\"video-box\">\r\n      <video ref=\"video\" autoplay muted playsinline />\r\n      <canvas ref=\"canvas\" style=\"display:none\" />\r\n\r\n      <div class=\"actions\">\r\n        <el-button type=\"primary\" @click=\"start\">ÂºÄÂßã</el-button>\r\n        <el-button type=\"danger\" @click=\"stop\">ÂÅúÊ≠¢</el-button>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      // UI\r\n      tableData: [\r\n        { name: 'ÊµãËØï1' },\r\n        { name: 'ÊµãËØï2' }\r\n      ],\r\n\r\n      // WebRTC / ËßÜÈ¢ë\r\n      stream: null,\r\n      videoEl: null,\r\n      canvasEl: null,\r\n      ctx: null,\r\n\r\n      // WebSocket\r\n      ws: null,\r\n      wsReady: false,\r\n\r\n      // ÂÆöÊó∂Âô®\r\n      captureTimer: null\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    isLogin() {\r\n      return this.$store.getters['user/isLogin']\r\n    },\r\n    userInfo() {\r\n      return this.$store.state.user.userInfo || {}\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    this.videoEl = this.$refs.video\r\n    this.canvasEl = this.$refs.canvas\r\n    this.ctx = this.canvasEl.getContext('2d')\r\n  },\r\n\r\n  methods: {\r\n    /* ================= ÊëÑÂÉèÂ§¥ ================= */\r\n    async startCamera() {\r\n      this.stream = await navigator.mediaDevices.getUserMedia({\r\n        video: {\r\n          width: 640,\r\n          height: 480,\r\n          frameRate: { ideal: 10, max: 15 }\r\n        },\r\n        audio: false\r\n      })\r\n\r\n      this.videoEl.srcObject = this.stream\r\n    },\r\n\r\n    stopCamera() {\r\n      if (!this.stream) return\r\n      this.stream.getTracks().forEach(t => t.stop())\r\n      this.stream = null\r\n    },\r\n\r\n    /* ================= WebSocket ================= */\r\n    initWS() {\r\n      return new Promise((resolve, reject) => {\r\n        this.ws = new WebSocket('ws://localhost:8080/video')\r\n        this.ws.binaryType = 'arraybuffer'\r\n\r\n        this.ws.onopen = () => {\r\n          this.wsReady = true\r\n          resolve()\r\n        }\r\n\r\n        this.ws.onerror = err => {\r\n          this.wsReady = false\r\n          reject(err)\r\n        }\r\n\r\n        this.ws.onclose = () => {\r\n          this.wsReady = false\r\n        }\r\n      })\r\n    },\r\n\r\n    closeWS() {\r\n      if (this.ws) {\r\n        this.ws.close()\r\n        this.ws = null\r\n      }\r\n    },\r\n\r\n    /* ================= ÊäΩÂ∏ß ================= */\r\n    startCapture() {\r\n      this.canvasEl.width = 640\r\n      this.canvasEl.height = 480\r\n\r\n      this.captureTimer = setInterval(() => {\r\n        if (!this.wsReady) return\r\n        if (this.ws.bufferedAmount > 2 * 1024 * 1024) return\r\n\r\n        this.ctx.drawImage(\r\n          this.videoEl,\r\n          0,\r\n          0,\r\n          this.canvasEl.width,\r\n          this.canvasEl.height\r\n        )\r\n\r\n        this.canvasEl.toBlob(blob => {\r\n          blob && this.ws.send(blob)\r\n        }, 'image/jpeg', 0.6)\r\n      }, 100)\r\n    },\r\n\r\n    stopCapture() {\r\n      if (this.captureTimer) {\r\n        clearInterval(this.captureTimer)\r\n        this.captureTimer = null\r\n      }\r\n    },\r\n\r\n    /* ================= ÊÄªÊéß ================= */\r\n    async start() {\r\n      try {\r\n        await this.startCamera()\r\n        await this.initWS()\r\n        this.startCapture()\r\n      } catch (e) {\r\n        console.error('ÂêØÂä®Â§±Ë¥•', e)\r\n        this.stop()\r\n      }\r\n    },\r\n\r\n    stop() {\r\n      this.stopCapture()\r\n      this.stopCamera()\r\n      this.closeWS()\r\n    }\r\n  },\r\n\r\n  beforeDestroy() {\r\n    this.stop()\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped></style>"],"mappings":";;;;;;;;iCAuBA;EACAA,KAAA;IACA;MACA;MACAC,SAAA,GACA;QAAAC,IAAA;MAAA,GACA;QAAAA,IAAA;MAAA,EACA;MAEA;MACAC,MAAA;MACAC,OAAA;MACAC,QAAA;MACAC,GAAA;MAEA;MACAC,EAAA;MACAC,OAAA;MAEA;MACAC,YAAA;IACA;EACA;EAEAC,QAAA;IACAC,QAAA;MACA,YAAAC,MAAA,CAAAC,OAAA;IACA;IACAC,SAAA;MACA,YAAAF,MAAA,CAAAG,KAAA,CAAAC,IAAA,CAAAF,QAAA;IACA;EACA;EAEAG,QAAA;IACA,KAAAb,OAAA,QAAAc,KAAA,CAAAC,KAAA;IACA,KAAAd,QAAA,QAAAa,KAAA,CAAAE,MAAA;IACA,KAAAd,GAAA,QAAAD,QAAA,CAAAgB,UAAA;EACA;EAEAC,OAAA;IACA;IACA,MAAAC,YAAA;MACA,KAAApB,MAAA,SAAAqB,SAAA,CAAAC,YAAA,CAAAC,YAAA;QACAP,KAAA;UACAQ,KAAA;UACAC,MAAA;UACAC,SAAA;YAAAC,KAAA;YAAAC,GAAA;UAAA;QACA;QACAC,KAAA;MACA;MAEA,KAAA5B,OAAA,CAAA6B,SAAA,QAAA9B,MAAA;IACA;IAEA+B,WAAA;MACA,UAAA/B,MAAA;MACA,KAAAA,MAAA,CAAAgC,SAAA,GAAAC,OAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,IAAA;MACA,KAAAnC,MAAA;IACA;IAEA;IACAoC,OAAA;MACA,WAAAC,OAAA,EAAAC,OAAA,EAAAC,MAAA;QACA,KAAAnC,EAAA,OAAAoC,SAAA;QACA,KAAApC,EAAA,CAAAqC,UAAA;QAEA,KAAArC,EAAA,CAAAsC,MAAA;UACA,KAAArC,OAAA;UACAiC,OAAA;QACA;QAEA,KAAAlC,EAAA,CAAAuC,OAAA,GAAAC,GAAA;UACA,KAAAvC,OAAA;UACAkC,MAAA,CAAAK,GAAA;QACA;QAEA,KAAAxC,EAAA,CAAAyC,OAAA;UACA,KAAAxC,OAAA;QACA;MACA;IACA;IAEAyC,QAAA;MACA,SAAA1C,EAAA;QACA,KAAAA,EAAA,CAAA2C,KAAA;QACA,KAAA3C,EAAA;MACA;IACA;IAEA;IACA4C,aAAA;MACA,KAAA9C,QAAA,CAAAsB,KAAA;MACA,KAAAtB,QAAA,CAAAuB,MAAA;MAEA,KAAAnB,YAAA,GAAA2C,WAAA;QACA,UAAA5C,OAAA;QACA,SAAAD,EAAA,CAAA8C,cAAA;QAEA,KAAA/C,GAAA,CAAAgD,SAAA,CACA,KAAAlD,OAAA,EACA,GACA,GACA,KAAAC,QAAA,CAAAsB,KAAA,EACA,KAAAtB,QAAA,CAAAuB,MACA;QAEA,KAAAvB,QAAA,CAAAkD,MAAA,CAAAC,IAAA;UACAA,IAAA,SAAAjD,EAAA,CAAAkD,IAAA,CAAAD,IAAA;QACA;MACA;IACA;IAEAE,YAAA;MACA,SAAAjD,YAAA;QACAkD,aAAA,MAAAlD,YAAA;QACA,KAAAA,YAAA;MACA;IACA;IAEA;IACA,MAAAmD,MAAA;MACA;QACA,WAAArC,WAAA;QACA,WAAAgB,MAAA;QACA,KAAAY,YAAA;MACA,SAAAU,CAAA;QACAC,OAAA,CAAAC,KAAA,SAAAF,CAAA;QACA,KAAAvB,IAAA;MACA;IACA;IAEAA,KAAA;MACA,KAAAoB,WAAA;MACA,KAAAxB,UAAA;MACA,KAAAe,OAAA;IACA;EACA;EAEAe,cAAA;IACA,KAAA1B,IAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}