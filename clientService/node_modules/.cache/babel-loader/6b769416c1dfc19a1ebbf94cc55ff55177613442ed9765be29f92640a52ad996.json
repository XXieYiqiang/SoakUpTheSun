{"ast":null,"code":"import Vue from 'vue';\n// 导入组件\nimport ContextMenu from './Box.vue';\n// 使用基础 Vue 构造器，创建一个“子类”\nconst ContextMenuConstructor = Vue.extend(ContextMenu);\nlet contextMenuInstance = null;\n/**\r\n * 初始化右键菜单实例\r\n * @param {string} selectedFile 文件信息，如果此值为 undefined，证明是在空白触右键\r\n * @param {object} domEvent 当前右键点击的元素\r\n * @param {} serviceEl 调用当前服务的组件实例\r\n * @param {} callType 是否组件本身\r\n */\nconst initInstanceContextMenu = (selectedFile, domEvent, serviceEl, callType) => {\n  contextMenuInstance = new ContextMenuConstructor({\n    el: document.createElement('div'),\n    data() {\n      return {\n        selectedFile,\n        domEvent,\n        serviceEl,\n        callType\n      };\n    }\n  });\n};\n/**\r\n * 右键菜单 Promise 函数\r\n * @returns {Promise} 抛出确认和取消回调函数\r\n */\nconst showContextMenuBox = obj => {\n  // 非首次调用服务时，在 DOM 中移除上个实例\n  if (contextMenuInstance !== null) {\n    document.body.removeChild(contextMenuInstance.$el);\n  }\n  let {\n    selectedFile,\n    domEvent,\n    serviceEl,\n    callType\n  } = obj;\n  return new Promise(reslove => {\n    initInstanceContextMenu(selectedFile, domEvent, serviceEl, callType);\n    contextMenuInstance.callback = res => {\n      reslove(res);\n      // 服务取消时卸载 DOM\n      if (res === 'cancel' && contextMenuInstance !== null) {\n        document.body.removeChild(contextMenuInstance.$el);\n        contextMenuInstance = null;\n      }\n    };\n    document.body.appendChild(contextMenuInstance.$el); //  挂载 DOM\n    Vue.nextTick(() => {\n      contextMenuInstance.handleOpenContextMenu(); //  开始计算右键菜单需要显示的位置\n    });\n  });\n};\n\n// 添加关闭事件\nshowContextMenuBox.close = () => {\n  if (contextMenuInstance !== null) {\n    document.body.removeChild(contextMenuInstance.$el);\n    contextMenuInstance = null;\n  }\n};\nexport default showContextMenuBox;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}