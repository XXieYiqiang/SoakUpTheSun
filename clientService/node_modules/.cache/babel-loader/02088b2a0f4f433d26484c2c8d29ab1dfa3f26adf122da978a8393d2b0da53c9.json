{"ast":null,"code":"import { mavonEditor } from 'mavon-editor';\nimport 'mavon-editor/dist/css/index.css';\n// 代码高亮样式表\nimport '_public/mavonEditor/css/tomorrow-night.css';\nimport '_public/mavonEditor/css/github-markdown.css';\nimport store from '@/store/index.js';\nimport { getFilePreview, modifyFileContent, getFilePreviewKnowledge } from '_r/file.js';\nexport default {\n  name: 'ImgPreview',\n  components: {\n    mavonEditor\n  },\n  data() {\n    return {\n      visible: false,\n      //  markdown 预览遮罩层组件是否显示\n      originalMarkdownText: '',\n      //  markdown 原本的文本\n      markdownText: '',\n      //  markdown 实时修改的文本\n      markdownLoading: false,\n      //  markdown 内容是否加载中\n      // 工具栏\n      toolbars: {\n        bold: true,\n        // 粗体\n        italic: true,\n        // 斜体\n        header: true,\n        // 标题\n        underline: true,\n        // 下划线\n        strikethrough: true,\n        // 中划线\n        mark: true,\n        // 标记\n        superscript: true,\n        // 上角标\n        subscript: true,\n        // 下角标\n        quote: true,\n        // 引用\n        ol: true,\n        // 有序列表\n        ul: true,\n        // 无序列表\n        link: true,\n        // 链接\n        imagelink: true,\n        // 图片链接\n        code: true,\n        // code\n        table: true,\n        // 表格\n        fullscreen: true,\n        // 全屏编辑\n        readmodel: true,\n        // 沉浸式阅读\n        htmlcode: true,\n        // 展示html源码\n        help: true,\n        // 帮助\n        /* 1.3.5 */\n        undo: true,\n        // 上一步\n        redo: true,\n        // 下一步\n        trash: true,\n        // 清空\n        save: true,\n        // 保存（触发 events 中的 save 事件）\n        /* 1.4.2 */\n        navigation: true,\n        // 导航目录\n        /* 2.1.8 */\n        alignleft: true,\n        // 左对齐\n        aligncenter: true,\n        // 居中\n        alignright: true,\n        // 右对齐\n        /* 2.2.1 */\n        subfield: true,\n        // 单双栏模式\n        preview: true // 预览\n      }\n    };\n  },\n  computed: {\n    // 屏幕宽度\n    screenWidth() {\n      return store.state.common.screenWidth;\n    },\n    // 是否修改\n    isModify() {\n      return this.originalMarkdownText !== this.markdownText;\n    },\n    // 外链 cdn 改为本地引入\n    externalLink() {\n      let context = process.env.NODE_ENV === 'production' ? '/' //  生产环境\n      : '/'; //  开发环境\n      return {\n        markdown_css: function () {\n          // 这是你的markdown css文件路径\n          return `${context}mavonEditor/css/github-markdown.css`;\n        },\n        hljs_js: function () {\n          // 这是你的hljs文件路径\n          return `${context}mavonEditor/js/highlight.min.js`;\n        },\n        hljs_css: function () {\n          // 这是你的代码高亮配色文件路径\n          return `${context}mavonEditor/css/tomorrow-night.css`;\n        },\n        hljs_lang: function () {\n          // 这是你的代码高亮语言解析路径\n          return `${context}mavonEditor/js/lang.hljs.js`;\n        },\n        katex_css: function () {\n          // 这是你的katex配色方案路径路径\n          return `${context}mavonEditor/css/katex.min.css`;\n        },\n        katex_js: function () {\n          // 这是你的katex.js路径\n          return `${context}mavonEditor/js/katex.min.js`;\n        }\n      };\n    },\n    // 工具栏是否展示\n    toolbarsFlag() {\n      return this.editable;\n    }\n  },\n  watch: {\n    // 监听 markdown 查看组件 显隐状态变化\n    visible(val) {\n      if (val) {\n        this.getMarkdownText();\n        // 添加键盘 Esc 事件\n        this.$nextTick(() => {\n          document.addEventListener('keyup', e => {\n            if (e.keyCode === 27) {\n              this.closeMarkdownPreview();\n            }\n          });\n        });\n      } else {\n        document.removeEventListener('keyup', e => {\n          if (e.keyCode === 27) {\n            this.closeMarkdownPreview();\n          }\n        });\n      }\n    }\n  },\n  methods: {\n    /**\r\n     * 获取 markdown 文本内容\r\n     */\n    getMarkdownText() {\n      console.log(' 获取 markdown 文本内容');\n      if (this.fileInfo.sourceType === undefined || this.fileInfo.sourceType === '' || this.fileInfo.sourceType === null) {\n        this.fileInfo.sourceType = '0';\n      }\n      this.markdownLoading = true;\n      if (this.fileInfo.sourceType === '1') {\n        //兼容知识库文件预览\n        const param = {\n          ...this.fileInfo\n        };\n        getFilePreviewKnowledge(param).then(res => {\n          this.markdownLoading = false;\n          this.originalMarkdownText = res.data;\n          this.markdownText = res.data;\n        });\n      } else {\n        getFilePreview({\n          userFileId: this.fileInfo.userFileId,\n          isMin: false,\n          shareBatchNum: this.fileInfo.shareBatchNum,\n          extractionCode: this.fileInfo.extractionCode,\n          token: this.$common.getCookies(this.$config.tokenKeyName)\n        }).then(res => {\n          this.markdownLoading = false;\n          this.originalMarkdownText = res.data;\n          this.markdownText = res.data;\n        });\n      }\n    },\n    /**\r\n     * 修改 markdown 文本内容\r\n     */\n    handleModifyFileContent() {\n      this.markdownLoading = true;\n      modifyFileContent({\n        userFileId: this.fileInfo.userFileId,\n        fileContent: this.markdownText\n      }).then(res => {\n        this.markdownLoading = false;\n        console.log('res handleModifyFileContent =');\n        console.log(res);\n        if (res.data.code === 200) {\n          this.$message.success('已保存');\n          this.getMarkdownText();\n        } else {\n          this.$message.error(res.message);\n        }\n      }).catch(err => {\n        this.markdownLoading = false;\n        this.$message.error(err.message);\n      });\n    },\n    /**\r\n     * 关闭 markdown 预览\r\n     */\n    closeMarkdownPreview() {\n      this.visible = false;\n      this.callback('cancel');\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}