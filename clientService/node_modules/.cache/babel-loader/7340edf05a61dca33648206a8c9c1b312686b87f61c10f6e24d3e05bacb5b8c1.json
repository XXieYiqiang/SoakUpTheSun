{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/Administrator/Desktop/GimChat/gimChatVue/node_modules/@babel/runtime/helpers/interopRequireDefault.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\nvar _RightBar = _interopRequireDefault(require(\"@/components/RightBar.vue\"));\nvar _default = exports.default = {\n  components: {\n    RightBar: _RightBar.default\n  },\n  data() {\n    return {\n      image: null,\n      video: null,\n      result: null,\n      defaultAvatar: 'https://iknow-pic.cdn.bcebos.com/962bd40735fae6cd17bafbff1db30f2442a70f25',\n      isRightbarCollapsed: true,\n      tableData: [{\n        name: 'ÊµãËØï1'\n      }, {\n        name: 'ÊµãËØï2'\n      }]\n    };\n  },\n  computed: {\n    isLogin() {\n      return this.$store.getters['user/isLogin'];\n    },\n    userInfo() {\n      return this.$store.state.user.userInfo || {};\n    }\n  },\n  async mounted() {},\n  methods: {\n    async startCamera() {\n      this.stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: 640,\n          height: 480,\n          frameRate: {\n            ideal: 10,\n            max: 15\n          }\n        },\n        audio: false\n      });\n      this.$refs.video.srcObject = this.stream;\n    },\n    initWS() {\n      this.ws = new WebSocket('ws://localhost:8080/video');\n      this.ws.binaryType = 'arraybuffer';\n    },\n    startCapture() {\n      const video = this.$refs.video;\n      const canvas = this.$refs.canvas;\n      const ctx = canvas.getContext('2d');\n      canvas.width = 640;\n      canvas.height = 480;\n      this.timer = setInterval(() => {\n        if (this.ws.readyState !== 1) return;\n\n        // ËÉåÂéãÊéßÂà∂\n        if (this.ws.bufferedAmount > 2 * 1024 * 1024) return;\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        canvas.toBlob(blob => {\n          this.ws.send(blob);\n        }, 'image/jpeg', 0.6);\n      }, 100); // 10 FPS\n    },\n    async start() {\n      await this.startCamera();\n      this.initWS();\n      this.startCapture();\n    },\n    stop() {\n      clearInterval(this.timer);\n      this.stream.getTracks().forEach(t => t.stop());\n      this.ws.close();\n    }\n  },\n  beforeDestroy() {\n    this.stop();\n  }\n};","map":{"version":3,"names":["_RightBar","_interopRequireDefault","require","_default","exports","default","components","RightBar","data","image","video","result","defaultAvatar","isRightbarCollapsed","tableData","name","computed","isLogin","$store","getters","userInfo","state","user","mounted","methods","startCamera","stream","navigator","mediaDevices","getUserMedia","width","height","frameRate","ideal","max","audio","$refs","srcObject","initWS","ws","WebSocket","binaryType","startCapture","canvas","ctx","getContext","timer","setInterval","readyState","bufferedAmount","drawImage","toBlob","blob","send","start","stop","clearInterval","getTracks","forEach","t","close","beforeDestroy"],"sources":["src/views/SettingView.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-view\">\r\n    <h1>üí¨ ËÅäÂ§© Âú®Á∫øÁä∂ÊÄÅÔºö{{ isLogin }}</h1>\r\n    <p>SettingView</p>\r\n\r\n    <p>ÁôªÂΩïÁî®Êà∑‰ø°ÊÅØÔºö{{ userInfo }}</p>\r\n\r\n\r\n    <el-table :data=\"tableData\" border>\r\n      <el-table-column prop=\"name\" label=\"ÂêçÁß∞\"></el-table-column>\r\n    </el-table>\r\n\r\n    <div>\r\n      <video ref=\"video\" autoplay muted playsinline></video>\r\n      <canvas ref=\"canvas\" style=\"display:none\"></canvas>\r\n\r\n      <button @click=\"start\">ÂºÄÂßã</button>\r\n      <button @click=\"stop\">ÂÅúÊ≠¢</button>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RightBar from '@/components/RightBar.vue'\r\nexport default {\r\n  components: { RightBar },\r\n  data() {\r\n    return {\r\n      image: null,\r\n      video: null,\r\n      result: null,\r\n      defaultAvatar: 'https://iknow-pic.cdn.bcebos.com/962bd40735fae6cd17bafbff1db30f2442a70f25',\r\n      isRightbarCollapsed: true,\r\n      tableData: [\r\n        { name: 'ÊµãËØï1' },\r\n        { name: 'ÊµãËØï2' }\r\n      ]\r\n    };\r\n  },\r\n  computed: {\r\n    isLogin() {\r\n      return this.$store.getters['user/isLogin'];\r\n    },\r\n    userInfo() {\r\n      return this.$store.state.user.userInfo || {}\r\n    }\r\n  },\r\n  async mounted() {\r\n\r\n  },\r\n  methods: {\r\n\r\n    async startCamera() {\r\n      this.stream = await navigator.mediaDevices.getUserMedia({\r\n        video: {\r\n          width: 640,\r\n          height: 480,\r\n          frameRate: { ideal: 10, max: 15 }\r\n        },\r\n        audio: false\r\n      })\r\n\r\n      this.$refs.video.srcObject = this.stream\r\n    },\r\n\r\n    initWS() {\r\n      this.ws = new WebSocket('ws://localhost:8080/video')\r\n      this.ws.binaryType = 'arraybuffer'\r\n    },\r\n    startCapture() {\r\n      const video = this.$refs.video\r\n      const canvas = this.$refs.canvas\r\n      const ctx = canvas.getContext('2d')\r\n\r\n      canvas.width = 640\r\n      canvas.height = 480\r\n\r\n      this.timer = setInterval(() => {\r\n        if (this.ws.readyState !== 1) return\r\n\r\n        // ËÉåÂéãÊéßÂà∂\r\n        if (this.ws.bufferedAmount > 2 * 1024 * 1024) return\r\n\r\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\r\n\r\n        canvas.toBlob(blob => {\r\n          this.ws.send(blob)\r\n        }, 'image/jpeg', 0.6)\r\n\r\n      }, 100) // 10 FPS\r\n    },\r\n    async start() {\r\n      await this.startCamera()\r\n      this.initWS()\r\n      this.startCapture()\r\n    },\r\n\r\n    stop() {\r\n      clearInterval(this.timer)\r\n      this.stream.getTracks().forEach(t => t.stop())\r\n      this.ws.close()\r\n    }\r\n\r\n  },\r\n\r\n  beforeDestroy() {\r\n    this.stop()\r\n  }\r\n\r\n\r\n};\r\n</script>\r\n\r\n<style scoped></style>"],"mappings":";;;;;;;;;AAwBA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AAAA,IAAAC,QAAA,GAAAC,OAAA,CAAAC,OAAA,GACA;EACAC,UAAA;IAAAC,QAAA,EAAAA;EAAA;EACAC,KAAA;IACA;MACAC,KAAA;MACAC,KAAA;MACAC,MAAA;MACAC,aAAA;MACAC,mBAAA;MACAC,SAAA,GACA;QAAAC,IAAA;MAAA,GACA;QAAAA,IAAA;MAAA;IAEA;EACA;EACAC,QAAA;IACAC,QAAA;MACA,YAAAC,MAAA,CAAAC,OAAA;IACA;IACAC,SAAA;MACA,YAAAF,MAAA,CAAAG,KAAA,CAAAC,IAAA,CAAAF,QAAA;IACA;EACA;EACA,MAAAG,QAAA,GAEA;EACAC,OAAA;IAEA,MAAAC,YAAA;MACA,KAAAC,MAAA,SAAAC,SAAA,CAAAC,YAAA,CAAAC,YAAA;QACAnB,KAAA;UACAoB,KAAA;UACAC,MAAA;UACAC,SAAA;YAAAC,KAAA;YAAAC,GAAA;UAAA;QACA;QACAC,KAAA;MACA;MAEA,KAAAC,KAAA,CAAA1B,KAAA,CAAA2B,SAAA,QAAAX,MAAA;IACA;IAEAY,OAAA;MACA,KAAAC,EAAA,OAAAC,SAAA;MACA,KAAAD,EAAA,CAAAE,UAAA;IACA;IACAC,aAAA;MACA,MAAAhC,KAAA,QAAA0B,KAAA,CAAA1B,KAAA;MACA,MAAAiC,MAAA,QAAAP,KAAA,CAAAO,MAAA;MACA,MAAAC,GAAA,GAAAD,MAAA,CAAAE,UAAA;MAEAF,MAAA,CAAAb,KAAA;MACAa,MAAA,CAAAZ,MAAA;MAEA,KAAAe,KAAA,GAAAC,WAAA;QACA,SAAAR,EAAA,CAAAS,UAAA;;QAEA;QACA,SAAAT,EAAA,CAAAU,cAAA;QAEAL,GAAA,CAAAM,SAAA,CAAAxC,KAAA,QAAAiC,MAAA,CAAAb,KAAA,EAAAa,MAAA,CAAAZ,MAAA;QAEAY,MAAA,CAAAQ,MAAA,CAAAC,IAAA;UACA,KAAAb,EAAA,CAAAc,IAAA,CAAAD,IAAA;QACA;MAEA;IACA;IACA,MAAAE,MAAA;MACA,WAAA7B,WAAA;MACA,KAAAa,MAAA;MACA,KAAAI,YAAA;IACA;IAEAa,KAAA;MACAC,aAAA,MAAAV,KAAA;MACA,KAAApB,MAAA,CAAA+B,SAAA,GAAAC,OAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAJ,IAAA;MACA,KAAAhB,EAAA,CAAAqB,KAAA;IACA;EAEA;EAEAC,cAAA;IACA,KAAAN,IAAA;EACA;AAGA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}