{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\nvar _default = exports.default = {\n  name: 'WebRTCView',\n  data() {\n    return {\n      // WebRTC\n      pc: null,\n      localStream: null,\n      // WebSocket ‰ø°‰ª§\n      ws: null,\n      userId: '',\n      targetId: '',\n      // ICE\n      iceServers: {\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      }\n    };\n  },\n  mounted() {\n    this.userId = Math.random().toString(36).slice(2, 8);\n    this.initSignalWS();\n  },\n  methods: {\n    /* ================= ‰ø°‰ª§ WS ================= */\n    initSignalWS() {\n      this.ws = new WebSocket('ws://localhost:9876/webrtc');\n      this.ws.onopen = () => {\n        console.log('üì° ‰ø°‰ª§ WS Â∑≤ËøûÊé•, userId=', this.userId);\n      };\n      this.ws.onmessage = async e => {\n        const msg = JSON.parse(e.data);\n        await this.handleSignal(msg);\n      };\n      this.ws.onerror = e => {\n        console.error('WS ÈîôËØØ', e);\n      };\n    },\n    sendSignal(type, data) {\n      this.ws.send(JSON.stringify({\n        type,\n        from: this.userId,\n        to: this.targetId,\n        data\n      }));\n    },\n    /* ================= Â™í‰Ωì ================= */\n    async initMedia() {\n      this.localStream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      });\n      this.$refs.localVideo.srcObject = this.localStream;\n    },\n    /* ================= PeerConnection ================= */\n    createPeerConnection() {\n      this.pc = new RTCPeerConnection(this.iceServers);\n\n      // Êú¨Âú∞ËΩ®ÈÅì\n      this.localStream.getTracks().forEach(track => {\n        this.pc.addTrack(track, this.localStream);\n      });\n\n      // ËøúÁ´ØÊµÅ\n      this.pc.ontrack = e => {\n        console.log('üéØ Êî∂Âà∞ËøúÁ´ØÊµÅ');\n        this.$refs.remoteVideo.srcObject = e.streams[0];\n      };\n\n      // ICE\n      this.pc.onicecandidate = e => {\n        if (e.candidate) {\n          this.sendSignal('candidate', e.candidate);\n        }\n      };\n    },\n    /* ================= ÂëºÂè´ ================= */\n    async startCall() {\n      await this.initMedia();\n      this.createPeerConnection();\n      const offer = await this.pc.createOffer();\n      await this.pc.setLocalDescription(offer);\n      this.sendSignal('offer', offer);\n    },\n    /* ================= ‰ø°‰ª§Â§ÑÁêÜ ================= */\n    async handleSignal(msg) {\n      // ÂøΩÁï•ÈùûÁõÆÊ†áÊ∂àÊÅØ\n      if (msg.to !== this.userId) return;\n      switch (msg.type) {\n        case 'offer':\n          await this.initMedia();\n          this.createPeerConnection();\n          await this.pc.setRemoteDescription(msg.data);\n          const answer = await this.pc.createAnswer();\n          await this.pc.setLocalDescription(answer);\n          this.targetId = msg.from;\n          this.sendSignal('answer', answer);\n          break;\n        case 'answer':\n          await this.pc.setRemoteDescription(msg.data);\n          break;\n        case 'candidate':\n          if (this.pc) {\n            await this.pc.addIceCandidate(msg.data);\n          }\n          break;\n      }\n    },\n    /* ================= ÊåÇÊñ≠ ================= */\n    hangup() {\n      if (this.pc) {\n        this.pc.close();\n        this.pc = null;\n      }\n      if (this.localStream) {\n        this.localStream.getTracks().forEach(t => t.stop());\n        this.localStream = null;\n      }\n      this.$refs.localVideo.srcObject = null;\n      this.$refs.remoteVideo.srcObject = null;\n    }\n  },\n  beforeDestroy() {\n    this.hangup();\n    this.ws && this.ws.close();\n  }\n};","map":{"version":3,"names":["name","data","pc","localStream","ws","userId","targetId","iceServers","urls","mounted","Math","random","toString","slice","initSignalWS","methods","WebSocket","onopen","console","log","onmessage","e","msg","JSON","parse","handleSignal","onerror","error","sendSignal","type","send","stringify","from","to","initMedia","navigator","mediaDevices","getUserMedia","video","audio","$refs","localVideo","srcObject","createPeerConnection","RTCPeerConnection","getTracks","forEach","track","addTrack","ontrack","remoteVideo","streams","onicecandidate","candidate","startCall","offer","createOffer","setLocalDescription","setRemoteDescription","answer","createAnswer","addIceCandidate","hangup","close","t","stop","beforeDestroy"],"sources":["src/views/utils/test2.vue"],"sourcesContent":["<template>\r\n  <div class=\"webrtc-container\">\r\n    <h2>üé• WebRTC Demo</h2>\r\n\r\n    <div class=\"video-box\">\r\n      <video ref=\"localVideo\" autoplay muted playsinline></video>\r\n      <video ref=\"remoteVideo\" autoplay playsinline></video>\r\n    </div>\r\n\r\n    <div class=\"actions\">\r\n      <el-input v-model=\"targetId\" placeholder=\"ÂØπÊñπID\"></el-input>\r\n      <el-button type=\"primary\" @click=\"startCall\">ÂëºÂè´</el-button>\r\n      <el-button type=\"danger\" @click=\"hangup\">ÊåÇÊñ≠</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'WebRTCView',\r\n\r\n  data() {\r\n    return {\r\n      // WebRTC\r\n      pc: null,\r\n      localStream: null,\r\n\r\n      // WebSocket ‰ø°‰ª§\r\n      ws: null,\r\n      userId: '',\r\n      targetId: '',\r\n\r\n      // ICE\r\n      iceServers: {\r\n        iceServers: [\r\n          { urls: 'stun:stun.l.google.com:19302' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    this.userId = Math.random().toString(36).slice(2, 8)\r\n    this.initSignalWS()\r\n  },\r\n\r\n  methods: {\r\n    /* ================= ‰ø°‰ª§ WS ================= */\r\n    initSignalWS() {\r\n      this.ws = new WebSocket('ws://localhost:9876/webrtc')\r\n\r\n      this.ws.onopen = () => {\r\n        console.log('üì° ‰ø°‰ª§ WS Â∑≤ËøûÊé•, userId=', this.userId)\r\n      }\r\n\r\n      this.ws.onmessage = async e => {\r\n        const msg = JSON.parse(e.data)\r\n        await this.handleSignal(msg)\r\n      }\r\n\r\n      this.ws.onerror = e => {\r\n        console.error('WS ÈîôËØØ', e)\r\n      }\r\n    },\r\n\r\n    sendSignal(type, data) {\r\n      this.ws.send(JSON.stringify({\r\n        type,\r\n        from: this.userId,\r\n        to: this.targetId,\r\n        data\r\n      }))\r\n    },\r\n\r\n    /* ================= Â™í‰Ωì ================= */\r\n    async initMedia() {\r\n      this.localStream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true\r\n      })\r\n      this.$refs.localVideo.srcObject = this.localStream\r\n    },\r\n\r\n    /* ================= PeerConnection ================= */\r\n    createPeerConnection() {\r\n      this.pc = new RTCPeerConnection(this.iceServers)\r\n\r\n      // Êú¨Âú∞ËΩ®ÈÅì\r\n      this.localStream.getTracks().forEach(track => {\r\n        this.pc.addTrack(track, this.localStream)\r\n      })\r\n\r\n      // ËøúÁ´ØÊµÅ\r\n      this.pc.ontrack = e => {\r\n        console.log('üéØ Êî∂Âà∞ËøúÁ´ØÊµÅ')\r\n        this.$refs.remoteVideo.srcObject = e.streams[0]\r\n      }\r\n\r\n      // ICE\r\n      this.pc.onicecandidate = e => {\r\n        if (e.candidate) {\r\n          this.sendSignal('candidate', e.candidate)\r\n        }\r\n      }\r\n    },\r\n\r\n    /* ================= ÂëºÂè´ ================= */\r\n    async startCall() {\r\n      await this.initMedia()\r\n      this.createPeerConnection()\r\n\r\n      const offer = await this.pc.createOffer()\r\n      await this.pc.setLocalDescription(offer)\r\n\r\n      this.sendSignal('offer', offer)\r\n    },\r\n\r\n    /* ================= ‰ø°‰ª§Â§ÑÁêÜ ================= */\r\n    async handleSignal(msg) {\r\n      // ÂøΩÁï•ÈùûÁõÆÊ†áÊ∂àÊÅØ\r\n      if (msg.to !== this.userId) return\r\n\r\n      switch (msg.type) {\r\n        case 'offer':\r\n          await this.initMedia()\r\n          this.createPeerConnection()\r\n          await this.pc.setRemoteDescription(msg.data)\r\n\r\n          const answer = await this.pc.createAnswer()\r\n          await this.pc.setLocalDescription(answer)\r\n\r\n          this.targetId = msg.from\r\n          this.sendSignal('answer', answer)\r\n          break\r\n\r\n        case 'answer':\r\n          await this.pc.setRemoteDescription(msg.data)\r\n          break\r\n\r\n        case 'candidate':\r\n          if (this.pc) {\r\n            await this.pc.addIceCandidate(msg.data)\r\n          }\r\n          break\r\n      }\r\n    },\r\n\r\n    /* ================= ÊåÇÊñ≠ ================= */\r\n    hangup() {\r\n      if (this.pc) {\r\n        this.pc.close()\r\n        this.pc = null\r\n      }\r\n\r\n      if (this.localStream) {\r\n        this.localStream.getTracks().forEach(t => t.stop())\r\n        this.localStream = null\r\n      }\r\n\r\n      this.$refs.localVideo.srcObject = null\r\n      this.$refs.remoteVideo.srcObject = null\r\n    }\r\n  },\r\n\r\n  beforeDestroy() {\r\n    this.hangup()\r\n    this.ws && this.ws.close()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.webrtc-container {\r\n  padding: 20px;\r\n}\r\n.video-box {\r\n  display: flex;\r\n  gap: 20px;\r\n}\r\nvideo {\r\n  width: 320px;\r\n  height: 240px;\r\n  background: #000;\r\n}\r\n.actions {\r\n  margin-top: 20px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}