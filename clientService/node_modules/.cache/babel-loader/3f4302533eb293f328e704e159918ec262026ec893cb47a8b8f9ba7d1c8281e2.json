{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _default = exports.default = {\n  data() {\n    return {\n      // 状态控制\n      isProcessing: true,\n      processText: '正在解析用户信息...',\n      hasError: false,\n      errorTip: '',\n      // 用户数据\n      userName: '',\n      userAge: ''\n    };\n  },\n  mounted() {\n    // 页面加载后延迟执行，确保路由已完全准备好\n    this.$nextTick(() => {\n      this.initJoinLogic();\n    });\n  },\n  methods: {\n    initJoinLogic() {\n      const query = this.$route.query;\n\n      // 1. 获取并清理参数\n      this.userName = this.cleanParam(query.name);\n      this.userAge = this.cleanParam(query.age);\n      console.log('解析到的数据:', {\n        name: this.userName,\n        age: this.userAge\n      });\n\n      // 2. 校验逻辑\n      if (!this.userName || this.userName === 'undefined') {\n        this.showError('未检测到有效的用户名信息');\n        return;\n      }\n\n      // 3. 模拟请求后端接口进行验证\n      this.handleVerify();\n    },\n    /**\r\n     * 清理参数：去除单引号、双引号、多余空格\r\n     */\n    cleanParam(val) {\n      if (val === undefined || val === null) return '';\n      // 处理可能被 URL 转义的引号，并去除前后的单/双引号\n      return decodeURIComponent(val).replace(/^['\"]|['\"]$/g, '').trim();\n    },\n    async handleVerify() {\n      this.processText = '正在为您匹配通讯房间...';\n      try {\n        // 此处应为实际的接口调用，例如：\n        // const res = await this.$api.getToken({ name: this.userName, age: this.userAge });\n\n        // 模拟接口成功返回\n        setTimeout(() => {\n          this.$router.replace({\n            name: 'JoinRoom',\n            params: {\n              roomId: 'R123',\n              token: 'TK456'\n            }\n          });\n        }, 1000);\n      } catch (err) {\n        this.showError('通讯服务器连接失败，请检查网络');\n      }\n    },\n    showError(msg) {\n      this.isProcessing = false;\n      this.hasError = true;\n      this.errorTip = msg;\n    },\n    closeWindow() {\n      // 返回上一页或关闭\n      if (window.history.length > 1) {\n        this.$router.back();\n      } else {\n        window.close();\n      }\n    }\n  }\n};","map":{"version":3,"names":["data","isProcessing","processText","hasError","errorTip","userName","userAge","mounted","$nextTick","initJoinLogic","methods","query","$route","cleanParam","name","age","console","log","showError","handleVerify","val","undefined","decodeURIComponent","replace","trim","setTimeout","$router","params","roomId","token","err","msg","closeWindow","window","history","length","back","close"],"sources":["src/views/JoinRoom.vue"],"sourcesContent":["<template>\r\n  <div class=\"join-room\">\r\n    <div v-if=\"isProcessing\" class=\"status-box\">\r\n      <div class=\"spinner\"></div>\r\n      <p>{{ processText }}</p>\r\n    </div>\r\n    \r\n    <div v-else-if=\"hasError\" class=\"error-box\">\r\n      <h3>访问受限</h3>\r\n      <p>{{ errorTip }}</p>\r\n      <button @click=\"closeWindow\">返回并重试</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 状态控制\r\n      isProcessing: true,\r\n      processText: '正在解析用户信息...',\r\n      hasError: false,\r\n      errorTip: '',\r\n      \r\n      // 用户数据\r\n      userName: '',\r\n      userAge: ''\r\n    };\r\n  },\r\n  mounted() {\r\n    // 页面加载后延迟执行，确保路由已完全准备好\r\n    this.$nextTick(() => {\r\n      this.initJoinLogic();\r\n    });\r\n  },\r\n  methods: {\r\n    initJoinLogic() {\r\n      const query = this.$route.query;\r\n      \r\n      // 1. 获取并清理参数\r\n      this.userName = this.cleanParam(query.name);\r\n      this.userAge = this.cleanParam(query.age);\r\n\r\n      console.log('解析到的数据:', { name: this.userName, age: this.userAge });\r\n\r\n      // 2. 校验逻辑\r\n      if (!this.userName || this.userName === 'undefined') {\r\n        this.showError('未检测到有效的用户名信息');\r\n        return;\r\n      }\r\n\r\n      // 3. 模拟请求后端接口进行验证\r\n      this.handleVerify();\r\n    },\r\n\r\n    /**\r\n     * 清理参数：去除单引号、双引号、多余空格\r\n     */\r\n    cleanParam(val) {\r\n      if (val === undefined || val === null) return '';\r\n      // 处理可能被 URL 转义的引号，并去除前后的单/双引号\r\n      return decodeURIComponent(val)\r\n        .replace(/^['\"]|['\"]$/g, '') \r\n        .trim();\r\n    },\r\n\r\n    async handleVerify() {\r\n      this.processText = '正在为您匹配通讯房间...';\r\n      \r\n      try {\r\n        // 此处应为实际的接口调用，例如：\r\n        // const res = await this.$api.getToken({ name: this.userName, age: this.userAge });\r\n        \r\n        // 模拟接口成功返回\r\n        setTimeout(() => {\r\n          this.$router.replace({\r\n            name: 'JoinRoom',\r\n            params: {\r\n              roomId: 'R123', \r\n              token: 'TK456'  \r\n            }\r\n          });\r\n        }, 1000);\r\n      } catch (err) {\r\n        this.showError('通讯服务器连接失败，请检查网络');\r\n      }\r\n    },\r\n\r\n    showError(msg) {\r\n      this.isProcessing = false;\r\n      this.hasError = true;\r\n      this.errorTip = msg;\r\n    },\r\n\r\n    closeWindow() {\r\n      // 返回上一页或关闭\r\n      if (window.history.length > 1) {\r\n        this.$router.back();\r\n      } else {\r\n        window.close();\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.join-room { \r\n  height: 100vh;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 0 20px; \r\n  text-align: center; \r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.status-box .spinner {\r\n  width: 40px;\r\n  height: 40px;\r\n  border: 3px solid #f3f3f3;\r\n  border-top: 3px solid #3498db;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin: 0 auto 15px;\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n\r\n.error-box h3 { color: #333; margin-top: 20px; }\r\n.error-box p { color: #999; font-size: 14px; margin: 10px 0 30px; }\r\n\r\nbutton {\r\n  padding: 10px 30px; \r\n  background: #3498db; \r\n  color: #fff;\r\n  border: none; \r\n  border-radius: 20px; \r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n\r\nbutton:hover {\r\n  background: #2980b9;\r\n}\r\n</style>"],"mappings":";;;;;;iCAgBA;EACAA,KAAA;IACA;MACA;MACAC,YAAA;MACAC,WAAA;MACAC,QAAA;MACAC,QAAA;MAEA;MACAC,QAAA;MACAC,OAAA;IACA;EACA;EACAC,QAAA;IACA;IACA,KAAAC,SAAA;MACA,KAAAC,aAAA;IACA;EACA;EACAC,OAAA;IACAD,cAAA;MACA,MAAAE,KAAA,QAAAC,MAAA,CAAAD,KAAA;;MAEA;MACA,KAAAN,QAAA,QAAAQ,UAAA,CAAAF,KAAA,CAAAG,IAAA;MACA,KAAAR,OAAA,QAAAO,UAAA,CAAAF,KAAA,CAAAI,GAAA;MAEAC,OAAA,CAAAC,GAAA;QAAAH,IAAA,OAAAT,QAAA;QAAAU,GAAA,OAAAT;MAAA;;MAEA;MACA,UAAAD,QAAA,SAAAA,QAAA;QACA,KAAAa,SAAA;QACA;MACA;;MAEA;MACA,KAAAC,YAAA;IACA;IAEA;AACA;AACA;IACAN,WAAAO,GAAA;MACA,IAAAA,GAAA,KAAAC,SAAA,IAAAD,GAAA;MACA;MACA,OAAAE,kBAAA,CAAAF,GAAA,EACAG,OAAA,qBACAC,IAAA;IACA;IAEA,MAAAL,aAAA;MACA,KAAAjB,WAAA;MAEA;QACA;QACA;;QAEA;QACAuB,UAAA;UACA,KAAAC,OAAA,CAAAH,OAAA;YACAT,IAAA;YACAa,MAAA;cACAC,MAAA;cACAC,KAAA;YACA;UACA;QACA;MACA,SAAAC,GAAA;QACA,KAAAZ,SAAA;MACA;IACA;IAEAA,UAAAa,GAAA;MACA,KAAA9B,YAAA;MACA,KAAAE,QAAA;MACA,KAAAC,QAAA,GAAA2B,GAAA;IACA;IAEAC,YAAA;MACA;MACA,IAAAC,MAAA,CAAAC,OAAA,CAAAC,MAAA;QACA,KAAAT,OAAA,CAAAU,IAAA;MACA;QACAH,MAAA,CAAAI,KAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}